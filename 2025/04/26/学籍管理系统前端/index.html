<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>学籍管理系统前端 | 圆橙子</title><meta name="author" content="Cheng-orange"><meta name="copyright" content="Cheng-orange"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="1.使用框架和界面概览vue3+vant组件实现web移动端开发 2.项目创建和目录项目创建：（命令行） 1vue create 项目名称   然后等待创建即可。  初始项目中src&#x2F;App.vue中多余代码都可以删，留个框架即可。 components&#x2F;HelloWorld.vue也删，没用  项目启动： 123cd 项目所在目录npm init &#x2F;&#x2F;如果是移植别的项目，先i">
<meta property="og:type" content="article">
<meta property="og:title" content="学籍管理系统前端">
<meta property="og:url" content="http://example.com/2025/04/26/%E5%AD%A6%E7%B1%8D%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E5%89%8D%E7%AB%AF/index.html">
<meta property="og:site_name" content="圆橙子">
<meta property="og:description" content="1.使用框架和界面概览vue3+vant组件实现web移动端开发 2.项目创建和目录项目创建：（命令行） 1vue create 项目名称   然后等待创建即可。  初始项目中src&#x2F;App.vue中多余代码都可以删，留个框架即可。 components&#x2F;HelloWorld.vue也删，没用  项目启动： 123cd 项目所在目录npm init &#x2F;&#x2F;如果是移植别的项目，先i">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/avatar.jpg">
<meta property="article:published_time" content="2025-04-26T05:02:32.000Z">
<meta property="article:modified_time" content="2025-05-30T11:27:59.591Z">
<meta property="article:author" content="Cheng-orange">
<meta property="article:tag" content="vue3">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/avatar.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "学籍管理系统前端",
  "url": "http://example.com/2025/04/26/%E5%AD%A6%E7%B1%8D%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E5%89%8D%E7%AB%AF/",
  "image": "http://example.com/img/avatar.jpg",
  "datePublished": "2025-04-26T05:02:32.000Z",
  "dateModified": "2025-05-30T11:27:59.591Z",
  "author": [
    {
      "@type": "Person",
      "name": "Cheng-orange",
      "url": "http://example.com/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2025/04/26/%E5%AD%A6%E7%B1%8D%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E5%89%8D%E7%AB%AF/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '学籍管理系统前端',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg" style="background-image: url(/img/banner.jpg);"></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">圆橙子</span></a><a class="nav-page-title" href="/"><span class="site-name">学籍管理系统前端</span></a></span><div id="menus"></div></nav><div id="post-info"><h1 class="post-title">学籍管理系统前端</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-04-26T05:02:32.000Z" title="发表于 2025-04-26 13:02:32">2025-04-26</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-05-30T11:27:59.591Z" title="更新于 2025-05-30 19:27:59">2025-05-30</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%89%8D%E7%AB%AF%E5%AD%A6%E4%B9%A0/">前端学习</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="1-使用框架和界面概览"><a href="#1-使用框架和界面概览" class="headerlink" title="1.使用框架和界面概览"></a>1.使用框架和界面概览</h1><p>vue3+vant组件实现web移动端开发</p>
<h1 id="2-项目创建和目录"><a href="#2-项目创建和目录" class="headerlink" title="2.项目创建和目录"></a>2.项目创建和目录</h1><p>项目创建：（命令行）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vue create 项目名称</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.staticaly.com/gh/orange-xue/PicgoImg@main/img/202505141442223.png" alt="image-20250514144203591"></p>
<p>然后等待创建即可。</p>
<blockquote>
<p>初始项目中src&#x2F;App.vue中多余代码都可以删，留个框架即可。</p>
<p>components&#x2F;HelloWorld.vue也删，没用</p>
</blockquote>
<p>项目启动：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd 项目所在目录</span><br><span class="line">npm init //如果是移植别的项目，先init下载需要的依赖</span><br><span class="line">npm run serve</span><br></pre></td></tr></table></figure>

<p>本项目目录：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">pages</span><br><span class="line">├─ .browserslistrc</span><br><span class="line">├─ .eslintrc.js</span><br><span class="line">├─ babel.config.js</span><br><span class="line">├─ demo.vue</span><br><span class="line">├─ jsconfig.json</span><br><span class="line">├─ package-lock.json</span><br><span class="line">├─ package.json</span><br><span class="line">├─ public</span><br><span class="line">│  ├─ favicon.ico</span><br><span class="line">│  └─ index.html</span><br><span class="line">├─ README.md</span><br><span class="line">├─ src</span><br><span class="line">│  ├─ api</span><br><span class="line">│  │  └─ user.js //接口文件</span><br><span class="line">│  ├─ App.vue //根组件</span><br><span class="line">│  ├─ assets //存静态资源</span><br><span class="line">│  │  ├─ background.jpg</span><br><span class="line">│  │  └─ logo.png</span><br><span class="line">│  ├─ components //放vue小组件，但是本项目没用</span><br><span class="line">│  │  └─ HelloWorld.vue</span><br><span class="line">│  ├─ main.js //入口文件，用于创建Vue实例并挂载到DOM上，配置路由和状态管理。</span><br><span class="line">│  ├─ router</span><br><span class="line">│  │  └─ index.js //路由文件</span><br><span class="line">│  ├─ store</span><br><span class="line">│  ├─ styles //界面相关的css，需要在main.js中统一引入</span><br><span class="line">│  │  ├─ index.css</span><br><span class="line">│  │  ├─ search.css</span><br><span class="line">│  │  └─ stucard.css</span><br><span class="line">│  ├─ utils</span><br><span class="line">│  │  └─ request.js</span><br><span class="line">│  └─ views //页面组件</span><br><span class="line">│     ├─ edit //修改页面</span><br><span class="line">│     │  ├─ EditButton.vue //修改新增等按钮组</span><br><span class="line">│     │  ├─ EditView.vue //修改页面，设置插槽，插入EditButton，StuCard</span><br><span class="line">│     │  └─ StuCard.vue //学生信息卡组件</span><br><span class="line">│     ├─ home //主页</span><br><span class="line">│     │  ├─ ChartForm.vue //表格和图标组件</span><br><span class="line">│     │  ├─ HomeView.vue</span><br><span class="line">│     │  └─ SearchPart.vue //检索组件</span><br><span class="line">│     ├─ layout</span><br><span class="line">│     │  └─ FooterView.vue //底部导航栏</span><br><span class="line">│     ├─ login</span><br><span class="line">│     │  └─ LoginView.vue //登录界面</span><br><span class="line">│     └─ user</span><br><span class="line">│        └─ PersonalView.vue //用户个人信息界面</span><br><span class="line">└─ vue.config.js</span><br></pre></td></tr></table></figure>

<h1 id="3-注册引入框架、自定义的css"><a href="#3-注册引入框架、自定义的css" class="headerlink" title="3.注册引入框架、自定义的css"></a>3.注册引入框架、自定义的css</h1><p>src&#x2F;main.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;./router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;vant/lib/index.css&#x27;</span>;</span><br><span class="line"><span class="comment">//import &#123; Form, Field, CellGroup &#125; from &#x27;vant&#x27;;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vant</span> <span class="keyword">from</span> <span class="string">&#x27;vant&#x27;</span>; <span class="comment">//整体引入</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./styles/index.css&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./styles/search.css&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./styles/stucard.css&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(<span class="title class_">App</span>);</span><br><span class="line">app.<span class="title function_">use</span>(router).<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// app.use(Form);</span></span><br><span class="line"><span class="comment">// app.use(Field);</span></span><br><span class="line"><span class="comment">// app.use(CellGroup);</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="title class_">Vant</span>); <span class="comment">//全部注册</span></span><br></pre></td></tr></table></figure>

<h1 id="4-路由设置"><a href="#4-路由设置" class="headerlink" title="4.路由设置"></a>4.路由设置</h1><p>src&#x2F;router&#x2F;index.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createRouter, createWebHashHistory &#125; <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">LoginView</span> <span class="keyword">from</span> <span class="string">&#x27;@/views/login/LoginView.vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">HomeView</span> <span class="keyword">from</span> <span class="string">&#x27;@/views/home/HomeView.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;login&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="title class_">LoginView</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/home&#x27;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;layout&quot;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span> (<span class="string">&quot;../views/layout/FooterView.vue&quot;</span>),</span><br><span class="line">    <span class="attr">children</span>: [</span><br><span class="line">      &#123;<span class="comment">//默认子路由</span></span><br><span class="line">        <span class="attr">path</span>: <span class="string">&quot;&quot;</span>, </span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;home&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="title class_">HomeView</span></span><br><span class="line">        <span class="comment">//component: () =&gt; import (&quot;../views/home/HomeView.vue&quot;), //懒加载</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&quot;/add&quot;</span>, </span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;add&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span> (<span class="string">&quot;../views/edit/EditView.vue&quot;</span>),</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&quot;/userInfo&quot;</span>, </span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;userInfo&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span> (<span class="string">&quot;../views/user/PersonalView.vue&quot;</span>),</span><br><span class="line">      &#125;,</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="title function_">createRouter</span>(&#123;</span><br><span class="line">  <span class="attr">history</span>: <span class="title function_">createWebHashHistory</span>(),</span><br><span class="line">  routes</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router</span><br></pre></td></tr></table></figure>

<h1 id="5-登录"><a href="#5-登录" class="headerlink" title="5.登录"></a>5.登录</h1><h2 id="逻辑说明"><a href="#逻辑说明" class="headerlink" title="逻辑说明"></a>逻辑说明</h2><blockquote>
<p>用户输入 → 响应式绑定 → 表单校验 → API 请求 → 反馈结果</p>
</blockquote>
<p>在van-field中：1.<code>v-model</code>双向绑定用户输入的数据（学工号和密码）2.<code>:rules</code>绑定对用户输入数据的校验规则userFormRules，这样用户一输入信息就进行校验</p>
<p>在van-button上绑定点击事件onSubmit，点击将用户输入信息传给后端，再根据后端返回结果进行操作。</p>
<p>在js中：</p>
<ol>
<li>使用<code>reactive</code>：创建响应式对象 <code>user</code>，存储用户输入的用户名和密码。</li>
<li>在return中使用<code>toRefs</code>,解构 <code>user</code> 并保持响应性,这样模板中能直接使用 <code>username</code>和<code>password</code> （也就是van-field中可以直接写v-model&#x3D;”userID”，不用写成v-model&#x3D;”user.userID”）</li>
<li>userFormRules：对获取的用户填写的数据进行校验。<code>required</code>：非空校验。<code>pattern</code>：正则校验。</li>
<li>onSubmit：调用后台接口，完成登录。将调用接口方法封装到api&#x2F;user.js文件的login方法。这里就可以直接使用await login(user)调用接口方法了。根据后端传回来的状态码决定是否登录跳转。如果登录成功就跳转到首页：router.push(‘&#x2F;home’);</li>
</ol>
<h2 id="代码部分"><a href="#代码部分" class="headerlink" title="代码部分"></a>代码部分</h2><p>src&#x2F;login&#x2F;LoginView.vue</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;dad&quot;&gt;</span><br><span class="line">    &lt;van-image</span><br><span class="line">        width=&quot;60%&quot;</span><br><span class="line">        :src=&quot;require(&#x27;../../assets/logo.png&#x27;)&quot; &gt;</span><br><span class="line">    &lt;/van-image&gt;</span><br><span class="line">    &lt;div class=&quot;login-title&quot;&gt;</span><br><span class="line">        学籍管理系统</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;van-form &gt;</span><br><span class="line">        &lt;van-cell-group inset&gt;</span><br><span class="line">            &lt;van-field</span><br><span class="line">                v-model=&quot;userID&quot;</span><br><span class="line">                name=&quot;userID&quot;</span><br><span class="line">                placeholder=&quot;请填写学工号&quot;</span><br><span class="line">                left-icon = &quot;manager&quot;</span><br><span class="line">                :rules = &quot;userFormRules.userID&quot;</span><br><span class="line">            &gt;&lt;/van-field&gt;</span><br><span class="line">            &lt;van-field</span><br><span class="line">                v-model=&quot;password&quot;</span><br><span class="line">                type=&quot;password&quot;</span><br><span class="line">                name=&quot;password&quot;</span><br><span class="line">                placeholder=&quot;请输入密码&quot;</span><br><span class="line">                left-icon = &quot;lock&quot;</span><br><span class="line">                :rules = &quot;userFormRules.password&quot;</span><br><span class="line">            &gt;&lt;/van-field&gt;</span><br><span class="line"></span><br><span class="line">            &lt;!-- “记住我” 单选框和 “忘记密码” 链接 --&gt;</span><br><span class="line">            &lt;div class=&quot;remember-forget&quot;&gt;</span><br><span class="line">                &lt;van-checkbox icon-size=&quot;1.1rem&quot; v-model=&quot;rememberMe&quot;&gt;记住我&lt;/van-checkbox&gt;</span><br><span class="line">                &lt;a href=&quot;#&quot; @click.prevent=&quot;onForgetPassword&quot;&gt;忘记密码&lt;/a&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/van-cell-group&gt;</span><br><span class="line">        &lt;div style=&quot;margin: 16px;&quot;&gt;</span><br><span class="line">            &lt;van-button block type=&quot;primary&quot; native-type=&quot;submit&quot; @click=&quot;onSubmit&quot;&gt;</span><br><span class="line">                登录</span><br><span class="line">            &lt;/van-button&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/van-form&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123; reactive , toRefs ,ref&#125; from &quot;vue&quot;;</span><br><span class="line">import &#123; login &#125; from &quot;../../api/user.js&quot;;</span><br><span class="line">import &#123; Toast &#125; from &quot;vant&quot;;</span><br><span class="line">import router from &#x27;@/router/index.js&#x27;;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">    setup() &#123;</span><br><span class="line">        //构建响应式对象，绑定用户输入信息</span><br><span class="line">        const user=reactive(&#123;</span><br><span class="line">            userID: &quot;&quot;,</span><br><span class="line">            password: &quot;&quot;,</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        //定义表单校验规则,在组件中添加:rules=&quot;&quot;</span><br><span class="line">        const userFormRules = &#123;</span><br><span class="line">            userID: [&#123; required: true, message: &#x27;学工号不能为空&#x27; &#125;],</span><br><span class="line">            password: [</span><br><span class="line">                &#123; required: true, message: &#x27;密码不能为空&#x27; &#125;,</span><br><span class="line">                //&#123; pattern: /^[a-zA-Z]\w&#123;5,17&#125;$/, message: &#x27;密码格式错误&#x27; &#125;</span><br><span class="line">            ],</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        //调用后台接口，完成登录</span><br><span class="line">        const onSubmit = async () =&gt; &#123;</span><br><span class="line">            Toast.loading(&#123;</span><br><span class="line">                message: &quot;登陆中...&quot;,</span><br><span class="line">                forbidClick: true,</span><br><span class="line">            &#125;);</span><br><span class="line">            </span><br><span class="line">            const res = await login(user);</span><br><span class="line">            if(res.data.code === 0)&#123;</span><br><span class="line">                Toast.success(&#x27;登陆成功&#x27;);</span><br><span class="line">                router.push(&#x27;/home&#x27;);</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                Toast.fail(&#x27;学工号或密码错误&#x27;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        // 记住我状态</span><br><span class="line">        const rememberMe = ref(false);</span><br><span class="line"></span><br><span class="line">        const onForgetPassword = () =&gt; &#123;</span><br><span class="line">            // 忘记密码的逻辑</span><br><span class="line">            Toast.info(&#x27;忘记密码功能待实现&#x27;);</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        return &#123;//...将数组、对象解包成单独元素，此时不再是响应式，使用toRefs使其变为响应式</span><br><span class="line">        ...toRefs(user),</span><br><span class="line">        userFormRules,</span><br><span class="line">        onSubmit,</span><br><span class="line">        rememberMe,</span><br><span class="line">        onForgetPassword</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">.login-title&#123;</span><br><span class="line">    font-size: 30px;</span><br><span class="line">    margin-top: 30%;</span><br><span class="line">    margin-bottom: 5px;</span><br><span class="line">    text-align: center;</span><br><span class="line">    font-family: &#x27;STKaiti&#x27;;</span><br><span class="line">&#125;</span><br><span class="line">.dad&#123;</span><br><span class="line">    background-image: url(../../assets/background.jpg);</span><br><span class="line">    height: 100vh;</span><br><span class="line">    background-size: cover;</span><br><span class="line">&#125;</span><br><span class="line">.dad .van-image&#123;</span><br><span class="line">    padding-top: 10px;</span><br><span class="line">&#125;</span><br><span class="line">.van-form&#123;</span><br><span class="line">    background-color: rgb(255, 252, 252);</span><br><span class="line">    align-items: center; </span><br><span class="line">    margin: 2px 20px auto 20px;   </span><br><span class="line">    padding: 15px 0 3px 0;</span><br><span class="line">    box-shadow: 0 0 5px 0 rgb(206, 203, 203);</span><br><span class="line">    border-radius: 5px;</span><br><span class="line">&#125;</span><br><span class="line">.van-form .van-field&#123;</span><br><span class="line">    background-color: rgb(255, 252, 252);</span><br><span class="line">    padding: 0px;</span><br><span class="line">    margin: 10px 2px 10px 2px;</span><br><span class="line">    font-size: 15px;</span><br><span class="line">    line-height: 35px;</span><br><span class="line">&#125;</span><br><span class="line">.van-form .van-button&#123;</span><br><span class="line">    font-size: 16px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.remember-forget &#123;</span><br><span class="line">  display: flex;</span><br><span class="line">  justify-content: space-between;</span><br><span class="line">  align-items: center;</span><br><span class="line">  padding: 0 .3rem;</span><br><span class="line">  margin-top: .4rem;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h3 id="封装接口方法"><a href="#封装接口方法" class="headerlink" title="封装接口方法"></a>封装接口方法</h3><blockquote>
<table>
<thead>
<tr>
<th align="left">情况</th>
<th align="left">后端是否需配置 <code>baseURL</code>？</th>
<th align="left">前端 <code>baseURL</code> 示例</th>
</tr>
</thead>
<tbody><tr>
<td align="left">后端接口直接挂在根路径（如 <code>/users</code>）</td>
<td align="left">❌ 不需要</td>
<td align="left">直接设 <code>baseURL</code> 为 <code>http://localhost:8080</code></td>
</tr>
<tr>
<td align="left">后端接口有统一前缀（如 <code>/api/users</code>）</td>
<td align="left">✅ 需要</td>
<td align="left"><code>http://localhost:8080/api</code></td>
</tr>
<tr>
<td align="left">生产环境（如 <code>https://api.example.com</code>）</td>
<td align="left">✅ 需要（通过 Nginx&#x2F;网关）</td>
<td align="left"><code>https://api.example.com</code></td>
</tr>
</tbody></table>
<p>后端默认监听 <code>localhost:8080</code></p>
</blockquote>
<p>src&#x2F;utils&#x2F;request.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//定制请求的实例</span></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&quot;axios&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> requst = axios.<span class="title function_">create</span>(&#123;</span><br><span class="line">    <span class="comment">//API请求的默认前缀，告诉 HTTP 客户端（如 Axios、Fetch）：把所有 API 请求发送到baseURL/...</span></span><br><span class="line">    <span class="attr">baseURL</span>: <span class="string">&quot;http://localhost:8080/&quot;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> requst;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>src&#x2F;api&#x2F;user.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//导入request.js请求工具</span></span><br><span class="line"><span class="keyword">import</span> requst <span class="keyword">from</span> <span class="string">&quot;@/utils/request&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//提供调用登录接口的函数</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">login</span> = (<span class="params">data</span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">//后端以x-www-form-urlencoded格式接收数据，所以这里需要借助URLSearchParams完成传递</span></span><br><span class="line">    <span class="keyword">const</span> params = <span class="keyword">new</span> <span class="title class_">URLSearchParams</span>()</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> data) &#123;</span><br><span class="line">        params.<span class="title function_">append</span>(key, data[key])</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">requst</span>(&#123;</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&quot;/user/login&quot;</span>, <span class="comment">//服务端接口地址</span></span><br><span class="line">        <span class="attr">data</span>: params, <span class="comment">//用户输入信息</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="跨域解决"><a href="#跨域解决" class="headerlink" title="跨域解决"></a>跨域解决</h3><blockquote>
<p>后端加@CrossOrigin，但是用get请求的时候还是会存在跨域问题。这里前端配置一下</p>
</blockquote>
<p>在vue.config.js中配置</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; defineConfig &#125; = <span class="built_in">require</span>(<span class="string">&#x27;@vue/cli-service&#x27;</span>)</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">  <span class="attr">transpileDependencies</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">devServer</span>: &#123; <span class="comment">//跨域相关</span></span><br><span class="line">    <span class="attr">proxy</span>: &#123;</span><br><span class="line">      <span class="string">&#x27;/api&#x27;</span>: &#123;</span><br><span class="line">        <span class="attr">target</span>: <span class="string">&#x27;http://localhost:8080/&#x27;</span>,</span><br><span class="line">        <span class="attr">changeOrigin</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">pathRewrite</span>: &#123;</span><br><span class="line">          <span class="string">&#x27;^/api&#x27;</span>: <span class="string">&#x27;&#x27;</span> </span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在sec&#x2F;utils&#x2F;request.js中修改baseURL</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> instance = axios.<span class="title function_">create</span>(&#123;</span><br><span class="line">    <span class="comment">// API 请求的默认前缀</span></span><br><span class="line">    <span class="comment">//baseURL: &quot;http://localhost:8080/&quot;,</span></span><br><span class="line">    <span class="attr">baseURL</span>: <span class="string">&quot;/api&quot;</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="登陆优化-处理用户token"><a href="#登陆优化-处理用户token" class="headerlink" title="登陆优化-处理用户token"></a><del>登陆优化-处理用户token</del></h2><p>将用户token数据存储到vuex和本地中。只存到vuex的话，浏览器一刷新数据就会丢失。处理后，在其他界面需要使用用户信息、权限的时候就可以直接从vuex中获取（其中数据默认都是响应式）。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install vuex@next --save</span><br></pre></td></tr></table></figure>

<blockquote>
<p>src&#x2F;store&#x2F;index.js设置容器存储和更新用户token</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">&quot;vuex&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">TOKEN_KEY</span> = <span class="string">&quot;USERMSG&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> store = <span class="title function_">createStore</span>(&#123;</span><br><span class="line">    <span class="comment">//用户信息放在state中的user参数中,并且从localStorage中取出用户数据后将数据改成对象格式</span></span><br><span class="line">    <span class="attr">state</span>:&#123;</span><br><span class="line">        <span class="attr">user</span>: <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="variable language_">window</span>.<span class="property">localStorage</span>.<span class="title function_">getItem</span>(<span class="variable constant_">TOKEN_KEY</span>)),</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">mutations</span>:&#123;</span><br><span class="line">        <span class="comment">//用户数据更新</span></span><br><span class="line">        <span class="title function_">setUser</span>(<span class="params">state, date</span>)&#123;</span><br><span class="line">            state.<span class="property">user</span> = date;</span><br><span class="line">            <span class="comment">//将数据存入本地，避免浏览器一刷新就丢失数据。同时将数据转为string</span></span><br><span class="line">            <span class="variable language_">window</span>.<span class="property">localStorage</span>.<span class="title function_">setItem</span>(<span class="variable constant_">TOKEN_KEY</span>,<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(state.<span class="property">user</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>上面这种写法每次在存储或从本地拿token会很麻烦，所以先将这几种从本地存、拿数据的方法方法进行封装。</p>
<p>新建src&#x2F;utils&#x2F;storage.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//从localstorage中获取|存储|删除数据</span></span><br><span class="line"><span class="comment">//存储</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">setItem</span> = (<span class="params">key , value</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">typeof</span> value === <span class="string">&#x27;object&#x27;</span>)&#123;</span><br><span class="line">        value = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(value);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">localStorage</span>.<span class="title function_">setItem</span>(key,value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取数据</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getItem</span> = (<span class="params">key</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> data = <span class="variable language_">window</span>.<span class="property">localStorage</span>.<span class="title function_">getItem</span>(key);</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">JSON</span>.<span class="title function_">parse</span>(data);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span>(e)&#123;</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//删除数据</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">removeItem</span> = (<span class="params">key</span>) =&gt; &#123;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">localStorage</span>.<span class="title function_">removeItem</span>(key);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在src&#x2F;store&#x2F;index.js设置容器存储和更新用户token，向本地数据操作的时候直接调用utils&#x2F;storage.js中封装的方法。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">&quot;vuex&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getItem, setItem &#125; <span class="keyword">from</span> <span class="string">&quot;@/utils/storage&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">TOKEN_KEY</span> = <span class="string">&quot;USERMSG&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> store = <span class="title function_">createStore</span>(&#123;</span><br><span class="line">    <span class="comment">//将用户信息存入state中的user参数中,并且从localStorage中取出用户数据后将数据改成对象格式</span></span><br><span class="line">    <span class="attr">state</span>:&#123;</span><br><span class="line">        <span class="attr">user</span>: <span class="title function_">getItem</span>(<span class="variable constant_">TOKEN_KEY</span>),</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">mutations</span>:&#123;</span><br><span class="line">        <span class="comment">//用户数据更新</span></span><br><span class="line">        <span class="title function_">setUser</span>(<span class="params">state, date</span>)&#123;</span><br><span class="line">            state.<span class="property">user</span> = date;</span><br><span class="line">            <span class="comment">//将数据存入本地，避免浏览器一刷新就丢失数据。同时将数据转为string</span></span><br><span class="line">            <span class="title function_">setItem</span>(<span class="variable constant_">TOKEN_KEY</span>,state.<span class="property">user</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>将store在main.js中注册</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;./store&#x27;</span>;</span><br><span class="line">...</span><br><span class="line">app.<span class="title function_">use</span>(store);</span><br></pre></td></tr></table></figure>

<p>修改LoginView中的js部分代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">import</span> &#123; useStore &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">const</span> store = <span class="title function_">useStore</span>();</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">onSubmit</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">            ...</span><br><span class="line">            <span class="keyword">if</span>(res.<span class="property">data</span>.<span class="property">code</span> === <span class="number">0</span>)&#123;</span><br><span class="line">                <span class="comment">//调用useStore的commit将登陆成功的用户token存入vuex和本地</span></span><br><span class="line">                store.<span class="title function_">commit</span>(<span class="string">&#x27;setUser&#x27;</span>,user);</span><br><span class="line">                <span class="title class_">Toast</span>.<span class="title function_">success</span>(<span class="string">&#x27;登陆成功&#x27;</span>);</span><br><span class="line">                router.<span class="title function_">push</span>(<span class="string">&#x27;/home&#x27;</span>);</span><br><span class="line">             ...</span><br></pre></td></tr></table></figure>

<p>打开控制台，点“应用程序”–“本地存储”,可以看到token内容</p>
<h1 id="6-底部导航栏"><a href="#6-底部导航栏" class="headerlink" title="6.底部导航栏"></a>6.底部导航栏</h1><blockquote>
<p>配合路由设置，通过底部导航栏找到用户信息，主页，修改这三个主界面</p>
</blockquote>
<h2 id="逻辑说明-1"><a href="#逻辑说明-1" class="headerlink" title="逻辑说明"></a>逻辑说明</h2><ol>
<li>能用到导航栏时肯定已经登录了，路由已经跳到了&#x2F;home，用<code>&lt;router-view&gt;</code> 渲染对应的页面组件。</li>
<li>在van-tabbar中用v-model双向绑定active，也就是当前选中标签的索引值，然后导航栏对应项高亮。默认初始是主页，所以js中active &#x3D; ref(0)。</li>
<li>用户点击导航栏，通过 <code>to=&quot;/path&quot;</code> 跳转到对应路由，同时路由变化触发 <code>watch</code>，再次调用 <code>updateActiveTab()</code> 更新 <code>active</code>，改变导航栏高亮项。</li>
<li>用户直接通过浏览器地址栏修改 URL 时，route.path改变，也会触发 <code>watch</code>，调用updateActiveTab方法，实现页面切换同步。</li>
<li>updateActiveTab方法中通过判断path.startsWith(‘’)内容设置active值。</li>
</ol>
<h2 id="代码部分-1"><a href="#代码部分-1" class="headerlink" title="代码部分"></a>代码部分</h2><p>src&#x2F;views&#x2F;layout&#x2F;FooterView.vue</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;router-view&gt;&lt;/router-view&gt;</span><br><span class="line">    &lt;van-tabbar v-model=&quot;active&quot;&gt;</span><br><span class="line">        &lt;van-tabbar-item icon=&quot;search&quot; to=&quot;/home&quot;&gt;检索&lt;/van-tabbar-item&gt;</span><br><span class="line">        &lt;van-tabbar-item icon=&quot;edit&quot; to=&quot;/edit&quot;&gt;信息修改&lt;/van-tabbar-item&gt;</span><br><span class="line">        &lt;van-tabbar-item icon=&quot;chart-trending-o&quot; to=&quot;/chart&quot;&gt;数据图表&lt;/van-tabbar-item&gt;</span><br><span class="line">        &lt;van-tabbar-item icon=&quot;user-o&quot; to=&quot;/userInfo&quot;&gt;我的&lt;/van-tabbar-item&gt;</span><br><span class="line">    &lt;/van-tabbar&gt;</span><br><span class="line"></span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">// import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line">// export default &#123;</span><br><span class="line">//     setup() &#123;</span><br><span class="line">//         const active = ref(0);</span><br><span class="line">//         return &#123; active &#125;;</span><br><span class="line">//     &#125;,</span><br><span class="line">// &#125;</span><br><span class="line">import &#123; ref, watch &#125; from &#x27;vue&#x27;</span><br><span class="line">import &#123; useRoute &#125; from &#x27;vue-router&#x27;</span><br><span class="line">export default &#123;</span><br><span class="line">  setup() &#123;</span><br><span class="line">    const route = useRoute()</span><br><span class="line">    const active = ref(0)</span><br><span class="line">    // 根据当前路由自动设置 active 索引</span><br><span class="line">    const updateActiveTab = () =&gt; &#123;</span><br><span class="line">      const path = route.path</span><br><span class="line">      if (path.startsWith(&#x27;/home&#x27;)) &#123;</span><br><span class="line">        active.value = 0</span><br><span class="line">      &#125; else if (path.startsWith(&#x27;/edit&#x27;)) &#123;</span><br><span class="line">        active.value = 1</span><br><span class="line">      &#125; else if (path.startsWith(&#x27;/chart&#x27;)) &#123;</span><br><span class="line">        active.value = 2</span><br><span class="line">      &#125;else if (path.startsWith(&#x27;/personal&#x27;)) &#123;</span><br><span class="line">        active.value = 3</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    // 初始化时设置一次</span><br><span class="line">    updateActiveTab()</span><br><span class="line">    // 监听路由变化</span><br><span class="line">    watch(() =&gt; route.path, updateActiveTab)</span><br><span class="line"></span><br><span class="line">    return &#123; active &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h3 id="路由设置"><a href="#路由设置" class="headerlink" title="路由设置"></a>路由设置</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">HomeView</span> <span class="keyword">from</span> <span class="string">&#x27;@/views/home/HomeView.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//在routes中添加</span></span><br><span class="line">...</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/home&#x27;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;layout&quot;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span> (<span class="string">&quot;../views/layout/FooterView.vue&quot;</span>),</span><br><span class="line">    <span class="attr">children</span>: [</span><br><span class="line">      &#123;<span class="comment">//默认子路由，也就是在导航栏输入.../home默认是打开HomeView这个文件</span></span><br><span class="line">        <span class="attr">path</span>: <span class="string">&quot;&quot;</span>, </span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;home&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="title class_">HomeView</span></span><br><span class="line">        <span class="comment">//component: () =&gt; import (&quot;../views/home/HomeView.vue&quot;),//懒加载</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&quot;/add&quot;</span>, </span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;add&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span> (<span class="string">&quot;../views/edit/EditView.vue&quot;</span>),</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&quot;/userInfo&quot;</span>, </span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;userInfo&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span> (<span class="string">&quot;../views/user/PersonalView.vue&quot;</span>),</span><br><span class="line">      &#125;,</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<h1 id="7-用户信息-显示、退出登录"><a href="#7-用户信息-显示、退出登录" class="headerlink" title="7.用户信息-显示、退出登录"></a>7.用户信息-显示、退出登录</h1><h2 id="逻辑说明-2"><a href="#逻辑说明-2" class="headerlink" title="逻辑说明"></a>逻辑说明</h2><h2 id="界面代码（未实现对接）"><a href="#界面代码（未实现对接）" class="headerlink" title="界面代码（未实现对接）"></a>界面代码（未实现对接）</h2><p>src&#x2F;views&#x2F;user&#x2F;PersonalView.vue</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;myparent&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;myheader&quot;&gt;</span><br><span class="line">      &lt;van-image</span><br><span class="line">        round</span><br><span class="line">        fit=&quot;cover&quot;</span><br><span class="line">        width=&quot;10rem&quot;</span><br><span class="line">        height=&quot;10rem&quot;</span><br><span class="line">        src=&quot;https://fastly.jsdelivr.net/npm/@vant/assets/cat.jpeg&quot;</span><br><span class="line">      /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div class=&quot;mylower&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;editmy&quot;&gt;</span><br><span class="line">        &lt;van-cell title=&quot;姓名&quot; value=&quot;名字&quot; center/&gt;</span><br><span class="line">        &lt;van-cell title=&quot;学工号&quot; value=&quot;201202&quot; center/&gt;</span><br><span class="line">        </span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div class=&quot;thehelp&quot;&gt;</span><br><span class="line">        &lt;van-cell title=&quot;密码&quot; is-link value=&quot;点击修改&quot; center/&gt;</span><br><span class="line">        &lt;van-cell title=&quot;权限&quot; is-link value=&quot;查看和申请&quot; center/&gt;</span><br><span class="line">        &lt;van-cell title=&quot;常见问题&quot; is-link value=&quot;联系我们&quot; center/&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div class=&quot;outlogin&quot;&gt;</span><br><span class="line">        &lt;van-cell  title=&quot;切换账号&quot; @click=&quot;changeUser&quot; center/&gt;</span><br><span class="line">        &lt;van-cell title=&quot;退出&quot; @click=&quot;show = true&quot; center/&gt;</span><br><span class="line">        &lt;van-action-sheet</span><br><span class="line">          v-model:show=&quot;show&quot;</span><br><span class="line">          :actions=&quot;actions&quot;</span><br><span class="line">          cancel-text=&quot;取消&quot;</span><br><span class="line">          close-on-click-action</span><br><span class="line">          @cancel=&quot;onCancel&quot;</span><br><span class="line">          @select=&quot;onSelect&quot;</span><br><span class="line">        /&gt;</span><br><span class="line"></span><br><span class="line">      &lt;/div&gt;     </span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">    </span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;;</span><br><span class="line">import &#123; Dialog, Toast &#125; from &#x27;vant&#x27;;</span><br><span class="line">import &#123; useRouter &#125; from &#x27;vue-router&#x27;;</span><br><span class="line">import &#123; useStore &#125; from &#x27;vuex&#x27;;</span><br><span class="line">export default &#123;</span><br><span class="line">  setup() &#123;</span><br><span class="line">    const show = ref(false);</span><br><span class="line">    const actions = [</span><br><span class="line">      &#123; name: &#x27;退出登录&#x27; , action: &#x27;logout&#x27;&#125;,</span><br><span class="line">      &#123; name: &#x27;关闭软件&#x27; , action: &#x27;close&#x27;&#125;,</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    const router = useRouter();</span><br><span class="line">    const store = useStore();</span><br><span class="line">    const onSelect = (item) =&gt; &#123;</span><br><span class="line">      if(item.action === &#x27;logout&#x27;)&#123;</span><br><span class="line">        //弹出确认框</span><br><span class="line">        Dialog.confirm(&#123;</span><br><span class="line">          title: &quot;确认退出登录么&quot;</span><br><span class="line">        &#125;)</span><br><span class="line">        .then(() =&gt; &#123;</span><br><span class="line">          //点击确认</span><br><span class="line">          router.push(&#x27;/&#x27;);</span><br><span class="line">          Toast(&#x27;已退出登录&#x27;);</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch(() =&gt; &#123;</span><br><span class="line">          //取消退出登录</span><br><span class="line">          Toast(&#x27;取消&#x27;);</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;else if(item.action === &#x27;close&#x27;)&#123;</span><br><span class="line">        Toast(&#x27;关闭软件&#x27;);</span><br><span class="line">      &#125;      </span><br><span class="line">    &#125;;</span><br><span class="line">      </span><br><span class="line">      //点击“取消”按钮，底部弹出框关闭，show值为false</span><br><span class="line">    const onCancel = () =&gt; &#123;</span><br><span class="line">      show.value = false;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    return &#123;</span><br><span class="line">      show,</span><br><span class="line">      actions,</span><br><span class="line">      onSelect,</span><br><span class="line">      onCancel,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h3 id="css部分"><a href="#css部分" class="headerlink" title="css部分"></a>css部分</h3><blockquote>
<p>不要忘了在main.js中引入本文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./styles/index.css&#x27;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p>styles&#x2F;index.css</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*用户信息界面*/</span></span><br><span class="line"><span class="selector-class">.myparent</span>&#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100vh</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100vw</span>;</span><br><span class="line">    <span class="attribute">align-items</span>: center; <span class="comment">/* 水平居中整个内容 */</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.myheader</span>&#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">30%</span>;</span><br><span class="line">    <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">&quot;../assets/background.jpg&quot;</span>);</span><br><span class="line">    <span class="attribute">background-size</span>: contain;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">justify-content</span>: center;</span><br><span class="line">    <span class="attribute">align-items</span>: flex-end;</span><br><span class="line">    <span class="attribute">padding-bottom</span>: <span class="number">8%</span>;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.myparent</span> <span class="selector-class">.myheader</span> <span class="selector-class">.van-image</span>&#123;</span><br><span class="line">    <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">5px</span> <span class="number">0</span> <span class="built_in">rgb</span>(<span class="number">126</span>, <span class="number">123</span>, <span class="number">123</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.mylower</span>&#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="built_in">rgb</span>(<span class="number">228</span>, <span class="number">226</span>, <span class="number">226</span>);</span><br><span class="line">    <span class="attribute">padding-top</span>: <span class="number">0.6rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.mylower</span> <span class="selector-class">.van-cell</span>&#123;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">1.1rem</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">3rem</span>; </span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0.2rem</span> <span class="number">0.5rem</span> <span class="number">0.3rem</span> <span class="number">0.5rem</span>;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.mylower</span> <span class="selector-class">.thehelp</span>&#123;</span><br><span class="line">    <span class="attribute">padding-top</span>: <span class="number">0.6rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.mylower</span> <span class="selector-class">.outlogin</span>&#123;</span><br><span class="line">    <span class="attribute">padding-top</span>: <span class="number">0.6rem</span>;</span><br><span class="line">    <span class="attribute">text-align</span>: center;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="前后端对接"><a href="#前后端对接" class="headerlink" title="前后端对接"></a>前后端对接</h2><h3 id="pinia保存用户token（修改登录"><a href="#pinia保存用户token（修改登录" class="headerlink" title="pinia保存用户token（修改登录"></a>pinia保存用户token（修改登录</h3><blockquote>
<p>使用Pinia状态管理库存储token，否则会出现401无权限报错</p>
</blockquote>
<p>1.安装Pinia：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install pinia</span><br></pre></td></tr></table></figure>

<p>2.在main.js中注册</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createPinia &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> pinia = <span class="title function_">createPinia</span>()</span><br><span class="line">app.<span class="title function_">use</span>(pinia)</span><br></pre></td></tr></table></figure>

<p>3.在src&#x2F;stores目录下定义token.js，实现Store的定义</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&quot;pinia&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;ref&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    defineStore参数描述：</span></span><br><span class="line"><span class="comment">        第一个参数：给状态起名，具有唯一性</span></span><br><span class="line"><span class="comment">        第二个参数：函数，可以把定义该状态中拥有的内容</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    defineStore返回值描述：</span></span><br><span class="line"><span class="comment">        返回的是一个函数，将来可以调用该函数，得到第二个参数中返回的内容</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useTokenStore = <span class="title function_">defineStore</span>(<span class="string">&#x27;token&#x27;</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">//1.定义描述token</span></span><br><span class="line">    <span class="keyword">const</span> token = <span class="title function_">ref</span>(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.定义修改token的方法</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">setToken</span> = (<span class="params">newToken</span>)=&gt;&#123;</span><br><span class="line">        token.<span class="property">value</span> = newToken</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3.定义移除token的方法</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">removeToken</span> = (<span class="params"></span>)=&gt;&#123;</span><br><span class="line">        token.<span class="property">value</span>=<span class="string">&#x27;&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        token,setToken,removeToken</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>4.使用store</p>
<p>在登录LoginView.vue中导入@&#x2F;stores&#x2F;token.js, 并且当用户登录成功后，将token保存pinia中</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">import</span> &#123;useTokenStore&#125; <span class="keyword">from</span> <span class="string">&#x27;@/store/token&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">       ...</span><br><span class="line">        <span class="comment">//调用后台接口，完成登录</span></span><br><span class="line">        <span class="keyword">const</span> tokenStore = <span class="title function_">useTokenStore</span>();</span><br><span class="line">        <span class="keyword">const</span> <span class="title function_">onSubmit</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">            ...</span><br><span class="line">            <span class="keyword">if</span>(res.<span class="property">data</span>.<span class="property">code</span> === <span class="number">0</span>)&#123;</span><br><span class="line">                <span class="comment">//把得到的token存储到pinia中</span></span><br><span class="line">                tokenStore.<span class="title function_">setToken</span>(res.<span class="property">data</span>.<span class="property">data</span>);</span><br><span class="line">                </span><br><span class="line">                <span class="comment">//console.log(&quot;存储的token值&quot;+tokenStore.token);</span></span><br><span class="line">                <span class="title class_">Toast</span>.<span class="title function_">success</span>(<span class="string">&#x27;登陆成功&#x27;</span>);</span><br><span class="line">                router.<span class="title function_">push</span>(<span class="string">&#x27;/home&#x27;</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="title class_">Toast</span>.<span class="title function_">fail</span>(<span class="string">&#x27;学工号或密码错误&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br></pre></td></tr></table></figure>

<h3 id="展示用户信息并存入pinia"><a href="#展示用户信息并存入pinia" class="headerlink" title="展示用户信息并存入pinia"></a>展示用户信息并存入pinia</h3><p>设置src&#x2F;store&#x2F;user.js，定义更新、清空用户数据方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&quot;pinia&quot;</span> <span class="comment">//导入pinia</span></span><br><span class="line"><span class="keyword">import</span> &#123;ref&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useUserInfoStore = <span class="title function_">defineStore</span>(<span class="string">&#x27;userInfo&#x27;</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">//1.定义用户信息</span></span><br><span class="line">    <span class="keyword">const</span> info = <span class="title function_">ref</span>(&#123;&#125;)</span><br><span class="line">    <span class="comment">//2.修改用户信息的方法</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">setInfo</span> = (<span class="params">newInfo</span>)=&gt;&#123;</span><br><span class="line">        info.<span class="property">value</span> = newInfo</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//3.清空用户信息的方法</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">removeInfo</span> = (<span class="params"></span>)=&gt;&#123;</span><br><span class="line">        info.<span class="property">value</span>=&#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span>&#123;info,setInfo,removeInfo&#125;</span><br><span class="line">&#125;,&#123;</span><br><span class="line">    <span class="attr">persist</span>:<span class="literal">true</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>获取用户信息接口</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取用户信息</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getUserInfo</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">//获取token状态</span></span><br><span class="line">    <span class="keyword">const</span> tokenStore = <span class="title function_">useTokenStore</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//通过请求头Authorization携带token</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">         <span class="attr">method</span>: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">         <span class="attr">url</span>: <span class="string">&#x27;/user/userInfo&#x27;</span>,</span><br><span class="line">         <span class="comment">//在pinia中定义的响应式数据，都不需要.value</span></span><br><span class="line">         <span class="attr">headers</span>: &#123; <span class="string">&#x27;Authorization&#x27;</span>: tokenStore.<span class="property">token</span> &#125;</span><br><span class="line">     &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>修改PersonalView.vue,获取用户信息，存入pinia</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;myparent&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;myheader&quot;&gt;</span><br><span class="line">      &lt;van-image</span><br><span class="line">        round</span><br><span class="line">        fit=&quot;cover&quot;</span><br><span class="line">        width=&quot;10rem&quot;</span><br><span class="line">        height=&quot;10rem&quot;</span><br><span class="line">        :src=&quot;userInfoStore.info.userPic? userInfoStore.info.userPic:</span><br><span class="line">         &#x27;https://fastly.jsdelivr.net/npm/@vant/assets/cat.jpeg&#x27;&quot;</span><br><span class="line">      /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div class=&quot;mylower&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;editmy&quot;&gt;</span><br><span class="line">        &lt;van-cell title=&quot;姓名&quot; :value=&quot;userInfoStore.info.userName&quot; center/&gt;</span><br><span class="line">        &lt;van-cell title=&quot;学工号&quot; :value=&quot;userInfoStore.info.userID&quot; center/&gt;</span><br><span class="line">        </span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div class=&quot;thehelp&quot;&gt;</span><br><span class="line">        &lt;van-cell title=&quot;密码&quot; is-link value=&quot;点击修改&quot; to=&quot;/PswEdit&quot; center/&gt;</span><br><span class="line">        &lt;van-cell title=&quot;学院&quot; is-link :value=&quot;userInfoStore.info.userDepartment&quot; center/&gt;</span><br><span class="line">        &lt;van-cell title=&quot;权限&quot; is-link :value=&quot;userAuth&quot; center/&gt;</span><br><span class="line">        ...</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">...</span><br><span class="line">import &#123; getUserInfo &#125; from &#x27;@/api/user&#x27;;</span><br><span class="line">import &#123;useUserInfoStore&#125; from &#x27;@/store/user&#x27;</span><br><span class="line">import &#123;useTokenStore&#125; from &#x27;@/store/token&#x27;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  setup() &#123;</span><br><span class="line">      </span><br><span class="line">    const userAuth = ref(null);</span><br><span class="line">    //获取用户信息并存到pinia中</span><br><span class="line">    const userInfoStore = useUserInfoStore();</span><br><span class="line">    const fetchUserInfo = async () =&gt; &#123;</span><br><span class="line">      try &#123;</span><br><span class="line">        const res = await getUserInfo();</span><br><span class="line">        //console.log(JSON.stringify(res.data)+&quot;服务器返回数据&quot;)</span><br><span class="line">        if (res.data.code === 0) &#123;</span><br><span class="line">          userInfoStore.setInfo(res.data.data);</span><br><span class="line"></span><br><span class="line">          if(userInfoStore.info.userAuth === 1)&#123;</span><br><span class="line">            userAuth.value = &quot;可查看全校学生&quot;;</span><br><span class="line">          &#125;else&#123;</span><br><span class="line">            userAuth.value = &quot;可查看本院学生&quot;;</span><br><span class="line">          &#125;</span><br><span class="line">          </span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          Toast.fail(&#x27;获取用户信息失败&#x27;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; catch (error) &#123;</span><br><span class="line">        Toast.fail(error);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    onMounted(() =&gt; &#123;</span><br><span class="line">      fetchUserInfo();</span><br><span class="line">    &#125;);</span><br><span class="line">...</span><br><span class="line">	return &#123;</span><br><span class="line">      show,</span><br><span class="line">      actions,</span><br><span class="line">      onSelect,</span><br><span class="line">      onCancel,</span><br><span class="line">      userAuth,</span><br><span class="line">      userInfoStore</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h3 id="退出登录和切换账号"><a href="#退出登录和切换账号" class="headerlink" title="退出登录和切换账号"></a>退出登录和切换账号</h3><blockquote>
<p>切换账号和退出登录的逻辑差不多，都是路由跳转+删除pinia中的用户信息和token。</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; useRouter &#125; <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;useTokenStore&#125; <span class="keyword">from</span> <span class="string">&#x27;@/store/token&#x27;</span></span><br><span class="line">...</span><br><span class="line">    <span class="keyword">const</span> router = <span class="title function_">useRouter</span>();</span><br><span class="line">    <span class="keyword">const</span> tokenStore = <span class="title function_">useTokenStore</span>();</span><br><span class="line">	<span class="keyword">const</span> <span class="title function_">changeUser</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">      <span class="comment">//弹出确认框，切换账号</span></span><br><span class="line">        <span class="title class_">Dialog</span>.<span class="title function_">confirm</span>(&#123;</span><br><span class="line">          <span class="attr">title</span>: <span class="string">&quot;确认切换账户么&quot;</span></span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="comment">//点击确认</span></span><br><span class="line">          <span class="comment">//清除pinia中存储的token和个人信息</span></span><br><span class="line">          tokenStore.<span class="title function_">removeToken</span>();</span><br><span class="line">          userInfoStore.<span class="title function_">removeInfo</span>();</span><br><span class="line"></span><br><span class="line">          router.<span class="title function_">push</span>(<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">          <span class="title class_">Toast</span>(<span class="string">&#x27;已退出当前账号&#x27;</span>);</span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">catch</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="comment">//取消切换账号</span></span><br><span class="line">          <span class="title class_">Toast</span>(<span class="string">&#x27;取消&#x27;</span>);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">onSelect</span> = (<span class="params">item</span>) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span>(item.<span class="property">action</span> === <span class="string">&#x27;logout&#x27;</span>)&#123;</span><br><span class="line">        <span class="comment">//弹出确认框</span></span><br><span class="line">        <span class="title class_">Dialog</span>.<span class="title function_">confirm</span>(&#123;</span><br><span class="line">          <span class="attr">title</span>: <span class="string">&quot;确认退出登录么&quot;</span></span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="comment">//点击确认</span></span><br><span class="line">          <span class="comment">//清除pinia中存储的token和个人信息</span></span><br><span class="line">          tokenStore.<span class="title function_">removeToken</span>();</span><br><span class="line">          userInfoStore.<span class="title function_">removeInfo</span>();</span><br><span class="line"></span><br><span class="line">          router.<span class="title function_">push</span>(<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">          <span class="title class_">Toast</span>(<span class="string">&#x27;已退出登录&#x27;</span>);</span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">catch</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="comment">//取消退出登录</span></span><br><span class="line">          <span class="title class_">Toast</span>(<span class="string">&#x27;取消&#x27;</span>);</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;<span class="keyword">else</span> <span class="keyword">if</span>(item.<span class="property">action</span> === <span class="string">&#x27;close&#x27;</span>)&#123;</span><br><span class="line">        <span class="title class_">Toast</span>(<span class="string">&#x27;关闭软件&#x27;</span>);</span><br><span class="line">      &#125;      </span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure>

<h3 id="pinia持久化插件"><a href="#pinia持久化插件" class="headerlink" title="pinia持久化插件"></a>pinia持久化插件</h3><blockquote>
<p>由于pinia是内存存储，刷新页面的时候pinia中的数据会丢失，可以借助于persist插件解决这个问题，persist插件支持将pinia中的数据持久化到sessionStorage和localStorage中</p>
</blockquote>
<p>1.安装persist插件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install pinia-persistedstate-plugin</span><br></pre></td></tr></table></figure>

<p>2.pinia中使用persist插件。修改main.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createPinia &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"><span class="comment">//导入持久化插件</span></span><br><span class="line"><span class="keyword">import</span> &#123;createPersistedState&#125; <span class="keyword">from</span><span class="string">&#x27;pinia-persistedstate-plugin&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(<span class="title class_">App</span>);</span><br><span class="line"><span class="keyword">const</span> pinia = <span class="title function_">createPinia</span>();</span><br><span class="line"><span class="keyword">const</span> persist = <span class="title function_">createPersistedState</span>()</span><br><span class="line"><span class="comment">//pinia使用持久化插件</span></span><br><span class="line">pinia.<span class="title function_">use</span>(persist)</span><br><span class="line"><span class="comment">//使用pinia</span></span><br><span class="line">app.<span class="title function_">use</span>(pinia)</span><br></pre></td></tr></table></figure>

<p>3.在src&#x2F;stores&#x2F;token.js中创建定义状态是配置持久化，添加persit参数。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//定义store</span></span><br><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&quot;pinia&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;ref&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    defineStore参数描述：</span></span><br><span class="line"><span class="comment">        第一个参数：给状态起名，具有唯一性</span></span><br><span class="line"><span class="comment">        第二个参数：函数，可以把定义该状态中拥有的内容</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    defineStore返回值描述：</span></span><br><span class="line"><span class="comment">        返回的是一个函数，将来可以调用该函数，得到第二个参数中返回的内容</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useTokenStore = <span class="title function_">defineStore</span>(<span class="string">&#x27;token&#x27;</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">//1.定义描述token</span></span><br><span class="line">    <span class="keyword">const</span> token = <span class="title function_">ref</span>(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.定义修改token的方法</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">setToken</span> = (<span class="params">newToken</span>)=&gt;&#123;</span><br><span class="line">        token.<span class="property">value</span> = newToken</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3.定义移除token的方法</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">removeToken</span> = (<span class="params"></span>)=&gt;&#123;</span><br><span class="line">        token.<span class="property">value</span>=<span class="string">&#x27;&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        token,setToken,removeToken</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,&#123;</span><br><span class="line">    <span class="attr">persist</span>:<span class="literal">true</span> <span class="comment">//持久化存储</span></span><br><span class="line">&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="请求拦截器设置"><a href="#请求拦截器设置" class="headerlink" title="请求拦截器设置"></a>请求拦截器设置</h3><blockquote>
<p>当进入主页后，将来要与后台交互，都需要携带token，如果每次请求都写这样的代码，将会比较繁琐，此时可以将携带token的代码通过请求拦截器统一处理</p>
</blockquote>
<p>src&#x2F;utils&#x2F;reques.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//导入token状态</span></span><br><span class="line"><span class="keyword">import</span> &#123; useTokenStore &#125; <span class="keyword">from</span> <span class="string">&#x27;@/stores/token.js&#x27;</span>;</span><br><span class="line"><span class="comment">//添加请求拦截器</span></span><br><span class="line">instance.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">use</span>(</span><br><span class="line">    <span class="function">(<span class="params">config</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="comment">//在发送请求之前做什么</span></span><br><span class="line">        <span class="keyword">let</span> tokenStore = <span class="title function_">useTokenStore</span>()</span><br><span class="line">        <span class="comment">//如果token中有值，在携带</span></span><br><span class="line">        <span class="keyword">if</span>(tokenStore.<span class="property">token</span>)&#123;</span><br><span class="line">            config.<span class="property">headers</span>.<span class="property">Authorization</span>=tokenStore.<span class="property">token</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> config</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function">(<span class="params">err</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="comment">//如果请求错误做什么</span></span><br><span class="line">        <span class="title class_">Promise</span>.<span class="title function_">reject</span>(err)</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>配置拦截器后，接口文件中就不用单独设置Authorization了。修改&#x2F;api&#x2F;user.js。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取用户信息</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getUserInfo</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">//获取token状态</span></span><br><span class="line">    <span class="comment">//const tokenStore = useTokenStore();</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//通过请求头Authorization携带token</span></span><br><span class="line">    <span class="comment">// return request(&#123;</span></span><br><span class="line">    <span class="comment">//     method: &#x27;GET&#x27;,</span></span><br><span class="line">    <span class="comment">//     url: &#x27;/user/userInfo&#x27;,</span></span><br><span class="line">    <span class="comment">//     //在pinia中定义的响应式数据，都不需要.value</span></span><br><span class="line">    <span class="comment">//     headers: &#123; &#x27;Authorization&#x27;: tokenStore.token &#125;</span></span><br><span class="line">    <span class="comment">// &#125;);</span></span><br><span class="line">    <span class="keyword">return</span> request.<span class="title function_">get</span>(<span class="string">&#x27;/user/userInfo&#x27;</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="显示个人信息和退出登录完整代码"><a href="#显示个人信息和退出登录完整代码" class="headerlink" title="显示个人信息和退出登录完整代码"></a>显示个人信息和退出登录完整代码</h3><blockquote>
<p>涉及src&#x2F;user&#x2F;PersonalView.vue（界面）、src&#x2F;api&#x2F;user.js（接口）、src&#x2F;utils&#x2F;reques.js(拦截器)、src&#x2F;stores&#x2F;token.js（设置pinia持久化）。。。</p>
</blockquote>
<p>src&#x2F;user&#x2F;PersonalView.vue</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;myparent&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;myheader&quot;&gt;</span><br><span class="line">      &lt;van-image</span><br><span class="line">        round</span><br><span class="line">        fit=&quot;cover&quot;</span><br><span class="line">        width=&quot;10rem&quot;</span><br><span class="line">        height=&quot;10rem&quot;</span><br><span class="line">        :src=&quot;userInfoStore.info.userPic? userInfoStore.info.userPic:</span><br><span class="line">         &#x27;https://fastly.jsdelivr.net/npm/@vant/assets/cat.jpeg&#x27;&quot;</span><br><span class="line">      /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div class=&quot;mylower&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;editmy&quot;&gt;</span><br><span class="line">        &lt;van-cell title=&quot;姓名&quot; :value=&quot;userInfoStore.info.userName&quot; center/&gt;</span><br><span class="line">        &lt;van-cell title=&quot;学工号&quot; :value=&quot;userInfoStore.info.userID&quot; center/&gt;</span><br><span class="line">        </span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div class=&quot;thehelp&quot;&gt;</span><br><span class="line">        &lt;van-cell title=&quot;密码&quot; is-link value=&quot;点击修改&quot; to=&quot;/PwdEdit&quot; center/&gt;</span><br><span class="line">        &lt;van-cell title=&quot;学院&quot; is-link :value=&quot;userInfoStore.info.userDepartment&quot; center/&gt;</span><br><span class="line">        &lt;van-cell title=&quot;权限&quot; is-link :value=&quot;userAuth&quot; center/&gt;</span><br><span class="line">        &lt;van-cell title=&quot;常见问题&quot; is-link value=&quot;联系我们&quot; center/&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div class=&quot;outlogin&quot;&gt;</span><br><span class="line">        &lt;van-cell  title=&quot;切换账号&quot; center/&gt;</span><br><span class="line">        &lt;van-cell title=&quot;退出&quot; @click=&quot;show = true&quot; center/&gt;</span><br><span class="line">        &lt;van-action-sheet</span><br><span class="line">          v-model:show=&quot;show&quot;</span><br><span class="line">          :actions=&quot;actions&quot;</span><br><span class="line">          cancel-text=&quot;取消&quot;</span><br><span class="line">          close-on-click-action</span><br><span class="line">          @cancel=&quot;onCancel&quot;</span><br><span class="line">          @select=&quot;onSelect&quot;</span><br><span class="line">        /&gt;</span><br><span class="line"></span><br><span class="line">      &lt;/div&gt;     </span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">    </span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123; ref ,onMounted&#125; from &#x27;vue&#x27;;</span><br><span class="line">import &#123; Dialog, Toast &#125; from &#x27;vant&#x27;;</span><br><span class="line">import &#123; useRouter &#125; from &#x27;vue-router&#x27;;</span><br><span class="line"></span><br><span class="line">import &#123; getUserInfo &#125; from &#x27;@/api/user&#x27;;</span><br><span class="line">import &#123;useUserInfoStore&#125; from &#x27;@/store/user&#x27;</span><br><span class="line">import &#123;useTokenStore&#125; from &#x27;@/store/token&#x27;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  setup() &#123;</span><br><span class="line"></span><br><span class="line">    //获取用户信息(未存到pinia)</span><br><span class="line">    // const userInfo = ref(&#123;&#125;);</span><br><span class="line">    // const fetchUserInfo = async () =&gt; &#123;</span><br><span class="line">    //   try &#123;</span><br><span class="line">    //     const res = await getUserInfo();</span><br><span class="line">    //     console.log(JSON.stringify(res.data)+&quot;服务器返回数据&quot;)</span><br><span class="line">    //     if (res.data.code === 0) &#123;</span><br><span class="line">    //       userInfo.value = res.data.data;</span><br><span class="line">    //       if(userInfo.value.userAuth === 1)&#123;</span><br><span class="line">    //         userInfo.value.userAuth = &quot;可查看全校学生&quot;</span><br><span class="line">    //       &#125;else&#123;</span><br><span class="line">    //         userInfo.value.userAuth = &quot;可查看本院学生&quot;</span><br><span class="line">    //       &#125;</span><br><span class="line">          </span><br><span class="line">    //     &#125; else &#123;</span><br><span class="line">    //       Toast.fail(&#x27;获取用户信息失败&#x27;);</span><br><span class="line">    //     &#125;</span><br><span class="line">    //   &#125; catch (error) &#123;</span><br><span class="line">    //     Toast.fail(error);</span><br><span class="line">    //   &#125;</span><br><span class="line">    // &#125;;</span><br><span class="line"></span><br><span class="line">    const userAuth = ref(null);</span><br><span class="line">    //获取用户信息并存到pinia中</span><br><span class="line">    const userInfoStore = useUserInfoStore();</span><br><span class="line">    const fetchUserInfo = async () =&gt; &#123;</span><br><span class="line">      try &#123;</span><br><span class="line">        const res = await getUserInfo();</span><br><span class="line">        //console.log(JSON.stringify(res.data)+&quot;服务器返回数据&quot;)</span><br><span class="line">        if (res.data.code === 0) &#123;</span><br><span class="line">          userInfoStore.setInfo(res.data.data);</span><br><span class="line"></span><br><span class="line">          if(userInfoStore.info.userAuth === 1)&#123;</span><br><span class="line">            userAuth.value = &quot;可查看全校学生&quot;;</span><br><span class="line">          &#125;else&#123;</span><br><span class="line">            userAuth.value = &quot;可查看本院学生&quot;;</span><br><span class="line">          &#125;</span><br><span class="line">          </span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          Toast.fail(&#x27;获取用户信息失败&#x27;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; catch (error) &#123;</span><br><span class="line">        Toast.fail(error);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    onMounted(() =&gt; &#123;</span><br><span class="line">      fetchUserInfo();</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    const show = ref(false);</span><br><span class="line">    const actions = [</span><br><span class="line">      &#123; name: &#x27;退出登录&#x27; , action: &#x27;logout&#x27;&#125;,</span><br><span class="line">      &#123; name: &#x27;关闭软件&#x27; , action: &#x27;close&#x27;&#125;,</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    const router = useRouter();</span><br><span class="line">    const tokenStore = useTokenStore();</span><br><span class="line">    const onSelect = (item) =&gt; &#123;</span><br><span class="line">      if(item.action === &#x27;logout&#x27;)&#123;</span><br><span class="line">        //弹出确认框</span><br><span class="line">        Dialog.confirm(&#123;</span><br><span class="line">          title: &quot;确认退出登录么&quot;</span><br><span class="line">        &#125;)</span><br><span class="line">        .then(() =&gt; &#123;</span><br><span class="line">          //点击确认</span><br><span class="line">          //清除pinia中存储的token和个人信息</span><br><span class="line">          tokenStore.removeToken();</span><br><span class="line">          userInfoStore.removeInfo();</span><br><span class="line"></span><br><span class="line">          router.push(&#x27;/&#x27;);</span><br><span class="line">          Toast(&#x27;已退出登录&#x27;);</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch(() =&gt; &#123;</span><br><span class="line">          //取消退出登录</span><br><span class="line">          Toast(&#x27;取消&#x27;);</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;else if(item.action === &#x27;close&#x27;)&#123;</span><br><span class="line">        Toast(&#x27;关闭软件&#x27;);</span><br><span class="line">      &#125;      </span><br><span class="line">    &#125;;</span><br><span class="line">      </span><br><span class="line">      //点击“取消”按钮，底部弹出框关闭，show值为false</span><br><span class="line">    const onCancel = () =&gt; &#123;</span><br><span class="line">      show.value = false;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    return &#123;</span><br><span class="line">      show,</span><br><span class="line">      actions,</span><br><span class="line">      onSelect,</span><br><span class="line">      onCancel,</span><br><span class="line">      userAuth,</span><br><span class="line">      userInfoStore</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p>接口方法src&#x2F;api&#x2F;user.js：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取用户信息</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getUserInfo</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">//获取token状态</span></span><br><span class="line">    <span class="comment">//const tokenStore = useTokenStore();</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//通过请求头Authorization携带token</span></span><br><span class="line">    <span class="comment">// return request(&#123;</span></span><br><span class="line">    <span class="comment">//     method: &#x27;GET&#x27;,</span></span><br><span class="line">    <span class="comment">//     url: &#x27;/user/userInfo&#x27;,</span></span><br><span class="line">    <span class="comment">//     //在pinia中定义的响应式数据，都不需要.value</span></span><br><span class="line">    <span class="comment">//     headers: &#123; &#x27;Authorization&#x27;: tokenStore.token &#125;</span></span><br><span class="line">    <span class="comment">// &#125;);</span></span><br><span class="line">    <span class="keyword">return</span> request.<span class="title function_">get</span>(<span class="string">&#x27;/user/userInfo&#x27;</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h1 id="8-用户信息-修改"><a href="#8-用户信息-修改" class="headerlink" title="8.用户信息-修改"></a>8.用户信息-修改</h1><h2 id="修改密码"><a href="#修改密码" class="headerlink" title="修改密码"></a>修改密码</h2><p>接口文件src&#x2F;api&#x2F;user.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">updatePassword</span>(<span class="params">params</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/user/updataPwd&#x27;</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;patch&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span>: params</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>界面和对接src&#x2F;views&#x2F;user&#x2F;PwdEdit.vue</p>
<blockquote>
<p>点击“找回密码”弹出dialog提示框</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;password-container&quot;&gt;</span><br><span class="line">    &lt;van-nav-bar</span><br><span class="line">      title=&quot;设置密码&quot;</span><br><span class="line">      left-arrow</span><br><span class="line">      @click-left=&quot;$router.back()&quot;</span><br><span class="line">    /&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;div class=&quot;password-content&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;wechat-id&quot;&gt;</span><br><span class="line">        &lt;span class=&quot;label&quot;&gt;学工号&lt;/span&gt;</span><br><span class="line">        &lt;span class=&quot;value&quot;&gt;&#123;&#123;userInfo.userID&#125;&#125;&lt;/span&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      </span><br><span class="line">      &lt;van-form &gt;</span><br><span class="line">        &lt;van-cell-group inset&gt;</span><br><span class="line">          &lt;van-field</span><br><span class="line">            v-model=&quot;form.oldPassword&quot;</span><br><span class="line">            type=&quot;password&quot;</span><br><span class="line">            label=&quot;原密码&quot;</span><br><span class="line">            placeholder=&quot;填写原密码&quot;</span><br><span class="line">            :rules=&quot;[&#123; required: true, message: &#x27;请输入原密码&#x27; &#125;]&quot;</span><br><span class="line">          /&gt;</span><br><span class="line">          </span><br><span class="line">          &lt;van-field</span><br><span class="line">            v-model=&quot;form.newPassword&quot;</span><br><span class="line">            type=&quot;password&quot;</span><br><span class="line">            label=&quot;新密码&quot;</span><br><span class="line">            placeholder=&quot;填写新密码&quot;</span><br><span class="line">            :rules=&quot;passwordRules&quot;</span><br><span class="line">          /&gt;</span><br><span class="line">          </span><br><span class="line">          &lt;van-field</span><br><span class="line">            v-model=&quot;form.confirmPassword&quot;</span><br><span class="line">            type=&quot;password&quot;</span><br><span class="line">            label=&quot;确认密码&quot;</span><br><span class="line">            placeholder=&quot;再次填写确认&quot;</span><br><span class="line">            :rules=&quot;confirmPasswordRules&quot;</span><br><span class="line">          /&gt;</span><br><span class="line">        &lt;/van-cell-group&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;div class=&quot;password-tips&quot;&gt;</span><br><span class="line">          密码必须是8-16位的英文字母、数字、字符组合（不能是纯数字）</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;div class=&quot;forget-password&quot;&gt;</span><br><span class="line">          &lt;span @click=&quot;handleForgetPassword&quot;&gt;忘记原密码？&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;div class=&quot;submit-btn&quot;&gt;</span><br><span class="line">          &lt;van-button</span><br><span class="line">            round</span><br><span class="line">            block</span><br><span class="line">            type=&quot;primary&quot;</span><br><span class="line">            native-type=&quot;submit&quot;</span><br><span class="line">            :loading=&quot;loading&quot;</span><br><span class="line">            @click=&quot;handleSubmit&quot;</span><br><span class="line">          &gt;</span><br><span class="line">            确认修改</span><br><span class="line">          &lt;/van-button&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/van-form&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;;</span><br><span class="line">import &#123; Toast, Dialog &#125; from &#x27;vant&#x27;;</span><br><span class="line">import &#123; useUserInfoStore &#125; from &#x27;@/store/user&#x27;;</span><br><span class="line">import &#123; updatePassword &#125; from &#x27;@/api/user&#x27;;</span><br><span class="line">import &#123; useRouter &#125; from &#x27;vue-router&#x27;;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  setup() &#123;</span><br><span class="line"></span><br><span class="line">    const router = useRouter();</span><br><span class="line">    const userInfoStore = useUserInfoStore();</span><br><span class="line">    const userInfo = ref(&#123;...userInfoStore.info&#125;)</span><br><span class="line"></span><br><span class="line">    const form = ref(&#123;</span><br><span class="line">      oldPassword: &#x27;&#x27;,</span><br><span class="line">      newPassword: &#x27;&#x27;,</span><br><span class="line">      confirmPassword: &#x27;&#x27;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    const loading = ref(false);</span><br><span class="line"></span><br><span class="line">    // 密码验证规则</span><br><span class="line">    const validatePassword = (val) =&gt; &#123;</span><br><span class="line">      if (!val) return &#x27;请输入新密码&#x27;;</span><br><span class="line">      if (val.length &lt; 8 || val.length &gt; 16) return &#x27;密码长度需8-16位&#x27;;</span><br><span class="line">      if (/^\d+$/.test(val)) return &#x27;密码不能是纯数字&#x27;;</span><br><span class="line">      if (!/^[A-Za-z0-9!@#$%^&amp;*()_+]+$/.test(val)) return &#x27;密码需包含字母、数字或特殊字符&#x27;;</span><br><span class="line">      return true;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    const passwordRules = [</span><br><span class="line">      &#123; validator: validatePassword, message: &#x27;密码不符合要求&#x27; &#125;</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    // 确认密码验证规则</span><br><span class="line">    const confirmPasswordRules = [</span><br><span class="line">      &#123; validator: (val) =&gt; val === form.value.newPassword, message: &#x27;两次输入密码不一致&#x27; &#125;</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    // 提交表单</span><br><span class="line">    const handleSubmit = async () =&gt; &#123;</span><br><span class="line">      try &#123;</span><br><span class="line">        loading.value = true; //加载标志</span><br><span class="line">        </span><br><span class="line">        const params = &#123;</span><br><span class="line">          old_pwd: form.value.oldPassword,</span><br><span class="line">          new_pwd: form.value.newPassword,</span><br><span class="line">          re_pwd: form.value.confirmPassword</span><br><span class="line">        &#125;;</span><br><span class="line">        </span><br><span class="line">        const res = await updatePassword(params);</span><br><span class="line">        //console.log(JSON.stringify(res));</span><br><span class="line">        if (res.data.code === 0) &#123;</span><br><span class="line">          </span><br><span class="line">          Toast(&#123;</span><br><span class="line">            message: &#x27;密码修改成功,请重新登录&#x27;,</span><br><span class="line">            duration: 1000,</span><br><span class="line">            onClose: () =&gt; &#123;</span><br><span class="line">              // 密码修改成功后，1s后转到登录页重新登录</span><br><span class="line">              router.push(&#x27;/&#x27;);</span><br><span class="line">              //如果这里存的是普通信息，需要将新信息存入pinia</span><br><span class="line">              //同时应为userInfo是响应式数据，一直都是最新的数据，不用对它进行处理，直接存就行</span><br><span class="line">              //userInfoStore.setInfo(userInfo.value)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;);</span><br><span class="line">          </span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            Toast(res.data.message? res.data.message : &#x27;密码修改失败&#x27;);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125; catch (error) &#123;</span><br><span class="line">          console.error(&#x27;修改密码失败:&#x27;, error);</span><br><span class="line">          Toast(&#x27;请求失败，请稍后重试&#x27;);</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">          loading.value = false;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">    // 忘记密码处理</span><br><span class="line">    const handleForgetPassword = () =&gt; &#123;</span><br><span class="line">      Dialog(&#123;</span><br><span class="line">        title: &#x27;忘记密码&#x27;,</span><br><span class="line">        message: &#x27;请通过安全中心找回密码&#x27;,</span><br><span class="line">        confirmButtonText: &#x27;前往安全中心&#x27;,</span><br><span class="line">        cancelButtonText: &#x27;取消&#x27;</span><br><span class="line">      &#125;).then(() =&gt; &#123;</span><br><span class="line">        // 跳转到找回密码页面</span><br><span class="line">        router.push(&#x27;/forgot-password&#x27;);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    return&#123;</span><br><span class="line">      userInfo,</span><br><span class="line">      passwordRules,</span><br><span class="line">      confirmPasswordRules,</span><br><span class="line">      handleSubmit,</span><br><span class="line">      handleForgetPassword,</span><br><span class="line">      form</span><br><span class="line"></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;</span><br><span class="line">/* 基础rem设置，假设设计稿为375px宽，1rem=16px */</span><br><span class="line">html &#123;</span><br><span class="line">  font-size: 16px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.password-container &#123;</span><br><span class="line">  background-color: #f7f7f7;</span><br><span class="line">  min-height: 100vh;</span><br><span class="line">  </span><br><span class="line">  .password-content &#123;</span><br><span class="line">    padding: 1rem;</span><br><span class="line">    </span><br><span class="line">    .wechat-id &#123;</span><br><span class="line">      display: flex;</span><br><span class="line">      justify-content: space-between;</span><br><span class="line">      align-items: center;</span><br><span class="line">      padding: 0.75rem 1rem;</span><br><span class="line">      background-color: #fff;</span><br><span class="line">      border-radius: 0.5rem;</span><br><span class="line">      margin-bottom: 1rem;</span><br><span class="line">      </span><br><span class="line">      .label &#123;</span><br><span class="line">        font-size: 0.875rem;</span><br><span class="line">        color: #333;</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      .value &#123;</span><br><span class="line">        font-size: 0.875rem;</span><br><span class="line">        color: #999;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    .password-tips &#123;</span><br><span class="line">      font-size: 0.75rem;</span><br><span class="line">      color: #999;</span><br><span class="line">      padding: 0.5rem 1rem;</span><br><span class="line">      margin-top: -0.5rem;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    .forget-password &#123;</span><br><span class="line">      text-align: right;</span><br><span class="line">      padding: 0 1rem;</span><br><span class="line">      margin-top: 0.5rem;</span><br><span class="line">      </span><br><span class="line">      span &#123;</span><br><span class="line">        font-size: 0.75rem;</span><br><span class="line">        color: #1989fa;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    .submit-btn &#123;</span><br><span class="line">      margin: 1.5rem 1rem 0;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h2 id="显示头像大图、修改头像（文件资源库）"><a href="#显示头像大图、修改头像（文件资源库）" class="headerlink" title="显示头像大图、修改头像（文件资源库）*"></a>显示头像大图、修改头像（文件资源库）*</h2><h3 id=""><a href="#" class="headerlink" title="&lt;待修改上传文件服务器&gt;"></a>&lt;待修改上传文件服务器&gt;</h3><p>修改PersonalView.vue</p>
<blockquote>
<p>input组件：上传图像。</p>
<ul>
<li>隐藏显示（<code>display: none</code>）</li>
<li>限制只接受图片文件（<code>accept=&quot;image/*&quot;</code>）</li>
<li>通过<code>ref</code>获取DOM引用<ul>
<li>这里ref&#x3D;fileInput。而ref又绑定了input这个dom元素，所以在script中可以使用fileInput.value去控制input组件。</li>
</ul>
</li>
<li>监听<code>change</code>事件处理文件选择</li>
</ul>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;myparent&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;myheader&quot;&gt;</span><br><span class="line">      &lt;van-image</span><br><span class="line">        round</span><br><span class="line">        fit=&quot;cover&quot;</span><br><span class="line">        width=&quot;10rem&quot;</span><br><span class="line">        height=&quot;10rem&quot;</span><br><span class="line">        :src=&quot;userInfoStore.info.userPic? userInfoStore.info.userPic:</span><br><span class="line">         &#x27;https://fastly.jsdelivr.net/npm/@vant/assets/cat.jpeg&#x27;&quot;</span><br><span class="line">        @click=&quot;showAvatarActions&quot;</span><br><span class="line">      /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    ...</span><br><span class="line">    &lt;!-- 点击头像弹出操作面板 --&gt;</span><br><span class="line">    &lt;van-action-sheet</span><br><span class="line">      v-model:show=&quot;showAvatarSheet&quot;</span><br><span class="line">      :actions=&quot;avatarActions&quot;</span><br><span class="line">      cancel-text=&quot;取消&quot;</span><br><span class="line">      close-on-click-action</span><br><span class="line">      @select=&quot;onAvatarAction&quot;</span><br><span class="line">    /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 头像预览 --&gt;</span><br><span class="line">    &lt;van-image-preview</span><br><span class="line">      v-model:show=&quot;showAvatarPreview&quot;</span><br><span class="line">      :images=&quot;[userInfoStore.info.userPic ?userInfoStore.info.userPic:</span><br><span class="line">       &#x27;https://fastly.jsdelivr.net/npm/@vant/assets/cat.jpeg&#x27;]&quot;</span><br><span class="line">    /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 文件上传组件（隐藏） --&gt;</span><br><span class="line">    &lt;input</span><br><span class="line">      ref=&quot;fileInput&quot;</span><br><span class="line">      type=&quot;file&quot;</span><br><span class="line">      accept=&quot;image/*&quot;</span><br><span class="line">      style=&quot;display: none&quot;</span><br><span class="line">      @change=&quot;handleFileChange&quot;</span><br><span class="line">    /&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>修改部分逻辑：用户点击“从相册选择”这个选项时，触发selectFromAlbum点击事件，这个事件中会判断fileInput.value是否为空，也就是fileInput有没有对应的dom元素。这里fileInput通过ref跟input组件进行了绑定，那fileInput.value &#x3D; <input  type="file"  accept="image/*"  style="display: none"/>。也就是说，现在fileInput.value就是input组件。所以在这里可以通过fileInput.value去调用input组件的点击事件fileInput.value.click()&#x3D;handleFileChange，进行头像上传。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">import &#123; ref ,onMounted&#125; from &#x27;vue&#x27;;</span><br><span class="line">import &#123; Dialog, Toast &#125; from &#x27;vant&#x27;;</span><br><span class="line">import &#123; useRouter &#125; from &#x27;vue-router&#x27;;</span><br><span class="line"></span><br><span class="line">import &#123; getUserInfo &#125; from &#x27;@/api/user&#x27;;</span><br><span class="line">import &#123;useUserInfoStore&#125; from &#x27;@/store/user&#x27;</span><br><span class="line">import &#123;useTokenStore&#125; from &#x27;@/store/token&#x27;</span><br><span class="line">import &#123;updateAvatar&#125; from &#x27;@/api/user&#x27;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  setup() &#123;</span><br><span class="line">...</span><br><span class="line">    const fileInput = ref(null);</span><br><span class="line">    // 头像操作相关状态</span><br><span class="line">    const showAvatarSheet = ref(false);</span><br><span class="line">    const showAvatarPreview = ref(false);</span><br><span class="line"></span><br><span class="line">    // 点击显示头像操作面板</span><br><span class="line">    const showAvatarActions = () =&gt; &#123;</span><br><span class="line">      showAvatarSheet.value = true;</span><br><span class="line">    &#125;;</span><br><span class="line">    // 头像操作选项</span><br><span class="line">    const avatarActions = [</span><br><span class="line">      &#123; name: &#x27;查看头像&#x27;, action: &#x27;view&#x27; &#125;,</span><br><span class="line">      &#123; name: &#x27;拍照&#x27;, action: &#x27;camera&#x27; &#125;,</span><br><span class="line">      &#123; name: &#x27;从相册选择&#x27;, action: &#x27;album&#x27; &#125;</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    // 处理头像操作</span><br><span class="line">    const onAvatarAction = (item) =&gt; &#123;</span><br><span class="line">      switch(item.action) &#123;</span><br><span class="line">        case &#x27;view&#x27;:</span><br><span class="line">          showAvatarPreview.value = true;</span><br><span class="line">          break;</span><br><span class="line">        case &#x27;camera&#x27;:</span><br><span class="line">          takePhoto();</span><br><span class="line">          break;</span><br><span class="line">        case &#x27;album&#x27;:</span><br><span class="line">          selectFromAlbum();</span><br><span class="line">          break;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    // 拍照</span><br><span class="line">    const takePhoto = () =&gt; &#123;</span><br><span class="line">      // 用cordova-plugin-camera或其他拍照插件</span><br><span class="line">      // 这里直接触发文件选择</span><br><span class="line">      if (fileInput.value) &#123;</span><br><span class="line">        fileInput.value.accept = &#x27;image/*;capture=camera&#x27;;</span><br><span class="line">        fileInput.value.click();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    // 从相册选择</span><br><span class="line">    const selectFromAlbum = () =&gt; &#123;</span><br><span class="line">      if (fileInput.value) &#123;</span><br><span class="line">        console.log(fileInput.value);</span><br><span class="line">        fileInput.value.accept = &#x27;image/*&#x27;;</span><br><span class="line">        fileInput.value.click();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    // 处理选择的图片文件</span><br><span class="line">    const handleFileChange = async (e) =&gt; &#123;</span><br><span class="line">      const file = e.target.files[0];</span><br><span class="line">      if (!file) </span><br><span class="line">        return;</span><br><span class="line"></span><br><span class="line">      try &#123;</span><br><span class="line">        // 1. 应该先通过uploadFile接口上传图片到文件服务器获取URL</span><br><span class="line">        // 2. 然后调用更新头像接口</span><br><span class="line">        // const uploadRes = await uploadFile(file);</span><br><span class="line">        // if (uploadRes.data.code !== 0) &#123;</span><br><span class="line">        //   throw new Error(uploadRes.data.message || &#x27;文件上传失败&#x27;);</span><br><span class="line">        // &#125;        </span><br><span class="line">        // const fileUrl = uploadRes.data.data.url; // 假设返回结构中有url字段</span><br><span class="line"></span><br><span class="line">        // const updateRes = await updateAvatar(fileUrl);</span><br><span class="line">        </span><br><span class="line">        // 但是现在没有服务器，这里直接上传</span><br><span class="line">        const formData = new FormData();</span><br><span class="line">        formData.append(&#x27;avatar&#x27;, file);</span><br><span class="line">        </span><br><span class="line">        Toast.loading(&#123;</span><br><span class="line">          message: &#x27;上传中...&#x27;,</span><br><span class="line">          forbidClick: true,</span><br><span class="line">          duration: 0</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        // 调用上传接口</span><br><span class="line">        const res = await updateAvatar(formData);</span><br><span class="line">        </span><br><span class="line">        if (res.data.code === 0) &#123;</span><br><span class="line">          // 更新本地存储的头像信息</span><br><span class="line">          userInfoStore.setInfo(&#123;</span><br><span class="line">            ...userInfoStore.info,</span><br><span class="line">            userPic: res.data.data.avatarUrl // 返回的新的头像URL</span><br><span class="line">           //userPic: fileUrl //有文件服务器应该是这样</span><br><span class="line">          &#125;);</span><br><span class="line">          </span><br><span class="line">          Toast.success(&#x27;头像更新成功&#x27;);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          Toast.fail(res.data.message || &#x27;头像更新失败&#x27;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; catch (error) &#123;</span><br><span class="line">        console.error(&#x27;头像上传失败:&#x27;, error);</span><br><span class="line">        Toast.fail(&#x27;头像上传失败&#x27;);</span><br><span class="line">      &#125; finally &#123;</span><br><span class="line">        // 重置文件输入</span><br><span class="line">        if (fileInput.value) &#123;</span><br><span class="line">          fileInput.value.value = &#x27;&#x27;;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    return &#123;</span><br><span class="line">      show,</span><br><span class="line">      actions,</span><br><span class="line">      onSelect,</span><br><span class="line">      onCancel,</span><br><span class="line">      userAuth,</span><br><span class="line">      userInfoStore,</span><br><span class="line">      showAvatarSheet,</span><br><span class="line">      showAvatarPreview,</span><br><span class="line">      avatarActions,</span><br><span class="line">      fileInput,</span><br><span class="line">      showAvatarActions,</span><br><span class="line">      onAvatarAction,</span><br><span class="line">      handleFileChange</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h2 id="用户部分全部代码"><a href="#用户部分全部代码" class="headerlink" title="用户部分全部代码"></a>用户部分全部代码</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;myparent&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;myheader&quot;&gt;</span><br><span class="line">      &lt;van-image</span><br><span class="line">        round</span><br><span class="line">        fit=&quot;cover&quot;</span><br><span class="line">        width=&quot;10rem&quot;</span><br><span class="line">        height=&quot;10rem&quot;</span><br><span class="line">        :src=&quot;userInfoStore.info.userPic? userInfoStore.info.userPic:</span><br><span class="line">         &#x27;https://fastly.jsdelivr.net/npm/@vant/assets/cat.jpeg&#x27;&quot;</span><br><span class="line">        @click=&quot;showAvatarActions&quot;</span><br><span class="line">      /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div class=&quot;mylower&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;editmy&quot;&gt;</span><br><span class="line">        &lt;van-cell title=&quot;姓名&quot; :value=&quot;userInfoStore.info.userName&quot; center/&gt;</span><br><span class="line">        &lt;van-cell title=&quot;学工号&quot; :value=&quot;userInfoStore.info.userID&quot; center/&gt;</span><br><span class="line">        </span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div class=&quot;thehelp&quot;&gt;</span><br><span class="line">        &lt;van-cell title=&quot;密码&quot; is-link value=&quot;点击修改&quot; to=&quot;/PwdEdit&quot; center/&gt;</span><br><span class="line">        &lt;van-cell title=&quot;学院&quot; is-link :value=&quot;userInfoStore.info.userDepartment&quot; center/&gt;</span><br><span class="line">        &lt;van-cell title=&quot;权限&quot; is-link :value=&quot;userAuth&quot; center/&gt;</span><br><span class="line">        &lt;van-cell title=&quot;常见问题&quot; is-link value=&quot;联系我们&quot; center/&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div class=&quot;outlogin&quot;&gt;</span><br><span class="line">        &lt;van-cell  title=&quot;切换账号&quot; @click=&quot;changeUser&quot; center/&gt;</span><br><span class="line">        &lt;van-cell title=&quot;退出&quot; @click=&quot;show = true&quot; center/&gt;</span><br><span class="line">        &lt;van-action-sheet</span><br><span class="line">          v-model:show=&quot;show&quot;</span><br><span class="line">          :actions=&quot;actions&quot;</span><br><span class="line">          cancel-text=&quot;取消&quot;</span><br><span class="line">          close-on-click-action</span><br><span class="line">          @cancel=&quot;onCancel&quot;</span><br><span class="line">          @select=&quot;onSelect&quot;</span><br><span class="line">        /&gt;</span><br><span class="line"></span><br><span class="line">      &lt;/div&gt;     </span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 点击头像弹出操作面板 --&gt;</span><br><span class="line">    &lt;van-action-sheet</span><br><span class="line">      v-model:show=&quot;showAvatarSheet&quot;</span><br><span class="line">      :actions=&quot;avatarActions&quot;</span><br><span class="line">      cancel-text=&quot;取消&quot;</span><br><span class="line">      close-on-click-action</span><br><span class="line">      @select=&quot;onAvatarAction&quot;</span><br><span class="line">    /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 头像预览 --&gt;</span><br><span class="line">    &lt;van-image-preview</span><br><span class="line">      v-model:show=&quot;showAvatarPreview&quot;</span><br><span class="line">      :images=&quot;[userInfoStore.info.userPic ?userInfoStore.info.userPic:</span><br><span class="line">       &#x27;https://fastly.jsdelivr.net/npm/@vant/assets/cat.jpeg&#x27;]&quot;</span><br><span class="line">    /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 文件上传组件（隐藏） --&gt;</span><br><span class="line">    &lt;input</span><br><span class="line">      ref=&quot;fileInput&quot;</span><br><span class="line">      type=&quot;file&quot;</span><br><span class="line">      accept=&quot;image/*&quot;</span><br><span class="line">      style=&quot;display: none&quot;</span><br><span class="line">      @change=&quot;handleFileChange&quot;</span><br><span class="line">    /&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">    </span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123; ref ,onMounted&#125; from &#x27;vue&#x27;;</span><br><span class="line">import &#123; Dialog, Toast &#125; from &#x27;vant&#x27;;</span><br><span class="line">import &#123; useRouter &#125; from &#x27;vue-router&#x27;;</span><br><span class="line"></span><br><span class="line">import &#123; getUserInfo &#125; from &#x27;@/api/user&#x27;;</span><br><span class="line">import &#123;useUserInfoStore&#125; from &#x27;@/store/user&#x27;</span><br><span class="line">import &#123;useTokenStore&#125; from &#x27;@/store/token&#x27;</span><br><span class="line">import &#123;updateAvatar&#125; from &#x27;@/api/user&#x27;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  setup() &#123;</span><br><span class="line"></span><br><span class="line">    //获取用户信息(未存到pinia)</span><br><span class="line">    // const userInfo = ref(&#123;&#125;);</span><br><span class="line">    // const fetchUserInfo = async () =&gt; &#123;</span><br><span class="line">    //   try &#123;</span><br><span class="line">    //     const res = await getUserInfo();</span><br><span class="line">    //     console.log(JSON.stringify(res.data)+&quot;服务器返回数据&quot;)</span><br><span class="line">    //     if (res.data.code === 0) &#123;</span><br><span class="line">    //       userInfo.value = res.data.data;</span><br><span class="line">    //       if(userInfo.value.userAuth === 1)&#123;</span><br><span class="line">    //         userInfo.value.userAuth = &quot;可查看全校学生&quot;</span><br><span class="line">    //       &#125;else&#123;</span><br><span class="line">    //         userInfo.value.userAuth = &quot;可查看本院学生&quot;</span><br><span class="line">    //       &#125;</span><br><span class="line">          </span><br><span class="line">    //     &#125; else &#123;</span><br><span class="line">    //       Toast.fail(&#x27;获取用户信息失败&#x27;);</span><br><span class="line">    //     &#125;</span><br><span class="line">    //   &#125; catch (error) &#123;</span><br><span class="line">    //     Toast.fail(error);</span><br><span class="line">    //   &#125;</span><br><span class="line">    // &#125;;</span><br><span class="line"></span><br><span class="line">    var userAuth = &quot;可查看本院学生&quot;;</span><br><span class="line">    //获取用户信息并存到pinia中</span><br><span class="line">    const userInfoStore = useUserInfoStore();</span><br><span class="line">    const fetchUserInfo = async () =&gt; &#123;</span><br><span class="line">      try &#123;</span><br><span class="line">        const res = await getUserInfo();</span><br><span class="line">        //console.log(JSON.stringify(res.data)+&quot;服务器返回数据&quot;)</span><br><span class="line">        if (res.data.code === 0) &#123;</span><br><span class="line">          userInfoStore.setInfo(res.data.data);</span><br><span class="line"></span><br><span class="line">          if(userInfoStore.userAuth === 1)&#123;</span><br><span class="line">            userAuth = &quot;可查看全校学生&quot;</span><br><span class="line">          &#125;else&#123;</span><br><span class="line">            userAuth = &quot;可查看本院学生&quot;</span><br><span class="line">          &#125;</span><br><span class="line">          </span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          Toast.fail(&#x27;获取用户信息失败&#x27;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; catch (error) &#123;</span><br><span class="line">        Toast.fail(error);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    onMounted(() =&gt; &#123;</span><br><span class="line">      fetchUserInfo();</span><br><span class="line">    &#125;);    </span><br><span class="line"></span><br><span class="line">    const show = ref(false);</span><br><span class="line">    const actions = [</span><br><span class="line">      &#123; name: &#x27;退出登录&#x27; , action: &#x27;logout&#x27;&#125;,</span><br><span class="line">      &#123; name: &#x27;关闭软件&#x27; , action: &#x27;close&#x27;&#125;,</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    const router = useRouter();</span><br><span class="line">    const tokenStore = useTokenStore();</span><br><span class="line">    const changeUser = () =&gt; &#123;</span><br><span class="line">      //弹出确认框</span><br><span class="line">        Dialog.confirm(&#123;</span><br><span class="line">          title: &quot;确认切换账户么&quot;</span><br><span class="line">        &#125;)</span><br><span class="line">        .then(() =&gt; &#123;</span><br><span class="line">          //点击确认</span><br><span class="line">          //清除pinia中存储的token和个人信息</span><br><span class="line">          tokenStore.removeToken();</span><br><span class="line">          userInfoStore.removeInfo();</span><br><span class="line"></span><br><span class="line">          router.push(&#x27;/&#x27;);</span><br><span class="line">          Toast(&#x27;已退出当前账号&#x27;);</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch(() =&gt; &#123;</span><br><span class="line">          //取消切换账号</span><br><span class="line">          Toast(&#x27;取消&#x27;);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;;</span><br><span class="line">    const onSelect = (item) =&gt; &#123;</span><br><span class="line">      if(item.action === &#x27;logout&#x27;)&#123;</span><br><span class="line">        //弹出确认框</span><br><span class="line">        Dialog.confirm(&#123;</span><br><span class="line">          title: &quot;确认退出登录么&quot;</span><br><span class="line">        &#125;)</span><br><span class="line">        .then(() =&gt; &#123;</span><br><span class="line">          //点击确认</span><br><span class="line">          //清除pinia中存储的token和个人信息</span><br><span class="line">          tokenStore.removeToken();</span><br><span class="line">          userInfoStore.removeInfo();</span><br><span class="line"></span><br><span class="line">          router.push(&#x27;/&#x27;);</span><br><span class="line">          Toast(&#x27;已退出登录&#x27;);</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch(() =&gt; &#123;</span><br><span class="line">          //取消退出登录</span><br><span class="line">          Toast(&#x27;取消&#x27;);</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;else if(item.action === &#x27;close&#x27;)&#123;</span><br><span class="line">        Toast(&#x27;关闭软件&#x27;);</span><br><span class="line">      &#125;      </span><br><span class="line">    &#125;;</span><br><span class="line">      </span><br><span class="line">      //点击“取消”按钮，底部弹出框关闭，show值为false</span><br><span class="line">    const onCancel = () =&gt; &#123;</span><br><span class="line">      show.value = false;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    const fileInput = ref(null);</span><br><span class="line">    // 头像操作相关状态</span><br><span class="line">    const showAvatarSheet = ref(false);</span><br><span class="line">    const showAvatarPreview = ref(false);</span><br><span class="line">    </span><br><span class="line">    // 点击显示头像操作面板</span><br><span class="line">    const showAvatarActions = () =&gt; &#123;</span><br><span class="line">      showAvatarSheet.value = true;</span><br><span class="line">    &#125;;</span><br><span class="line">    // 头像操作选项</span><br><span class="line">    const avatarActions = [</span><br><span class="line">      &#123; name: &#x27;查看头像&#x27;, action: &#x27;view&#x27; &#125;,</span><br><span class="line">      &#123; name: &#x27;拍照&#x27;, action: &#x27;camera&#x27; &#125;,</span><br><span class="line">      &#123; name: &#x27;从相册选择&#x27;, action: &#x27;album&#x27; &#125;</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    // 处理头像操作</span><br><span class="line">    const onAvatarAction = (item) =&gt; &#123;</span><br><span class="line">      switch(item.action) &#123;</span><br><span class="line">        case &#x27;view&#x27;:</span><br><span class="line">          showAvatarPreview.value = true;</span><br><span class="line">          break;</span><br><span class="line">        case &#x27;camera&#x27;:</span><br><span class="line">          takePhoto();</span><br><span class="line">          break;</span><br><span class="line">        case &#x27;album&#x27;:</span><br><span class="line">          selectFromAlbum();</span><br><span class="line">          break;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    // 拍照</span><br><span class="line">    const takePhoto = () =&gt; &#123;</span><br><span class="line">      // 用cordova-plugin-camera或其他拍照插件</span><br><span class="line">      // 这里直接触发文件选择</span><br><span class="line">      if (fileInput.value) &#123;</span><br><span class="line">        fileInput.value.accept = &#x27;image/*;capture=camera&#x27;;</span><br><span class="line">        fileInput.value.click();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    // 从相册选择</span><br><span class="line">    const selectFromAlbum = () =&gt; &#123;</span><br><span class="line">      if (fileInput.value) &#123;</span><br><span class="line">        console.log(fileInput.value);</span><br><span class="line">        fileInput.value.accept = &#x27;image/*&#x27;;</span><br><span class="line">        fileInput.value.click();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    // 处理选择的图片文件</span><br><span class="line">    const handleFileChange = async (e) =&gt; &#123;</span><br><span class="line">      const file = e.target.files[0];</span><br><span class="line">      if (!file) </span><br><span class="line">        return;</span><br><span class="line"></span><br><span class="line">      try &#123;</span><br><span class="line">        // 创建图片URL用于预览</span><br><span class="line">        //const imgUrl = URL.createObjectURL(file);</span><br><span class="line">        </span><br><span class="line">        // 1. 应该先通过uploadFile接口上传图片到文件服务器获取URL</span><br><span class="line">        // 2. 然后调用更新头像接口</span><br><span class="line">        // const uploadRes = await uploadFile(file);</span><br><span class="line">        // if (uploadRes.data.code !== 0) &#123;</span><br><span class="line">        //   throw new Error(uploadRes.data.message || &#x27;文件上传失败&#x27;);</span><br><span class="line">        // &#125;        </span><br><span class="line">        // const fileUrl = uploadRes.data.data.url; // 假设返回结构中有url字段</span><br><span class="line"></span><br><span class="line">        // const updateRes = await updateAvatar(fileUrl);</span><br><span class="line">        </span><br><span class="line">        // 但是现在没有服务器，这里直接上传</span><br><span class="line">        const formData = new FormData();</span><br><span class="line">        formData.append(&#x27;avatar&#x27;, file);</span><br><span class="line">        </span><br><span class="line">        Toast.loading(&#123;</span><br><span class="line">          message: &#x27;上传中...&#x27;,</span><br><span class="line">          forbidClick: true,</span><br><span class="line">          duration: 0</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        // 调用上传接口</span><br><span class="line">        const res = await updateAvatar(formData);</span><br><span class="line">        </span><br><span class="line">        if (res.data.code === 0) &#123;</span><br><span class="line">          // 更新本地存储的头像信息</span><br><span class="line">          userInfoStore.setInfo(&#123;</span><br><span class="line">            ...userInfoStore.info,</span><br><span class="line">            userPic: res.data.data.avatarUrl // 返回的新的头像URL</span><br><span class="line">            //userPic: fileUrl //有文件服务器应该是这样</span><br><span class="line">          &#125;);</span><br><span class="line">          </span><br><span class="line">          Toast.success(&#x27;头像更新成功&#x27;);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          Toast.fail(res.data.message || &#x27;头像更新失败&#x27;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; catch (error) &#123;</span><br><span class="line">        console.error(&#x27;头像上传失败:&#x27;, error);</span><br><span class="line">        Toast.fail(&#x27;头像上传失败&#x27;);</span><br><span class="line">      &#125; finally &#123;</span><br><span class="line">        // 重置文件输入</span><br><span class="line">        if (fileInput.value) &#123;</span><br><span class="line">          fileInput.value.value = &#x27;&#x27;;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    return &#123;</span><br><span class="line">      show,</span><br><span class="line">      actions,</span><br><span class="line">      onSelect,</span><br><span class="line">      onCancel,</span><br><span class="line">      userAuth,</span><br><span class="line">      userInfoStore,</span><br><span class="line">      showAvatarSheet,</span><br><span class="line">      showAvatarPreview,</span><br><span class="line">      avatarActions,</span><br><span class="line">      fileInput,</span><br><span class="line">      showAvatarActions,</span><br><span class="line">      onAvatarAction,</span><br><span class="line">      handleFileChange,</span><br><span class="line">      changeUser</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h1 id="9-主页"><a href="#9-主页" class="headerlink" title="9.主页"></a>9.主页</h1><blockquote>
<p>默认显示权限范围内所有用户信息，可以条件检索，分页修改和跳转。</p>
<p>采用组件插槽方式将代码分开。</p>
</blockquote>
<h2 id="总界面"><a href="#总界面" class="headerlink" title="总界面"></a>总界面</h2><p>src&#x2F;views&#x2F;home&#x2F;HomeView.vue</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;search-page&quot;&gt;</span><br><span class="line">    &lt;search-part /&gt;</span><br><span class="line">    &lt;chart-form /&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import SearchPart from &quot;./SearchPart.vue&quot;;</span><br><span class="line">import ChartForm from &#x27;./ChartForm.vue&#x27;;</span><br><span class="line">export default &#123;</span><br><span class="line">  </span><br><span class="line">  components: &#123;</span><br><span class="line">    SearchPart,</span><br><span class="line">    ChartForm,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h2 id="搜索组件界面"><a href="#搜索组件界面" class="headerlink" title="搜索组件界面"></a>搜索组件界面</h2><p>src&#x2F;views&#x2F;home&#x2F;SearchPart.vue</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;search-container&quot;&gt;</span><br><span class="line">    &lt;!--搜索框--&gt;</span><br><span class="line">    &lt;van-search</span><br><span class="line">      v-model=&quot;searchText&quot;</span><br><span class="line">      placeholder=&quot;请输入学生姓名、学号或电话号码&quot;</span><br><span class="line">      show-action</span><br><span class="line">      @search=&quot;handleSearch&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;template #action&gt;</span><br><span class="line">        &lt;van-button </span><br><span class="line">          type=&quot;primary&quot; </span><br><span class="line">          @click=&quot;handleSearch&quot;</span><br><span class="line">        &gt;</span><br><span class="line">          搜索</span><br><span class="line">        &lt;/van-button&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line">    &lt;/van-search&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--检索条件--&gt;</span><br><span class="line">    &lt;div class=&quot;condition-area&quot;&gt;</span><br><span class="line">      &lt;!--搜索条件dropdown menu--&gt;</span><br><span class="line">      &lt;div class=&quot;upper-panel&quot;&gt;</span><br><span class="line">        &lt;van-dropdown-menu </span><br><span class="line">          :close-on-click-outside=&quot;false&quot;</span><br><span class="line">        &gt;</span><br><span class="line">          &lt;van-dropdown-item </span><br><span class="line">            title=&quot;点击增加筛选条件&quot;</span><br><span class="line">          &gt;</span><br><span class="line">            &lt;template #default&gt;</span><br><span class="line">              &lt;div class=&quot;dropdown-content&quot;&gt;</span><br><span class="line">                &lt;van-cell </span><br><span class="line">                  v-for=&quot;item in conditionItems&quot; </span><br><span class="line">                  :key=&quot;item.value&quot; </span><br><span class="line">                  :title=&quot;item.text&quot;</span><br><span class="line">                  @click=&quot;showInputDialog(item)&quot;</span><br><span class="line">                /&gt;</span><br><span class="line">              &lt;/div&gt;</span><br><span class="line">            &lt;/template&gt;</span><br><span class="line">          &lt;/van-dropdown-item&gt;</span><br><span class="line">        &lt;/van-dropdown-menu&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;van-button</span><br><span class="line">          type=&quot;success&quot; </span><br><span class="line">          class=&quot;clear&quot;</span><br><span class="line">          @click=&quot;SearchClear&quot;</span><br><span class="line">        &gt;</span><br><span class="line">          重置&lt;/van-button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;!--已经选择的条件标签--&gt;</span><br><span class="line">      &lt;div class=&quot;lower-tags&quot;&gt;</span><br><span class="line">        &lt;van-tag</span><br><span class="line">          v-for=&quot;(tag, index) in selectedTags&quot;</span><br><span class="line">          :key=&quot;index&quot;</span><br><span class="line">          closeable</span><br><span class="line">          size=&quot;large&quot;</span><br><span class="line">          type=&quot;primary&quot;</span><br><span class="line">          @close=&quot;removeTag(index)&quot;</span><br><span class="line">        &gt;</span><br><span class="line">          &#123;&#123; tag.pageTagText &#125;&#125;</span><br><span class="line">        &lt;/van-tag&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--学号，分数,生日弹出文本框输入--&gt;</span><br><span class="line">    &lt;van-dialog</span><br><span class="line">      v-model:show=&quot;showRangeDialog&quot;</span><br><span class="line">      :title=&quot;idGrade&quot;</span><br><span class="line">      show-cancel-button</span><br><span class="line">      @confirm=&quot;confirmRange&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;van-field</span><br><span class="line">        v-model=&quot;rangeMin&quot;</span><br><span class="line">        label=&quot;最小值&quot;</span><br><span class="line">        placeholder=&quot;请输入最小值&quot;</span><br><span class="line">      /&gt;</span><br><span class="line">      &lt;van-field</span><br><span class="line">        v-model=&quot;rangeMax&quot;</span><br><span class="line">        label=&quot;最大值&quot;</span><br><span class="line">        placeholder=&quot;请输入最大值&quot;</span><br><span class="line">      /&gt;</span><br><span class="line">    &lt;/van-dialog&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 性别选择动作面板 --&gt;</span><br><span class="line">    &lt;van-action-sheet</span><br><span class="line">      v-model:show=&quot;showSexAction&quot;</span><br><span class="line">      :actions=&quot;sexActions&quot;</span><br><span class="line">      cancel-text=&quot;取消&quot;</span><br><span class="line">      close-on-click-action</span><br><span class="line">      @select=&quot;onSexSelect&quot;</span><br><span class="line">    /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 院系/专业/省份，多选，复选框+单元格呈勾选效果 --&gt;</span><br><span class="line">    &lt;van-action-sheet</span><br><span class="line">      v-model:show=&quot;showMultiSelectAction&quot;</span><br><span class="line">      :title=&quot;multiTitle&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;div class=&quot;multi-select-content&quot;&gt;</span><br><span class="line">        &lt;van-checkbox-group v-model=&quot;multiSelected&quot; ref=&quot;checkboxGroup&quot;&gt;</span><br><span class="line">          &lt;van-cell-group&gt;</span><br><span class="line">            &lt;van-cell</span><br><span class="line">              v-for=&quot;(item, index) in multiSelectOptions&quot;</span><br><span class="line">              :key=&quot;index&quot;</span><br><span class="line">              clickable</span><br><span class="line">              :title=&quot;item.text&quot;</span><br><span class="line">              @click=&quot;toggle(index)&quot;</span><br><span class="line">            &gt;</span><br><span class="line">              &lt;template #right-icon&gt;</span><br><span class="line">                &lt;van-checkbox </span><br><span class="line">                  :name=&quot;item.value&quot; </span><br><span class="line">                  ref=&quot;checkboxes&quot; </span><br><span class="line">                /&gt;</span><br><span class="line">              &lt;/template&gt;</span><br><span class="line">            &lt;/van-cell&gt;</span><br><span class="line">          &lt;/van-cell-group&gt;</span><br><span class="line">        &lt;/van-checkbox-group&gt;</span><br><span class="line">        &lt;div class=&quot;action-sheet-footer&quot;&gt;</span><br><span class="line">          &lt;van-button </span><br><span class="line">            type=&quot;primary&quot; </span><br><span class="line">            block </span><br><span class="line">            @click=&quot;confirmMultiSelect&quot;</span><br><span class="line">          &gt;</span><br><span class="line">            确认</span><br><span class="line">          &lt;/van-button&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/van-action-sheet&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">/* eslint-disable */ </span><br><span class="line">import &#123; ref ,onMounted&#125; from &#x27;vue&#x27;;</span><br><span class="line">import &#123; Toast &#125; from &#x27;vant&#x27;;</span><br><span class="line">import &#123; getDepartments , getMajors &#125; from &#x27;@/api/departmajor&#x27;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  setup() &#123;</span><br><span class="line">    </span><br><span class="line">    // 下拉菜单栏目内容</span><br><span class="line">    const conditionItems = ref([</span><br><span class="line">      &#123; text: &#x27;学号范围&#x27;, value: &#x27;idRange&#x27; &#125;,</span><br><span class="line">      &#123; text: &#x27;选择性别&#x27;, value: &#x27;sex&#x27; &#125;,</span><br><span class="line">      &#123; text: &#x27;生日范围&#x27;, value: &#x27;birth&#x27; &#125;,</span><br><span class="line">      &#123; text: &#x27;院系选择&#x27;, value: &#x27;department&#x27; &#125;,</span><br><span class="line">      &#123; text: &#x27;专业选择&#x27;, value: &#x27;major&#x27; &#125;,</span><br><span class="line">      &#123; text: &#x27;分数范围&#x27;, value: &#x27;grade&#x27; &#125;,</span><br><span class="line">      &#123; text: &#x27;生源省份&#x27;, value: &#x27;originpro&#x27; &#125;,</span><br><span class="line">      &#123; text: &#x27;籍贯选择&#x27;, value: &#x27;nativepro&#x27; &#125;,</span><br><span class="line">    ]);</span><br><span class="line">    </span><br><span class="line">    //确定当前输入的是学号、生日还是分数  </span><br><span class="line">    const currentRangeType = ref(&#x27;&#x27;);  </span><br><span class="line">    //学号、生日、分数输入框标题</span><br><span class="line">    const idGrade = ref(&#x27;&#x27;);</span><br><span class="line">    //输入框默认显示</span><br><span class="line">    const showRangeDialog = ref(false);</span><br><span class="line">    const rangeMin = ref(&#x27;&#x27;);</span><br><span class="line">    const rangeMax = ref(&#x27;&#x27;);</span><br><span class="line">    // 多选动作面板相关</span><br><span class="line">    const multiTitle = ref(&#x27;&#x27;);</span><br><span class="line">    const multiSelectOptions = ref([]);</span><br><span class="line">    const multiSelected = ref([]);</span><br><span class="line">    const showMultiSelectAction = ref(false);</span><br><span class="line">    const currentMultiSelectType = ref(&#x27;&#x27;);    </span><br><span class="line"></span><br><span class="line">    const showInputDialog = (item) =&gt; &#123;</span><br><span class="line">      switch(item.value) &#123;</span><br><span class="line">        case &#x27;idRange&#x27;:</span><br><span class="line">        case &#x27;grade&#x27;:</span><br><span class="line">        case &#x27;birth&#x27;:</span><br><span class="line">          currentRangeType.value = item.value;</span><br><span class="line">          if(item.value === &#x27;idRange&#x27;)&#123;</span><br><span class="line">            idGrade.value = &#x27;请输入学号范围&#x27;;</span><br><span class="line">          &#125; else if(item.value === &#x27;grade&#x27;)&#123;</span><br><span class="line">            idGrade.value = &#x27;请输入分数范围&#x27;;</span><br><span class="line">          &#125; else &#123;</span><br><span class="line">            idGrade.value = &#x27;请输入生日范围&#x27;;</span><br><span class="line">          &#125;</span><br><span class="line">          rangeMin.value = &#x27;&#x27;;</span><br><span class="line">          rangeMax.value = &#x27;&#x27;;</span><br><span class="line">          showRangeDialog.value = true;</span><br><span class="line">          break;</span><br><span class="line">        case &#x27;sex&#x27;:</span><br><span class="line">          showSexAction.value = true;</span><br><span class="line">          break;</span><br><span class="line">        case &#x27;department&#x27;:</span><br><span class="line">          multiTitle.value = &#x27;请选择院系(可多选)&#x27;;</span><br><span class="line">          currentMultiSelectType.value = &#x27;department&#x27;;</span><br><span class="line">          //应该从后端获取</span><br><span class="line">          multiSelectOptions.value = [</span><br><span class="line">              &#123; text: &#x27;计算机学院&#x27;, value: &#x27;cs&#x27; &#125;,</span><br><span class="line">              &#123; text: &#x27;数学学院&#x27;, value: &#x27;math&#x27; &#125;,</span><br><span class="line">            ];</span><br><span class="line">          multiSelected.value = [];</span><br><span class="line">          showMultiSelectAction.value = true;</span><br><span class="line">          break;</span><br><span class="line">        case &#x27;major&#x27;:</span><br><span class="line">          multiTitle.value = &#x27;请选择专业(可多选)&#x27;;</span><br><span class="line">          currentMultiSelectType.value = &#x27;major&#x27;;</span><br><span class="line">              //后端</span><br><span class="line">          multiSelectOptions.value = [</span><br><span class="line">              &#123; text: &#x27;计算机科学与技术&#x27;, value: &#x27;cs&#x27; &#125;,</span><br><span class="line">              &#123; text: &#x27;软件工程&#x27;, value: &#x27;se&#x27; &#125;</span><br><span class="line">          ];    </span><br><span class="line">          multiSelected.value = [];</span><br><span class="line">          showMultiSelectAction.value = true;</span><br><span class="line">          break;</span><br><span class="line">        case &#x27;originpro&#x27;:</span><br><span class="line">        case &#x27;nativepro&#x27;:</span><br><span class="line">          if(item.value === &#x27;originpro&#x27;)&#123;</span><br><span class="line">            multiTitle.value = &#x27;请选择生源地(可多选)&#x27;;</span><br><span class="line">          &#125; else &#123;</span><br><span class="line">            multiTitle.value = &#x27;请选择籍贯(可多选)&#x27;;</span><br><span class="line">          &#125;</span><br><span class="line">          currentMultiSelectType.value = item.value;</span><br><span class="line">              //vant4提供的省份数据</span><br><span class="line">          multiSelectOptions.value = [</span><br><span class="line">              &#123; text: &#x27;北京&#x27;, value: &#x27;beijing&#x27; &#125;,</span><br><span class="line">              &#123; text: &#x27;上海&#x27;, value: &#x27;shanghai&#x27; &#125;];</span><br><span class="line">          multiSelected.value = [];</span><br><span class="line">          showMultiSelectAction.value = true; //展开动作面板</span><br><span class="line">          break;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;  </span><br><span class="line">    </span><br><span class="line">    /*</span><br><span class="line">    **（待实现）下拉菜单内容渲染：1.从后端获取院系、专业，2.vant4提供的省份数据</span><br><span class="line">    */  </span><br><span class="line">   </span><br><span class="line">    /*</span><br><span class="line">    ***选中的条件都要加到标签中，添加标签需要先检查有没有已经存在的同类型标签，如果有，更新标签内容，否则直接添加新标签。</span><br><span class="line">    点×移除标签，直接从存标签的数组中删除</span><br><span class="line">    */  </span><br><span class="line">    //已选择的tag标签 </span><br><span class="line">    const selectedTags = ref([]);  </span><br><span class="line">    const addTag = (tag) =&gt; &#123;</span><br><span class="line">      // 检查是否已存在相同类型的标签</span><br><span class="line">      const existingIndex = selectedTags.value.findIndex(t =&gt; t.type === tag.type);</span><br><span class="line">      if (existingIndex &gt; -1) &#123;</span><br><span class="line">        //修改筛选条件后更新标签所属条目内容，但是标签不重新渲染</span><br><span class="line">        selectedTags.value[existingIndex] = tag;</span><br><span class="line">      &#125; else &#123;//添加新标签</span><br><span class="line">        selectedTags.value.push(tag);       </span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    // 移除标签</span><br><span class="line">    const removeTag = async(index) =&gt; &#123;</span><br><span class="line">      selectedTags.value.splice(index, 1);</span><br><span class="line">    &#125;;  </span><br><span class="line">    </span><br><span class="line">    /*</span><br><span class="line">    ***学号、姓名、生日输入框填写确认处理。点击确认要存到tag标签中</span><br><span class="line">    */  </span><br><span class="line">    const confirmRange = () =&gt; &#123;</span><br><span class="line">      if (!rangeMin.value &amp;&amp; !rangeMax.value) &#123;</span><br><span class="line">        Toast(&#x27;请输入至少一个范围值&#x27;);</span><br><span class="line">        return;</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      let tagText = &#x27;&#x27;;</span><br><span class="line">      if (currentRangeType.value === &#x27;idRange&#x27;) &#123;</span><br><span class="line">        tagText = `学号: $&#123;rangeMin.value&#125; - $&#123;rangeMax.value&#125;`;</span><br><span class="line">      &#125; else if(currentRangeType.value === &#x27;grade&#x27;)&#123;</span><br><span class="line">        tagText = `分数: $&#123;rangeMin.value&#125; - $&#123;rangeMax.value&#125;`;</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        tagText = `生日: $&#123;rangeMin.value&#125; - $&#123;rangeMax.value&#125;`;</span><br><span class="line">      &#125;</span><br><span class="line">      addTag(&#123;</span><br><span class="line">        type: currentRangeType.value,</span><br><span class="line">        //显示到页面上标签中的内容  </span><br><span class="line">        pageTagText: tagText,  </span><br><span class="line">        alltext: tagText,</span><br><span class="line">        value: &#123; min: rangeMin.value, max: rangeMax.value &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">      showRangeDialog.value = false;</span><br><span class="line">    &#125;;  </span><br><span class="line">    </span><br><span class="line">    /*</span><br><span class="line">    ***弹出选择框部分。性别，【院系、专业、籍贯、生源】（多选）</span><br><span class="line">    */  </span><br><span class="line">    //1.性别选择</span><br><span class="line">    const showSexAction = ref(false);</span><br><span class="line">    const sexActions = ref([</span><br><span class="line">      &#123; name: &#x27;男生&#x27;, value: &#x27;male&#x27; &#125;,</span><br><span class="line">      &#123; name: &#x27;女生&#x27;, value: &#x27;female&#x27; &#125;</span><br><span class="line">    ]);</span><br><span class="line">    const onSexSelect = (action) =&gt; &#123;</span><br><span class="line">      //点击添加到标签</span><br><span class="line">      addTag(&#123;</span><br><span class="line">        type: &#x27;sex&#x27;,</span><br><span class="line">        pageTagText: `性别: $&#123;action.name&#125;`,</span><br><span class="line">        alltext: `性别: $&#123;action.name&#125;`,</span><br><span class="line">        value: action.value</span><br><span class="line">      &#125;);</span><br><span class="line">      showSexAction.value = false;</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    //2.四类多选框</span><br><span class="line">    //2.1选择和取消。检查用户点击的multiSelectOptions中的选项index是否已在已选列表中，如果存在（数组下标 &gt; -1），从数组中移除，否则添加到选中的选项数组。</span><br><span class="line">    const toggle = (index) =&gt; &#123;</span><br><span class="line">      const checkbox = multiSelectOptions.value[index];</span><br><span class="line">      const idx = multiSelected.value.indexOf(checkbox.value);</span><br><span class="line">      </span><br><span class="line">      if (idx &gt; -1) &#123;</span><br><span class="line">        multiSelected.value.splice(idx, 1);</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        multiSelected.value.push(checkbox.value);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;; </span><br><span class="line">    //2.2点击确认</span><br><span class="line">    const confirmMultiSelect = () =&gt; &#123;</span><br><span class="line">      if (multiSelected.value.length === 0) &#123;</span><br><span class="line">        Toast(&#x27;请至少选择一项&#x27;);</span><br><span class="line">        return;</span><br><span class="line">      &#125;</span><br><span class="line">      // 筛选出已选的完整选项对象</span><br><span class="line">      const selectedItems = multiSelectOptions.value.filter(item =&gt; </span><br><span class="line">        multiSelected.value.includes(item.value)</span><br><span class="line">      );</span><br><span class="line">      </span><br><span class="line">      let tagText = &#x27;&#x27;;</span><br><span class="line">      let typeText = &#x27;&#x27;;</span><br><span class="line">      </span><br><span class="line">      switch(currentMultiSelectType.value) &#123;</span><br><span class="line">        case &#x27;department&#x27;:</span><br><span class="line">          typeText = &#x27;院系&#x27;;</span><br><span class="line">          break;</span><br><span class="line">        case &#x27;major&#x27;:</span><br><span class="line">          typeText = &#x27;专业&#x27;;</span><br><span class="line">          break;</span><br><span class="line">        case &#x27;originpro&#x27;:</span><br><span class="line">          typeText = &#x27;生源&#x27;;</span><br><span class="line">          break;</span><br><span class="line">        case &#x27;nativepro&#x27;:</span><br><span class="line">          typeText = &#x27;籍贯&#x27;;</span><br><span class="line">          break;</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      tagText = `$&#123;typeText&#125;: $&#123;selectedItems.map(item =&gt; item.text).join(&#x27;, &#x27;)&#125;`;</span><br><span class="line">      </span><br><span class="line">      addTag(&#123;</span><br><span class="line">        type: currentMultiSelectType.value,</span><br><span class="line">        pageTagText: tagText,</span><br><span class="line">        alltext: tagText,</span><br><span class="line">        //value: multiSelected.value</span><br><span class="line">        value: [...multiSelected.value]</span><br><span class="line">      &#125;);</span><br><span class="line">      </span><br><span class="line">      showMultiSelectAction.value = false; //关闭面板</span><br><span class="line">    &#125;;  </span><br><span class="line">  </span><br><span class="line">     </span><br><span class="line"></span><br><span class="line">    // 搜索处理</span><br><span class="line">    const handleSearch = () =&gt; &#123;</span><br><span class="line">        Toast(&#x27;搜索成功&#x27;);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    //重置条件</span><br><span class="line">    const SearchClear = async () =&gt; &#123;</span><br><span class="line">      searchText.value = &#x27;&#x27;;</span><br><span class="line">      selectedTags.value = [];</span><br><span class="line">    &#125;;</span><br><span class="line">      </span><br><span class="line">    return &#123;</span><br><span class="line">      searchText,</span><br><span class="line">      conditionItems,</span><br><span class="line">      selectedTags,</span><br><span class="line">      showRangeDialog,</span><br><span class="line">      rangeMin,</span><br><span class="line">      rangeMax,</span><br><span class="line">      showSexAction,</span><br><span class="line">      sexActions,</span><br><span class="line">      showMultiSelectAction,</span><br><span class="line">      multiSelectOptions,</span><br><span class="line">      multiSelected,</span><br><span class="line">      showInputDialog,</span><br><span class="line">      confirmRange,</span><br><span class="line">      onSexSelect,</span><br><span class="line">      toggle,</span><br><span class="line">      confirmMultiSelect,</span><br><span class="line">      removeTag,</span><br><span class="line">      handleSearch,</span><br><span class="line">      idGrade,</span><br><span class="line">      multiTitle,</span><br><span class="line">      SearchClear,</span><br><span class="line"></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">/* styles/search.css */</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h3 id="获取院系、专业渲染到下拉菜单"><a href="#获取院系、专业渲染到下拉菜单" class="headerlink" title="获取院系、专业渲染到下拉菜单"></a>获取院系、专业渲染到下拉菜单</h3><p>1.从后端获取院系、专业接口：src&#x2F;api&#x2F;departmajor.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&quot;@/utils/request&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取权限范围内的院系列表</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">getDepartments</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/departMajor/departments&#x27;</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取权限范围内的专业列表</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">getMajors</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/departMajor/majors&#x27;</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2.由于后面新增学生、修改学生信息界面都要用到这部分信息，将其存到pinia中，避免重复获取：src&#x2F;store&#x2F;departmentMajor.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Toast</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;vant&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getCombinations , getDepartments , getMajors &#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/departmajor&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useDepartmentMajorStore = <span class="title function_">defineStore</span>(<span class="string">&#x27;departmentMajor&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 院系数据</span></span><br><span class="line">  <span class="keyword">const</span> departments = <span class="title function_">ref</span>([]);</span><br><span class="line">  <span class="comment">// 专业数据</span></span><br><span class="line">  <span class="keyword">const</span> majors = <span class="title function_">ref</span>([]);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 标记数据是否已加载</span></span><br><span class="line">  <span class="keyword">const</span> isDataLoaded = <span class="title function_">ref</span>(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 加载院系和专业数据</span></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">loadDepartmentMajorData</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (isDataLoaded.<span class="property">value</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">// 获取院系数据</span></span><br><span class="line">      <span class="keyword">const</span> deptResponse = <span class="keyword">await</span> <span class="title function_">getDepartments</span>();</span><br><span class="line">      <span class="keyword">if</span> (deptResponse.<span class="property">data</span>.<span class="property">code</span> === <span class="number">0</span>) &#123;</span><br><span class="line">        departments.<span class="property">value</span> = deptResponse.<span class="property">data</span>.<span class="property">data</span>.<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> (&#123;</span><br><span class="line">          <span class="attr">text</span>: item,</span><br><span class="line">          <span class="attr">value</span>: item</span><br><span class="line">        &#125;));</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 获取专业数据</span></span><br><span class="line">      <span class="keyword">const</span> majorResponse = <span class="keyword">await</span> <span class="title function_">getMajors</span>();</span><br><span class="line">      <span class="keyword">if</span> (majorResponse.<span class="property">data</span>.<span class="property">code</span> === <span class="number">0</span>) &#123;</span><br><span class="line">        majors.<span class="property">value</span> = majorResponse.<span class="property">data</span>.<span class="property">data</span>.<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> (&#123;</span><br><span class="line">          <span class="attr">text</span>: item,</span><br><span class="line">          <span class="attr">value</span>: item</span><br><span class="line">        &#125;));</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 标记数据已加载</span></span><br><span class="line">      isDataLoaded.<span class="property">value</span> = <span class="literal">true</span>;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;加载院系专业数据失败:&#x27;</span>, error);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">removeInfo</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    departments.<span class="property">value</span> = [];</span><br><span class="line">    majors.<span class="property">value</span> = [];</span><br><span class="line">    isDataLoaded.<span class="property">value</span> = <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    departments,</span><br><span class="line">    majors,</span><br><span class="line">    loadDepartmentMajorData,</span><br><span class="line">    removeInfo</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;,&#123;</span><br><span class="line">    <span class="attr">persist</span>:<span class="literal">true</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>3.修改src&#x2F;views&#x2F;home&#x2F;SearchPart.js的js部分</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt; </span><br><span class="line">...</span><br><span class="line"><span class="keyword">import</span> &#123; useDepartmentMajorStore &#125; <span class="keyword">from</span> <span class="string">&#x27;@/store/departmentMajor&#x27;</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">    <span class="comment">// 多选动作面板相关</span></span><br><span class="line">    <span class="keyword">const</span> multiTitle = <span class="title function_">ref</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">    <span class="keyword">const</span> multiSelectOptions = <span class="title function_">ref</span>([]);</span><br><span class="line">    <span class="keyword">const</span> multiSelected = <span class="title function_">ref</span>([]);</span><br><span class="line">    <span class="keyword">const</span> showMultiSelectAction = <span class="title function_">ref</span>(<span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">const</span> currentMultiSelectType = <span class="title function_">ref</span>(<span class="string">&#x27;&#x27;</span>);    </span><br><span class="line">    <span class="keyword">const</span> departmentMajorStore = <span class="title function_">useDepartmentMajorStore</span>();  </span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">showInputDialog</span> = (<span class="params">item</span>) =&gt; &#123;</span><br><span class="line">      <span class="keyword">switch</span>(item.<span class="property">value</span>) &#123;</span><br><span class="line">        ...</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;department&#x27;</span>:</span><br><span class="line">          multiTitle.<span class="property">value</span> = <span class="string">&#x27;请选择院系(可多选)&#x27;</span>;</span><br><span class="line">          currentMultiSelectType.<span class="property">value</span> = <span class="string">&#x27;department&#x27;</span>;</span><br><span class="line">          <span class="comment">//后端获取</span></span><br><span class="line">          multiSelectOptions.<span class="property">value</span> = departmentMajorStore.<span class="property">departments</span>;</span><br><span class="line">          multiSelected.<span class="property">value</span> = [];</span><br><span class="line">          showMultiSelectAction.<span class="property">value</span> = <span class="literal">true</span>;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;major&#x27;</span>:</span><br><span class="line">          multiTitle.<span class="property">value</span> = <span class="string">&#x27;请选择专业(可多选)&#x27;</span>;</span><br><span class="line">          currentMultiSelectType.<span class="property">value</span> = <span class="string">&#x27;major&#x27;</span>;</span><br><span class="line">          multiSelectOptions.<span class="property">value</span> = departmentMajorStore.<span class="property">majors</span>;</span><br><span class="line">          multiSelected.<span class="property">value</span> = [];</span><br><span class="line">          showMultiSelectAction.<span class="property">value</span> = <span class="literal">true</span>;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;originpro&#x27;</span>:</span><br><span class="line">        ...</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;  </span><br><span class="line">    </span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    **下拉菜单内容渲染：1.从后端获取院系、专业，2.vant4提供的省份数据</span></span><br><span class="line"><span class="comment">    */</span>  </span><br><span class="line">    <span class="comment">// 组件挂载时加载院系、专业数据</span></span><br><span class="line">    <span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      departmentMajorStore.<span class="title function_">loadDepartmentMajorData</span>();</span><br><span class="line">    &#125;); </span><br><span class="line">    </span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    ***选中的条件都要加到标签中，添加标签需要先检查有没有已经存在的同类型标签，如果有，更新标签内容，否则直接添加新标签。</span></span><br><span class="line"><span class="comment">    点×移除标签，直接从存标签的数组中删除</span></span><br><span class="line"><span class="comment">    */</span>  </span><br><span class="line">    ...</span><br><span class="line">   </span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h3 id="获取省份信息"><a href="#获取省份信息" class="headerlink" title="获取省份信息"></a>获取省份信息</h3><p>修改src&#x2F;views&#x2F;home&#x2F;SearchPart.js的js部分</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">...    </span><br><span class="line"><span class="keyword">import</span> &#123; areaList &#125; <span class="keyword">from</span> <span class="string">&#x27;@vant/area-data&#x27;</span>; <span class="comment">// 导入区域数据</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">showInputDialog</span> = (<span class="params">item</span>) =&gt; &#123;</span><br><span class="line">      <span class="keyword">switch</span>(item.<span class="property">value</span>) &#123;</span><br><span class="line">        ...</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;originpro&#x27;</span>:</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;nativepro&#x27;</span>:</span><br><span class="line">          <span class="keyword">if</span>(item.<span class="property">value</span> === <span class="string">&#x27;originpro&#x27;</span>)&#123;</span><br><span class="line">            multiTitle.<span class="property">value</span> = <span class="string">&#x27;请选择生源地(可多选)&#x27;</span>;</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            multiTitle.<span class="property">value</span> = <span class="string">&#x27;请选择籍贯(可多选)&#x27;</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          currentMultiSelectType.<span class="property">value</span> = item.<span class="property">value</span>;</span><br><span class="line">          multiSelectOptions.<span class="property">value</span> = <span class="title function_">getProvinces</span>();</span><br><span class="line">          multiSelected.<span class="property">value</span> = [];</span><br><span class="line">          showMultiSelectAction.<span class="property">value</span> = <span class="literal">true</span>; <span class="comment">//展开动作面板</span></span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;  </span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">	<span class="comment">// 组件挂载时加载院系、专业数据</span></span><br><span class="line">    <span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      departmentMajorStore.<span class="title function_">loadDepartmentMajorData</span>();</span><br><span class="line">    &#125;); </span><br><span class="line">    <span class="comment">// 获取省份数据</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">getProvinces</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (!areaList || !areaList.<span class="property">province_list</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;区域数据加载失败&#x27;</span>);</span><br><span class="line">        <span class="keyword">return</span> [];</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="title function_">entries</span>(areaList.<span class="property">province_list</span>).<span class="title function_">map</span>(<span class="function">(<span class="params">[code, name]</span>) =&gt;</span> (&#123;</span><br><span class="line">        <span class="attr">text</span>: name,</span><br><span class="line">        <span class="attr">value</span>: name,</span><br><span class="line">        <span class="attr">code</span>: code</span><br><span class="line">      &#125;));</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    ***选中的条件都要加到标签中，添加标签需要先检查有没有已经存在的同类型标签，如果有，更新标签内容，否则直接添加新标签。</span></span><br><span class="line"><span class="comment">    点×移除标签，直接从存标签的数组中删除</span></span><br><span class="line"><span class="comment">    */</span>  </span><br><span class="line">    ...</span><br><span class="line">   </span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h2 id="表格组件界面"><a href="#表格组件界面" class="headerlink" title="表格组件界面"></a>表格组件界面</h2><p>src&#x2F;views&#x2F;home&#x2F;TableChart.vue</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;student-table-container&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;table-home&quot;&gt;</span><br><span class="line">      &lt;!-- 使用原生table元素 --&gt;</span><br><span class="line">      &lt;table class=&quot;student-table&quot;&gt;</span><br><span class="line">        &lt;thead&gt;</span><br><span class="line">          &lt;tr&gt;</span><br><span class="line">            &lt;th v-for=&quot;column in columns&quot; :key=&quot;column.key&quot; </span><br><span class="line">                :class=&quot;&#123; &#x27;sortable&#x27;: column.sortable &#125;&quot;&gt;</span><br><span class="line">              &#123;&#123; column.title &#125;&#125;</span><br><span class="line">            &lt;/th&gt;</span><br><span class="line">          &lt;/tr&gt;</span><br><span class="line">        &lt;/thead&gt;</span><br><span class="line">        &lt;tbody&gt;</span><br><span class="line">          &lt;!-- 内容加载过程中展示一组占位图形 --&gt;</span><br><span class="line">          &lt;tr v-if=&quot;loading&quot;&gt;</span><br><span class="line">            &lt;td colspan=&quot;6&quot;&gt;</span><br><span class="line">              &lt;van-skeleton :row=&quot;pageSize&quot; /&gt;</span><br><span class="line">            &lt;/td&gt;</span><br><span class="line">          &lt;/tr&gt;</span><br><span class="line">          &lt;tr v-else v-for=&quot;(row, index) in tableData&quot; :key=&quot;row.id&quot;</span><br><span class="line">              :class=&quot;&#123; &#x27;striped&#x27;: index % 2 === 0 &#125;&quot;&gt;</span><br><span class="line">            &lt;td v-for=&quot;column in columns&quot; :key=&quot;column.key&quot;&gt;</span><br><span class="line">              &lt;template v-if=&quot;column.key === &#x27;action&#x27;&quot;&gt;</span><br><span class="line">                &lt;div class=&quot;action-buttons&quot;&gt;</span><br><span class="line">                  &lt;van-icon name=&quot;eye-o&quot; @click=&quot;showDetail(row)&quot; /&gt;</span><br><span class="line">                  &lt;van-icon name=&quot;edit&quot; @click=&quot;editStudent(row)&quot; /&gt;</span><br><span class="line">                  &lt;van-icon name=&quot;delete-o&quot; @click=&quot;deleteStudent(row)&quot; /&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">              &lt;/template&gt;</span><br><span class="line">              &lt;template v-else&gt;</span><br><span class="line">                &#123;&#123; row[column.key] &#125;&#125;</span><br><span class="line">              &lt;/template&gt;</span><br><span class="line">            &lt;/td&gt;</span><br><span class="line">          &lt;/tr&gt;</span><br><span class="line">        &lt;/tbody&gt;</span><br><span class="line">      &lt;/table&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 分页区域 --&gt;</span><br><span class="line">    &lt;div class=&quot;pagination-container&quot;&gt;</span><br><span class="line">      &lt;van-pagination</span><br><span class="line">        v-model=&quot;currentPage&quot;</span><br><span class="line">        :items-per-page=&quot;pageSize&quot;</span><br><span class="line">        :total-items=&quot;total&quot;</span><br><span class="line">        :show-page-size=&quot;5&quot;</span><br><span class="line">        @change=&quot;handlePageChange&quot;</span><br><span class="line">        class=&quot;pagination&quot;</span><br><span class="line">        force-ellipses</span><br><span class="line">      /&gt;</span><br><span class="line"></span><br><span class="line">      &lt;div class=&quot;page-size-selector&quot;&gt;</span><br><span class="line">        &lt;span&gt;每页显示：&lt;/span&gt;</span><br><span class="line">        &lt;van-field</span><br><span class="line">          v-model=&quot;pageSizeInput&quot;</span><br><span class="line">          type=&quot;number&quot;</span><br><span class="line">          placeholder=&quot;输入条数&quot;</span><br><span class="line">          class=&quot;page-size-input&quot;</span><br><span class="line">        /&gt;</span><br><span class="line">        &lt;van-button </span><br><span class="line">          type=&quot;primary&quot; </span><br><span class="line">          size=&quot;small&quot; </span><br><span class="line">          @click=&quot;handlePageSizeChange&quot;</span><br><span class="line">          class=&quot;confirm-btn&quot;</span><br><span class="line">        &gt;</span><br><span class="line">          确定</span><br><span class="line">        &lt;/van-button&gt;</span><br><span class="line">        &lt;van-dropdown-menu class=&quot;pdf-word&quot; :close-on-click-outside=&quot;true&quot; direction=&quot;up&quot;&gt;</span><br><span class="line">          &lt;van-dropdown-item </span><br><span class="line">            v-model=&quot;dropdownValue&quot; </span><br><span class="line">            :options=&quot;dropdownOptions&quot;</span><br><span class="line">            title=&quot;导出数据&quot;</span><br><span class="line">          &gt;</span><br><span class="line">            &lt;template #default&gt;</span><br><span class="line">              &lt;div class=&quot;dropdown-content&quot;&gt;</span><br><span class="line">                &lt;van-cell </span><br><span class="line">                  v-for=&quot;item in conditionItems&quot; </span><br><span class="line">                  :key=&quot;item.value&quot; </span><br><span class="line">                  :title=&quot;item.text&quot;</span><br><span class="line">                  @click=&quot;showInputDialog(item)&quot;</span><br><span class="line">                /&gt;</span><br><span class="line">              &lt;/div&gt;</span><br><span class="line">            &lt;/template&gt;</span><br><span class="line">          &lt;/van-dropdown-item&gt;</span><br><span class="line">        &lt;/van-dropdown-menu&gt;</span><br><span class="line">      &lt;/div&gt;      </span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;;</span><br><span class="line">import &#123; Dialog, Toast &#125; from &#x27;vant&#x27;;</span><br><span class="line">import &#123; getStudents , deleteStu&#125; from &#x27;@/api/student&#x27;;</span><br><span class="line">import router from &#x27;@/router&#x27;;</span><br><span class="line"></span><br><span class="line">// 表头设置，sortable用来做排序，暂时未实现</span><br><span class="line">const columns = [</span><br><span class="line">  &#123; key: &#x27;stuID&#x27;, title: &#x27;学号&#x27;, sortable: true &#125;,</span><br><span class="line">  &#123; key: &#x27;name&#x27;, title: &#x27;姓名&#x27;, sortable: true &#125;,</span><br><span class="line">  &#123; key: &#x27;gender&#x27;, title: &#x27;性别&#x27;, sortable: true &#125;,</span><br><span class="line">  &#123; key: &#x27;department&#x27;, title: &#x27;院系&#x27;, sortable: true &#125;,</span><br><span class="line">  &#123; key: &#x27;major&#x27;, title: &#x27;专业&#x27;, sortable: true &#125;,</span><br><span class="line">  &#123; key: &#x27;action&#x27;, title: &#x27;操作&#x27;, sortable: false &#125;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">// 表格数据</span><br><span class="line">const tableData = ref([]);</span><br><span class="line">const loading = ref(false);</span><br><span class="line">const currentPage = ref(1);</span><br><span class="line">const pageSize = ref(10);</span><br><span class="line">const pageSizeInput = ref(10);</span><br><span class="line">const total = ref(0);</span><br><span class="line"></span><br><span class="line">// 处理页码变化</span><br><span class="line">const handlePageChange = (page) =&gt; &#123;</span><br><span class="line">  currentPage.value = page;</span><br><span class="line">  //重新渲染表格  </span><br><span class="line">  fetchData();  </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">// 用户输入每页显示条数</span><br><span class="line">const handlePageSizeChange = () =&gt; &#123;</span><br><span class="line">  const newSize = parseInt(pageSizeInput.value);</span><br><span class="line">    //获取输入的每页条数后，重新渲染表格，设置每页显示条数，当前页设为第一页</span><br><span class="line">  if (newSize &gt; 0 &amp;&amp; newSize &lt;= 100) &#123;</span><br><span class="line">    pageSize.value = newSize;</span><br><span class="line">    currentPage.value = 1;</span><br><span class="line">    //重新渲染表格</span><br><span class="line">      fetchData();</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    Toast(&#x27;请输入1-100之间的数字&#x27;);</span><br><span class="line">    pageSizeInput.value = pageSize.value;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">// 从后端获取学生数据,渲染到表格上</span><br><span class="line">const fetchData = () =&gt; &#123;</span><br><span class="line">  console.log(&quot;学生信息&quot;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">// 显示学生详情</span><br><span class="line">const showDetail = (student) =&gt; &#123;</span><br><span class="line">  console.log(student);</span><br><span class="line">  router.push(&#x27;/edit&#x27;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">// 编辑学生信息</span><br><span class="line">const editStudent = (student) =&gt; &#123;</span><br><span class="line">  console.log(student);</span><br><span class="line">  router.push(&#x27;/edit&#x27;);//应该还要改isEdit状态</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">// 删除学生</span><br><span class="line">const deleteStudent = (student) =&gt; &#123;</span><br><span class="line">  console.log(&quot;删除信息&quot;);</span><br><span class="line">&#125;;</span><br><span class="line">    </span><br><span class="line">//打印部分</span><br><span class="line">const dropdownValue = ref(0);</span><br><span class="line">const dropdownOptions = ref([]);</span><br><span class="line">// 下拉菜单栏目内容</span><br><span class="line">const conditionItems = ref([</span><br><span class="line">  &#123; text: &#x27;导出到excel&#x27;, value: &#x27;excel&#x27; &#125;,</span><br><span class="line">  &#123; text: &#x27;导出到word&#x27;, value: &#x27;word&#x27; &#125;,</span><br><span class="line">]);</span><br><span class="line">//打印事件</span><br><span class="line">const showInputDialog = (item) =&gt; &#123;</span><br><span class="line">  if(item.value === &#x27;excel&#x27;)&#123;</span><br><span class="line">    exportToExcel();</span><br><span class="line">  &#125;else&#123;</span><br><span class="line">    console.log(&quot;打印word&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">//导出到excel</span><br><span class="line">const exportToExcel = () =&gt;&#123;</span><br><span class="line">    console.log(&quot;导出到excel&quot;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.student-table-container &#123;</span><br><span class="line">  margin-bottom: 4rem;</span><br><span class="line">  background-color: #fffffff0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.table-home &#123;</span><br><span class="line">  margin: 0.6rem;</span><br><span class="line">  background-color: #fff;</span><br><span class="line">  border-radius: 8px;</span><br><span class="line">  box-shadow: 3px 2px 12px 2px rgba(0, 0, 0, 0.1);</span><br><span class="line">  overflow-x: auto; /* 允许水平滚动 */</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 表格样式 */</span><br><span class="line">.student-table &#123;</span><br><span class="line">  width: fit-content; /* 宽度由内容自动撑起 */</span><br><span class="line">  min-width: 100%; /* 至少占满容器宽度 */</span><br><span class="line">  border-collapse: collapse;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 表头样式 */</span><br><span class="line">.student-table th &#123;</span><br><span class="line">  font-weight: bold;</span><br><span class="line">  background-color: #f7f8fa;</span><br><span class="line">  border-bottom: 0.2rem solid #ebedf0b1;</span><br><span class="line">  padding: 0.4rem; /* 设置padding为0.4rem */</span><br><span class="line">  text-align: center;</span><br><span class="line">  vertical-align: middle;</span><br><span class="line">  white-space: nowrap; /* 防止标题换行 */</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.sortable &#123;</span><br><span class="line">  cursor: pointer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.sortable:hover &#123;</span><br><span class="line">  color: #1989fa;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 表格内容样式 */</span><br><span class="line">.student-table td &#123;</span><br><span class="line">  padding: 0.6rem;   </span><br><span class="line">  white-space: nowrap; /* 防止内容换行 */</span><br><span class="line">  overflow: hidden; /* 超出内容隐藏 */</span><br><span class="line">  text-overflow: ellipsis; /* 超出内容显示省略号 */</span><br><span class="line">&#125;</span><br><span class="line">.student-table tr&#123;</span><br><span class="line">    text-align: center;</span><br><span class="line">    vertical-align: middle;</span><br><span class="line">    border-bottom: 1px solid #f5f5f5da;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.striped &#123;</span><br><span class="line">  background-color: #fafafa;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 操作按钮样式 */</span><br><span class="line">.action-buttons &#123;</span><br><span class="line">  display: flex;</span><br><span class="line">  justify-content: space-around;</span><br><span class="line">  align-items: center;</span><br><span class="line">  padding: 0.4rem; /* 设置padding为0.4rem */</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.action-buttons .van-icon &#123;</span><br><span class="line">  font-size: 18px;</span><br><span class="line">  cursor: pointer;</span><br><span class="line">  padding: 0 4px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.action-buttons .van-icon:hover &#123;</span><br><span class="line">  color: #1989fa;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 分页样式 */</span><br><span class="line">.pagination-container &#123;</span><br><span class="line">  margin-top: 0.2rem;</span><br><span class="line">  margin: 0.2rem 0.9rem;</span><br><span class="line">  padding: .4rem 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.page-size-selector &#123;</span><br><span class="line">  display: flex;</span><br><span class="line">  align-items: center;</span><br><span class="line">  justify-content: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.page-size-selector span &#123;</span><br><span class="line">  flex: 1;</span><br><span class="line">  margin-right: 0.4rem;</span><br><span class="line">  font-size: 14px;</span><br><span class="line">  color: #646566;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.page-size-selector .page-size-input &#123;</span><br><span class="line">  flex: 2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.page-size-selector .confirm-btn &#123;</span><br><span class="line">  flex: 1;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="在表格中显示学生数据和删除单条信息"><a href="#在表格中显示学生数据和删除单条信息" class="headerlink" title="在表格中显示学生数据和删除单条信息"></a>在表格中显示学生数据和删除单条信息</h2><p>获得和删除学生信息接口：src&#x2F;api&#x2F;student.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&quot;@/utils/request&quot;</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">**</span></span><br><span class="line"><span class="comment"> * 获取全部学生信息分页列表</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">Object</span>&#125; params 查询参数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">number</span>&#125; params.pageNum 当前页码</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">number</span>&#125; params.pageSize 每页条数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">getStudents</span>(<span class="params">params</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/student/conditionSearch&#x27;</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">    <span class="attr">params</span>: &#123;</span><br><span class="line">      <span class="attr">pageNum</span>: params.<span class="property">pageNum</span>,</span><br><span class="line">      <span class="attr">pageSize</span>: params.<span class="property">pageSize</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//删除学生</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">deleteStu</span>(<span class="params">stuID</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&#x27;/student/deleteStu&#x27;</span>,</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&#x27;delete&#x27;</span>,</span><br><span class="line">        <span class="attr">params</span>: &#123; stuID &#125;  <span class="comment">// 这里不能用data，因为后端用@RequestParam接收</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>sec&#x2F;views&#x2F;home&#x2F;TableChart.vue</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref, onMounted &#125; from &#x27;vue&#x27;;</span><br><span class="line">import &#123; Dialog, Toast &#125; from &#x27;vant&#x27;;</span><br><span class="line">import &#123; getStudents , deleteStu&#125; from &#x27;@/api/student&#x27;;</span><br><span class="line">import router from &#x27;@/router&#x27;;</span><br><span class="line"></span><br><span class="line">// 表头设置，sortable用来做排序，暂时未实现</span><br><span class="line">const columns = [</span><br><span class="line">  &#123; key: &#x27;stuID&#x27;, title: &#x27;学号&#x27;, sortable: true &#125;,</span><br><span class="line">  &#123; key: &#x27;name&#x27;, title: &#x27;姓名&#x27;, sortable: true &#125;,</span><br><span class="line">  &#123; key: &#x27;gender&#x27;, title: &#x27;性别&#x27;, sortable: true &#125;,</span><br><span class="line">  &#123; key: &#x27;department&#x27;, title: &#x27;院系&#x27;, sortable: true &#125;,</span><br><span class="line">  &#123; key: &#x27;major&#x27;, title: &#x27;专业&#x27;, sortable: true &#125;,</span><br><span class="line">  &#123; key: &#x27;action&#x27;, title: &#x27;操作&#x27;, sortable: false &#125;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">// 表格数据</span><br><span class="line">const tableData = ref([]);</span><br><span class="line">const loading = ref(false);</span><br><span class="line">const currentPage = ref(1);</span><br><span class="line">const pageSize = ref(10);</span><br><span class="line">const pageSizeInput = ref(10);</span><br><span class="line">const total = ref(0);</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">// 从后端获取学生数据</span><br><span class="line">const fetchData = async () =&gt; &#123;</span><br><span class="line">  try &#123;</span><br><span class="line">    loading.value = true;</span><br><span class="line">    const response = await getStudents(&#123;</span><br><span class="line">      pageNum: currentPage.value,</span><br><span class="line">      pageSize: pageSize.value,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    if (response.data.code === 0) &#123;</span><br><span class="line">      tableData.value = response.data.data.items || [];</span><br><span class="line">      total.value = response.data.data.total || 0;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      Toast(response.data.message || &#x27;数据加载失败&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; catch (error) &#123;</span><br><span class="line">    Toast(&#x27;网络请求失败&#x27;);</span><br><span class="line">    console.error(&#x27;Error fetching data:&#x27;, error);</span><br><span class="line">  &#125; finally &#123;</span><br><span class="line">    loading.value = false;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">// 删除学生</span><br><span class="line">const deleteStudent = (student) =&gt; &#123;</span><br><span class="line">  Dialog.confirm(&#123;</span><br><span class="line">    title: &quot;确认删除&quot;,</span><br><span class="line">    message: `确定要删除学生 $&#123;student.name&#125; ($&#123;student.stuID&#125;) 吗？`,</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(async () =&gt; &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">      const response = await deleteStu(student.stuID);</span><br><span class="line">      </span><br><span class="line">      if (response.data.code === 0) &#123;</span><br><span class="line">        Toast.success(&#x27;删除成功&#x27;);</span><br><span class="line">        fetchData(); </span><br><span class="line">        </span><br><span class="line">        // 如果当前页数据删空了且不是第一页，则自动返回上一页</span><br><span class="line">        if (tableData.value.length === 1 &amp;&amp; currentPage.value &gt; 1) &#123;</span><br><span class="line">          currentPage.value -= 1;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        Toast.fail(response.message || &#x27;删除失败&#x27;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; catch (error) &#123;</span><br><span class="line">      console.error(&#x27;删除失败:&#x27;, error);</span><br><span class="line">      Toast.fail(&#x27;删除请求失败&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(() =&gt; &#123;</span><br><span class="line">    Toast(&#x27;取消&#x27;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">// 组件挂载时获取数据</span><br><span class="line">onMounted(() =&gt; &#123;</span><br><span class="line">  fetchData();</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h3 id="使用pinia存当前学生信息-删除"><a href="#使用pinia存当前学生信息-删除" class="headerlink" title="使用pinia存当前学生信息+删除"></a>使用pinia存当前学生信息+删除</h3><blockquote>
<p>主页表格中点击“查看当前学生详情”按钮图标的时，需要将详细信息传入edit页面。这里先修改主页表格部分，使用pinia来存当前学生信息。</p>
</blockquote>
<p>获得带分页、不带分页学生信息以及删除的接口实现src&#x2F;api&#x2F;students.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="comment">//获取所有学生，不带分页，用于edit页查找上、下一个学生</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">getAllWithoutPage</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> request.<span class="title function_">get</span>(<span class="string">&#x27;/student/getAllWithoutPage&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在pinia中获得、删除学生：src&#x2F;store&#x2F;student.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; getStudents, getAllWithoutPage , deleteStu &#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/student&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useStudentStore = <span class="title function_">defineStore</span>(<span class="string">&#x27;student&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 当前页学生信息</span></span><br><span class="line">  <span class="keyword">const</span> students = <span class="title function_">ref</span>([]);</span><br><span class="line">  <span class="comment">// 全部学生信息</span></span><br><span class="line">  <span class="keyword">const</span> allStudents = <span class="title function_">ref</span>([]);</span><br><span class="line">  <span class="comment">//当前所在页的页码</span></span><br><span class="line">  <span class="keyword">const</span> currentPage = <span class="title function_">ref</span>(<span class="number">1</span>);</span><br><span class="line">  <span class="comment">//每页应该显示的学生信息条数</span></span><br><span class="line">  <span class="keyword">const</span> pageSize = <span class="title function_">ref</span>(<span class="number">10</span>);</span><br><span class="line">  <span class="comment">//总数据量</span></span><br><span class="line">  <span class="keyword">const</span> total = <span class="title function_">ref</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="comment">//当前选中的学生</span></span><br><span class="line">  <span class="keyword">const</span> currentStudent = <span class="title function_">ref</span>(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 设置当前学生</span></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">setCurrentStudent</span> = (<span class="params">student</span>) =&gt; &#123;</span><br><span class="line">    currentStudent.<span class="property">value</span> = student;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 获取当前页学生数据</span></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">fetchStudents</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">getStudents</span>(&#123;</span><br><span class="line">        <span class="attr">pageNum</span>: currentPage.<span class="property">value</span>,</span><br><span class="line">        <span class="attr">pageSize</span>: pageSize.<span class="property">value</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="keyword">if</span> (response.<span class="property">data</span>.<span class="property">code</span> === <span class="number">0</span>) &#123;</span><br><span class="line">        students.<span class="property">value</span> = response.<span class="property">data</span>.<span class="property">data</span>.<span class="property">items</span> || [];</span><br><span class="line">        total.<span class="property">value</span> = response.<span class="property">data</span>.<span class="property">data</span>.<span class="property">total</span> || <span class="number">0</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> response;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Error fetching students:&#x27;</span>, error);</span><br><span class="line">      <span class="keyword">throw</span> error;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 获取全部学生数据</span></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">fetchAllStudents</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">getAllWithoutPage</span>();</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">if</span> (response.<span class="property">data</span>.<span class="property">code</span> === <span class="number">0</span>) &#123;</span><br><span class="line">        allStudents.<span class="property">value</span> = response.<span class="property">data</span>.<span class="property">data</span> || [];</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//console.log(&quot;数组长度&quot;+allStudents.value.length);</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> response;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Error fetching all students:&#x27;</span>, error);</span><br><span class="line">      <span class="keyword">throw</span> error;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 删除学生（同步更新当前页和全部学生数据）</span></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">deleteStudent</span> = <span class="keyword">async</span> (<span class="params">studentId</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">deleteStu</span>(studentId);</span><br><span class="line">      <span class="keyword">if</span> (response.<span class="property">data</span>.<span class="property">code</span> === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// 从当前页数据中移除</span></span><br><span class="line">        students.<span class="property">value</span> = students.<span class="property">value</span>.<span class="title function_">filter</span>(<span class="function"><span class="params">s</span> =&gt;</span> s.<span class="property">stuID</span> !== studentId);</span><br><span class="line">        <span class="comment">// 从全部数据中移除</span></span><br><span class="line">        allStudents.<span class="property">value</span> = allStudents.<span class="property">value</span>.<span class="title function_">filter</span>(<span class="function"><span class="params">s</span> =&gt;</span> s.<span class="property">stuID</span> !== studentId);</span><br><span class="line">        total.<span class="property">value</span> -= <span class="number">1</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 如果删除的是当前学生，重置当前学生</span></span><br><span class="line">        <span class="keyword">if</span> (currentStudent.<span class="property">value</span>?.<span class="property">stuID</span> === studentId) &#123;</span><br><span class="line">          currentStudent.<span class="property">value</span> = <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> response;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Error deleting student:&#x27;</span>, error);</span><br><span class="line">      <span class="keyword">throw</span> error;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    students,</span><br><span class="line">    currentPage,</span><br><span class="line">    pageSize,</span><br><span class="line">    total,</span><br><span class="line">    currentStudent,</span><br><span class="line">    fetchStudents,</span><br><span class="line">    allStudents,</span><br><span class="line">    deleteStudent,</span><br><span class="line">    setCurrentStudent,  </span><br><span class="line">    fetchAllStudents,</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;,&#123;</span><br><span class="line">    <span class="attr">persist</span>:<span class="literal">true</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="修改表格组件中显示、删除信息部分代码"><a href="#修改表格组件中显示、删除信息部分代码" class="headerlink" title="修改表格组件中显示、删除信息部分代码"></a>修改表格组件中显示、删除信息部分代码</h3><p>src&#x2F;views&#x2F;home&#x2F;TableChart.vue</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref, onMounted ,computed , watch&#125; from &#x27;vue&#x27;;</span><br><span class="line">import &#123; Dialog, Toast &#125; from &#x27;vant&#x27;;</span><br><span class="line">import &#123; useStudentStore &#125; from &#x27;@/store/student&#x27;;</span><br><span class="line">import router from &#x27;@/router&#x27;;</span><br><span class="line"></span><br><span class="line">// 表头设置</span><br><span class="line">const columns = [</span><br><span class="line">  &#123; key: &#x27;stuID&#x27;, title: &#x27;学号&#x27;, sortable: true &#125;,</span><br><span class="line">  &#123; key: &#x27;name&#x27;, title: &#x27;姓名&#x27;, sortable: true &#125;,</span><br><span class="line">  &#123; key: &#x27;gender&#x27;, title: &#x27;性别&#x27;, sortable: true &#125;,</span><br><span class="line">  &#123; key: &#x27;department&#x27;, title: &#x27;院系&#x27;, sortable: true &#125;,</span><br><span class="line">  &#123; key: &#x27;major&#x27;, title: &#x27;专业&#x27;, sortable: true &#125;,</span><br><span class="line">  &#123; key: &#x27;action&#x27;, title: &#x27;操作&#x27;, sortable: false &#125;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">//从store获取学生数据，并且一打开页面就挂载获得数据，然后将数据渲染到表格</span><br><span class="line">//1.刚打开页面，默认一页显示10条，当前页设为第一页。在pinia中已设置，这里直接调用封装的方法。</span><br><span class="line">const loading = ref(false);</span><br><span class="line">const studentStore = useStudentStore();</span><br><span class="line">const fetchData = async () =&gt; &#123;</span><br><span class="line">  try &#123;</span><br><span class="line">    loading.value = true;</span><br><span class="line">    await studentStore.fetchStudents();</span><br><span class="line"></span><br><span class="line">  &#125; catch (error) &#123;</span><br><span class="line">    Toast(&#x27;数据加载失败&#x27;);</span><br><span class="line">    console.error(&#x27;Error fetching data:&#x27;, error);</span><br><span class="line">  &#125; finally &#123;</span><br><span class="line">    loading.value = false;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">onMounted(() =&gt; &#123;</span><br><span class="line">  fetchData();</span><br><span class="line">&#125;);</span><br><span class="line">//2.将数据渲染到表格，pinia中的fetchStudents会将数据存到students数组中，这里使用计算属性自动获取</span><br><span class="line">const tableData = computed(() =&gt; studentStore.students);</span><br><span class="line"></span><br><span class="line">//刚打开页面，当前所在页、每页显示条数和实际显示条数都用初始值，在pinia中设置初始值。</span><br><span class="line">//1.无动作，用get方法获取pinia中存的值。如果用户有重新设值、点击页码，用computed的set方法进行更新</span><br><span class="line">const currentPage = computed(&#123;</span><br><span class="line">  get: () =&gt; studentStore.currentPage,</span><br><span class="line">  set: (val) =&gt; &#123; studentStore.currentPage = val; &#125;</span><br><span class="line">&#125;);//当前所在页</span><br><span class="line">const pageSize = computed(&#123;</span><br><span class="line">  get: () =&gt; studentStore.pageSize,</span><br><span class="line">  set: (val) =&gt; &#123; studentStore.pageSize = val; &#125;</span><br><span class="line">&#125;);//每页应该显示的数据条数</span><br><span class="line">const total = computed(() =&gt; studentStore.total); //每页实际显示的数据条数</span><br><span class="line"></span><br><span class="line">//2.用户重新设置每页显示条数</span><br><span class="line">//pageSizeInput初始为pinia中设的每页应该显示条数的初始值。</span><br><span class="line">//用这个双向绑定用户输入的每页显示的条数，然后点击确认，触发事件。</span><br><span class="line">const pageSizeInput = ref(studentStore.pageSize);</span><br><span class="line">const handlePageSizeChange = () =&gt; &#123;</span><br><span class="line">  const newSize = parseInt(pageSizeInput.value);</span><br><span class="line">  if (newSize &gt; 0 &amp;&amp; newSize &lt;= 50) &#123;</span><br><span class="line">    //将新的值存入pinia，当前所在页设为1，重新渲染表格。</span><br><span class="line">    pageSize.value = newSize;</span><br><span class="line">    currentPage.value = 1;</span><br><span class="line">    fetchData();</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    Toast(&#x27;请输入1-100之间的数字&#x27;);</span><br><span class="line">      //重新显示原本的条数</span><br><span class="line">    pageSizeInput.value = pageSize.value;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">// 监听pageSize变化，自动更新输入框值</span><br><span class="line">watch(() =&gt; studentStore.pageSize, (newVal) =&gt; &#123;</span><br><span class="line">  pageSizeInput.value = newVal;</span><br><span class="line">&#125;);    </span><br><span class="line"></span><br><span class="line">// 用户点击页码，改变当前所在页，渲染新页面的表格数据</span><br><span class="line">const handlePageChange = (page) =&gt; &#123;</span><br><span class="line">  currentPage.value = page;</span><br><span class="line">  fetchData();</span><br><span class="line">&#125;;</span><br><span class="line">    </span><br><span class="line">//显示、编辑、删除学生</span><br><span class="line">// 显示学生详情，将点击的学生设为当前学生，跳转到edit页面。在edit页面，从pinia中获取CurrentStudent，将信息渲染到页面</span><br><span class="line">const showDetail = (student) =&gt; &#123;</span><br><span class="line">  studentStore.setCurrentStudent(student);</span><br><span class="line">  router.push(&#x27;/edit&#x27;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">// 编辑学生信息</span><br><span class="line">const editStudent = (student) =&gt; &#123;</span><br><span class="line">  studentStore.setCurrentStudent(student);</span><br><span class="line">  router.push(&#x27;/edit&#x27;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">// 删除学生</span><br><span class="line">const deleteStudent = (student) =&gt; &#123;</span><br><span class="line">  Dialog.confirm(&#123;</span><br><span class="line">    title: &quot;确认删除&quot;,</span><br><span class="line">    message: `确定要删除学生 $&#123;student.name&#125; ($&#123;student.stuID&#125;) 吗？`,</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(async () =&gt; &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">      await studentStore.deleteStudent(student.stuID);</span><br><span class="line">      Toast.success(&#x27;删除成功&#x27;);</span><br><span class="line">      </span><br><span class="line">      // 如果当前页数据删空了且不是第一页，则自动返回上一页</span><br><span class="line">      if (tableData.value.length === 0 &amp;&amp; studentStore.currentPage &gt; 1) &#123;</span><br><span class="line">        studentStore.currentPage -= 1;</span><br><span class="line">        fetchData();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; catch (error) &#123;</span><br><span class="line">      console.error(&#x27;删除失败:&#x27;, error);</span><br><span class="line">      Toast.fail(&#x27;删除失败&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(() =&gt; &#123;</span><br><span class="line">    Toast(&#x27;取消&#x27;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h2 id="搜索组件-条件检索"><a href="#搜索组件-条件检索" class="headerlink" title="搜索组件-条件检索"></a>搜索组件-条件检索</h2><p>因为条件检索结果还是分页显示到表格中，所以修改条件检索接口：src&#x2F;api&#x2F;student.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">**</span></span><br><span class="line"><span class="comment"> * 获取全部学生信息分页列表</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">Object</span>&#125; params 查询参数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">number</span>&#125; params.pageNum 当前页码</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">number</span>&#125; params.pageSize 每页条数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">getStudents</span>(<span class="params">params</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/student/conditionSearch&#x27;</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span>: params.<span class="property">queryDTO</span>, <span class="comment">// 用data发送检索条件请求体</span></span><br><span class="line">    <span class="attr">params</span>: &#123;</span><br><span class="line">      <span class="comment">//queryDTO: params.queryDTO,</span></span><br><span class="line">      <span class="attr">pageNum</span>: params.<span class="property">pageNum</span>,</span><br><span class="line">      <span class="attr">pageSize</span>: params.<span class="property">pageSize</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改src&#x2F;views&#x2F;home&#x2F;SearchPart.vue的js部分</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">import &#123; ref ,onMounted&#125; from &#x27;vue&#x27;;</span><br><span class="line">import &#123; Toast &#125; from &#x27;vant&#x27;;</span><br><span class="line">import &#123; areaList &#125; from &#x27;@vant/area-data&#x27;; // 导入区域数据</span><br><span class="line">import &#123; useStudentStore &#125; from &#x27;@/store/student&#x27;;</span><br><span class="line">import &#123; useDepartmentMajorStore &#125; from &#x27;@/store/departmentMajor&#x27;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  setup() &#123;</span><br><span class="line">    ...  </span><br><span class="line">    // 移除标签</span><br><span class="line">    const removeTag = async(index) =&gt; &#123;</span><br><span class="line">      selectedTags.value.splice(index, 1);</span><br><span class="line">      if(selectedTags.value.length === 0 &amp;&amp; searchText.value === &#x27;&#x27;)&#123;</span><br><span class="line">        studentStore.lastQuery = null;</span><br><span class="line">        studentStore.currentPage = 1;</span><br><span class="line">        await studentStore.fetchStudents(&#123;&#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;  </span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">    //将输入框中内容和添加的筛选条件提交到后端</span><br><span class="line">    const searchText = ref(&#x27;&#x27;);</span><br><span class="line">    const buildSearchParams = () =&gt; &#123;</span><br><span class="line">      //const params = &#123;&#125;;</span><br><span class="line">      const params = &#123;</span><br><span class="line">        majors: [],</span><br><span class="line">        departments: [],</span><br><span class="line">        originPros: [],</span><br><span class="line">        nativePros: []</span><br><span class="line">      &#125;;</span><br><span class="line">      </span><br><span class="line">      // 处理搜索框输入</span><br><span class="line">      if (searchText.value) &#123;</span><br><span class="line">          //纯数字为电话或学号</span><br><span class="line">        if (/^\d+$/.test(searchText.value)) &#123;</span><br><span class="line">          searchText.value.length === 11 </span><br><span class="line">            ? params.tel = searchText.value</span><br><span class="line">            : params.stuID = searchText.value;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          params.name = searchText.value;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      // 处理已选择的筛选条件</span><br><span class="line">      selectedTags.value.forEach(tag =&gt; &#123;</span><br><span class="line">        const rawValue = JSON.parse(JSON.stringify(tag.value));</span><br><span class="line">        </span><br><span class="line">        switch(tag.type) &#123;</span><br><span class="line">          case &#x27;idRange&#x27;:</span><br><span class="line">            if (rawValue.min) params.stuIDMin = rawValue.min;</span><br><span class="line">            if (rawValue.max) params.stuIDMax = rawValue.max;</span><br><span class="line">            break;</span><br><span class="line">          case &#x27;sex&#x27;:</span><br><span class="line">            params.gender = rawValue === &#x27;male&#x27; ? &#x27;男&#x27; : &#x27;女&#x27;;</span><br><span class="line">            break;</span><br><span class="line">          case &#x27;birth&#x27;:</span><br><span class="line">            if (rawValue.min) params.birthMin = rawValue.min;</span><br><span class="line">            if (rawValue.max) params.birthMax = rawValue.max;</span><br><span class="line">            break;</span><br><span class="line">          case &#x27;department&#x27;:</span><br><span class="line">            //加个判断是不是数组</span><br><span class="line">            params.departments = Array.isArray(rawValue) ? rawValue : [rawValue];</span><br><span class="line">            break;</span><br><span class="line">          case &#x27;major&#x27;:</span><br><span class="line">            params.majors = Array.isArray(rawValue) ? rawValue : [rawValue];</span><br><span class="line">            break;</span><br><span class="line">          case &#x27;grade&#x27;:</span><br><span class="line">            if (rawValue.min) params.gradeMin = rawValue.min;</span><br><span class="line">            if (rawValue.max) params.gradeMax = rawValue.max;</span><br><span class="line">            break;</span><br><span class="line">          case &#x27;originpro&#x27;:</span><br><span class="line">            params.originPros = Array.isArray(rawValue) ? rawValue : [rawValue];</span><br><span class="line">            break;</span><br><span class="line">          case &#x27;nativepro&#x27;:</span><br><span class="line">            params.nativePros = Array.isArray(rawValue) ? rawValue : [rawValue];</span><br><span class="line">            break;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">  </span><br><span class="line">      // 移除空数组</span><br><span class="line">      Object.keys(params).forEach(key =&gt; &#123;</span><br><span class="line">        if (Array.isArray(params[key]) &amp;&amp; params[key].length === 0) &#123;</span><br><span class="line">          delete params[key];</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">      </span><br><span class="line">      //console.log(&#x27;构建的参数对象:&#x27;, JSON.parse(JSON.stringify(params)));</span><br><span class="line">      return params;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    // 搜索处理</span><br><span class="line">    const studentStore = useStudentStore();</span><br><span class="line">    const handleSearch = async () =&gt; &#123;</span><br><span class="line">      try &#123;</span><br><span class="line">          //构建参数</span><br><span class="line">        const searchParams = buildSearchParams();</span><br><span class="line">        // 重置到第一页</span><br><span class="line">        studentStore.currentPage = 1</span><br><span class="line">        await studentStore.fetchStudents(searchParams);</span><br><span class="line">        Toast(&#x27;搜索成功&#x27;);</span><br><span class="line">      &#125; catch (error) &#123;</span><br><span class="line">        console.error(&#x27;完整错误:&#x27;, error.response?.data || error.message);</span><br><span class="line">        Toast.fail(error.response?.data?.message || &#x27;搜索失败&#x27;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    //重置条件</span><br><span class="line">    const SearchClear = async () =&gt; &#123;</span><br><span class="line">      searchText.value = &#x27;&#x27;;</span><br><span class="line">      selectedTags.value = [];</span><br><span class="line">      try &#123;</span><br><span class="line">        // 清除查询条件</span><br><span class="line">        studentStore.lastQuery = null;</span><br><span class="line">        studentStore.currentPage = 1;</span><br><span class="line">        await studentStore.fetchStudents(&#123;&#125;);</span><br><span class="line">        Toast(&#x27;已重置&#x27;);</span><br><span class="line">      &#125; catch (error) &#123;</span><br><span class="line">        Toast.fail(&#x27;重置失败&#x27;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">        //重置条件</span><br><span class="line">    const SearchClear = async () =&gt; &#123;</span><br><span class="line">      searchText.value = &#x27;&#x27;;</span><br><span class="line">      selectedTags.value = [];</span><br><span class="line">      try &#123;</span><br><span class="line">        // 清除查询条件</span><br><span class="line">        studentStore.lastQuery = null;</span><br><span class="line">        studentStore.currentPage = 1;</span><br><span class="line">        await studentStore.fetchStudents(&#123;&#125;);</span><br><span class="line">        Toast(&#x27;已重置&#x27;);</span><br><span class="line">      &#125; catch (error) &#123;</span><br><span class="line">        Toast.fail(&#x27;重置失败&#x27;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;  </span><br><span class="line">        </span><br><span class="line">    return &#123;</span><br><span class="line">      searchText,</span><br><span class="line">      conditionItems,</span><br><span class="line">      selectedTags,</span><br><span class="line">      showRangeDialog,</span><br><span class="line">      rangeMin,</span><br><span class="line">      rangeMax,</span><br><span class="line">      showSexAction,</span><br><span class="line">      sexActions,</span><br><span class="line">      showMultiSelectAction,</span><br><span class="line">      multiSelectOptions,</span><br><span class="line">      multiSelected,</span><br><span class="line">      showInputDialog,</span><br><span class="line">      confirmRange,</span><br><span class="line">      onSexSelect,</span><br><span class="line">      toggle,</span><br><span class="line">      confirmMultiSelect,</span><br><span class="line">      removeTag,</span><br><span class="line">      handleSearch,</span><br><span class="line">      idGrade,</span><br><span class="line">      multiTitle,</span><br><span class="line">      SearchClear,</span><br><span class="line"></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">/* styles/search.css */</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p>修改pinia：src&#x2F;store&#x2F;student.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">  <span class="comment">//存最后一次查询条件</span></span><br><span class="line">  <span class="keyword">const</span> lastQuery = <span class="title function_">ref</span>(<span class="literal">null</span>) </span><br><span class="line"></span><br><span class="line">  <span class="comment">// 获取当前页学生数据</span></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">fetchStudents</span> = <span class="keyword">async</span> (<span class="params">queryDTO = &#123;&#125;</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (queryDTO) &#123;<span class="comment">//深拷贝一下</span></span><br><span class="line">        lastQuery.<span class="property">value</span> = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(queryDTO))</span><br><span class="line">      &#125;  </span><br><span class="line">      <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">getStudents</span>(&#123;</span><br><span class="line">        <span class="attr">queryDTO</span>: queryDTO,</span><br><span class="line">        <span class="attr">pageNum</span>: currentPage.<span class="property">value</span>,</span><br><span class="line">        <span class="attr">pageSize</span>: pageSize.<span class="property">value</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="keyword">if</span> (response.<span class="property">data</span>.<span class="property">code</span> === <span class="number">0</span>) &#123;</span><br><span class="line">        students.<span class="property">value</span> = response.<span class="property">data</span>.<span class="property">data</span>.<span class="property">items</span> || [];</span><br><span class="line">        total.<span class="property">value</span> = response.<span class="property">data</span>.<span class="property">data</span>.<span class="property">total</span> || <span class="number">0</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> response;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Error fetching students:&#x27;</span>, error);</span><br><span class="line">      <span class="keyword">throw</span> error;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h3 id="修复一刷新、跳转回主界面条件筛选标签消失问题"><a href="#修复一刷新、跳转回主界面条件筛选标签消失问题" class="headerlink" title="修复一刷新、跳转回主界面条件筛选标签消失问题*"></a>修复一刷新、跳转回主界面条件筛选标签消失问题*</h3><h2 id="导出到excel"><a href="#导出到excel" class="headerlink" title="导出到excel"></a>导出到excel</h2><p>下载导出到excel的库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install xlsx</span><br></pre></td></tr></table></figure>

<p>修改TableChart中js部分</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//打印事件</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">showInputDialog</span> = (<span class="params">item</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span>(item.<span class="property">value</span> === <span class="string">&#x27;excel&#x27;</span>)&#123;</span><br><span class="line">    <span class="title function_">exportToExcel</span>();</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;打印word&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入导出Excel所需的库</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="variable constant_">XLSX</span> <span class="keyword">from</span> <span class="string">&#x27;xlsx&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">exportToExcel</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="title class_">Toast</span>.<span class="title function_">loading</span>(&#123;</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&#x27;正在导出数据...&#x27;</span>,</span><br><span class="line">      <span class="attr">forbidClick</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">duration</span>: <span class="number">0</span></span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 保存当前状态</span></span><br><span class="line">    <span class="keyword">const</span> originalPage = studentStore.<span class="property">currentPage</span>;</span><br><span class="line">    <span class="keyword">const</span> originalPageSize = studentStore.<span class="property">pageSize</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(originalPageSize);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取第一页数据以确定总条数</span></span><br><span class="line">    studentStore.<span class="property">pageSize</span> = <span class="number">50</span>; <span class="comment">// 每次获取50条</span></span><br><span class="line">    studentStore.<span class="property">currentPage</span> = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">let</span> response = <span class="keyword">await</span> studentStore.<span class="title function_">fetchStudents</span>(studentStore.<span class="property">lastQuery</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (!response.<span class="property">data</span>.<span class="property">data</span>?.<span class="property">items</span> || response.<span class="property">data</span>.<span class="property">data</span>.<span class="property">items</span>.<span class="property">length</span> === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="title class_">Toast</span>.<span class="title function_">clear</span>();</span><br><span class="line">      <span class="title class_">Toast</span>(<span class="string">&#x27;没有数据可导出&#x27;</span>);</span><br><span class="line">      studentStore.<span class="property">pageSize</span> = originalPageSize;</span><br><span class="line">      studentStore.<span class="property">currentPage</span> = originalPage;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> total = response.<span class="property">data</span>.<span class="property">data</span>.<span class="property">total</span>;</span><br><span class="line">    <span class="keyword">let</span> allStudents = [...response.<span class="property">data</span>.<span class="property">data</span>.<span class="property">items</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 计算需要获取的页数</span></span><br><span class="line">    <span class="keyword">const</span> totalPages = <span class="title class_">Math</span>.<span class="title function_">ceil</span>(total / pageSize.<span class="property">value</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 分批获取剩余数据</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> page = <span class="number">2</span>; page &lt;= totalPages; page++) &#123;</span><br><span class="line">      currentPage.<span class="property">value</span> = page;</span><br><span class="line">      response = <span class="keyword">await</span> studentStore.<span class="title function_">fetchStudents</span>(studentStore.<span class="property">lastQuery</span>);</span><br><span class="line">      allStudents = [...allStudents, ...response.<span class="property">data</span>.<span class="property">data</span>.<span class="property">items</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 准备Excel数据</span></span><br><span class="line">    <span class="keyword">const</span> excelData = allStudents.<span class="title function_">map</span>(<span class="function"><span class="params">student</span> =&gt;</span> (&#123;</span><br><span class="line">      学号: student.<span class="property">stuID</span>,</span><br><span class="line">      姓名: student.<span class="property">name</span>,</span><br><span class="line">      性别: student.<span class="property">gender</span>,</span><br><span class="line">      院系: student.<span class="property">department</span>,</span><br><span class="line">      专业: student.<span class="property">major</span>,</span><br><span class="line">      电话: student.<span class="property">tel</span>,</span><br><span class="line">      入学分数: student.<span class="property">grade</span>,</span><br><span class="line">      出生年月: student.<span class="property">birth</span>,</span><br><span class="line">      生源地: student.<span class="property">originPro</span>,</span><br><span class="line">      籍贯: student.<span class="property">nativePro</span>,</span><br><span class="line">      简介: student.<span class="property">profile</span></span><br><span class="line">    &#125;));</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建工作表</span></span><br><span class="line">    <span class="keyword">const</span> worksheet = <span class="variable constant_">XLSX</span>.<span class="property">utils</span>.<span class="title function_">json_to_sheet</span>(excelData);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建工作簿</span></span><br><span class="line">    <span class="keyword">const</span> workbook = <span class="variable constant_">XLSX</span>.<span class="property">utils</span>.<span class="title function_">book_new</span>();</span><br><span class="line">    <span class="variable constant_">XLSX</span>.<span class="property">utils</span>.<span class="title function_">book_append_sheet</span>(workbook, worksheet, <span class="string">&quot;学生数据&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 生成Excel文件并下载</span></span><br><span class="line">    <span class="keyword">const</span> date = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">    <span class="keyword">const</span> fileName = <span class="string">`学生数据_<span class="subst">$&#123;date.getFullYear()&#125;</span><span class="subst">$&#123;(date.getMonth()+<span class="number">1</span>).toString().padStart(<span class="number">2</span>, <span class="string">&#x27;0&#x27;</span>)&#125;</span><span class="subst">$&#123;date.getDate().toString().padStart(<span class="number">2</span>, <span class="string">&#x27;0&#x27;</span>)&#125;</span>.xlsx`</span>;</span><br><span class="line">    <span class="variable constant_">XLSX</span>.<span class="title function_">writeFile</span>(workbook, fileName);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 恢复原始状态</span></span><br><span class="line">    studentStore.<span class="property">pageSize</span> = originalPageSize;</span><br><span class="line">    studentStore.<span class="property">currentPage</span> = originalPage;</span><br><span class="line">    <span class="keyword">await</span> studentStore.<span class="title function_">fetchStudents</span>(studentStore.<span class="property">lastQuery</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="title class_">Toast</span>.<span class="title function_">clear</span>();</span><br><span class="line">    <span class="title class_">Toast</span>.<span class="title function_">success</span>(<span class="string">`导出成功，共<span class="subst">$&#123;total&#125;</span>条数据`</span>);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;导出失败:&#x27;</span>, error);</span><br><span class="line">    <span class="title class_">Toast</span>.<span class="title function_">clear</span>();</span><br><span class="line">    <span class="title class_">Toast</span>.<span class="title function_">fail</span>(<span class="string">&#x27;导出失败&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h1 id="10-学生信息编辑"><a href="#10-学生信息编辑" class="headerlink" title="10.学生信息编辑"></a>10.学生信息编辑</h1><h2 id="edit页面"><a href="#edit页面" class="headerlink" title="edit页面"></a>edit页面</h2><h3 id="删除、查找上下一个学生"><a href="#删除、查找上下一个学生" class="headerlink" title="删除、查找上下一个学生"></a>删除、查找上下一个学生</h3><blockquote>
<p>界面+找“首个、末尾、上一个、下一个”学生+删除学生</p>
<p>这里学生信息studentData用计算属性（<code>computed</code>）的响应式依赖，这样只要studentData一变就可以立即重新渲染界面上的数据</p>
<p>在首页渲染表格的时候就在pinia中写了获取所有学生信息，这里直接用就行。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;div class=&quot;editPage&quot;&gt;</span><br><span class="line">&lt;!-- 顶部栏 --&gt;</span><br><span class="line">  &lt;div class=&quot;top-bar&quot;&gt;</span><br><span class="line">    &lt;span class=&quot;label&quot;&gt;学籍卡&lt;/span&gt;</span><br><span class="line">    &lt;van-dropdown-menu class=&quot;pdf-word&quot; :close-on-click-outside=&quot;true&quot;&gt;</span><br><span class="line">      &lt;van-dropdown-item </span><br><span class="line">        v-model=&quot;dropdownValue&quot; </span><br><span class="line">        :options=&quot;dropdownOptions&quot;</span><br><span class="line">        title=&quot;打印和导出&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;template #default&gt;</span><br><span class="line">          &lt;div class=&quot;dropdown-content&quot;&gt;</span><br><span class="line">            &lt;van-cell </span><br><span class="line">              v-for=&quot;item in conditionItems&quot; </span><br><span class="line">              :key=&quot;item.value&quot; </span><br><span class="line">              :title=&quot;item.text&quot;</span><br><span class="line">              @click=&quot;showInputDialog(item)&quot;</span><br><span class="line">            /&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/van-dropdown-item&gt;</span><br><span class="line">    &lt;/van-dropdown-menu&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">  &lt;stu-card </span><br><span class="line">    :student-data=&quot;studentData&quot;</span><br><span class="line">    :is-editable=&quot;isEditable&quot;</span><br><span class="line">  /&gt;</span><br><span class="line"></span><br><span class="line">  &lt;!-- 学生卡下方的操作按钮 --&gt;</span><br><span class="line">  &lt;div class=&quot;all-btn&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;btn-operat&quot;&gt;</span><br><span class="line">    &lt;van-button @click=&quot;onFirst&quot;&gt;首页&lt;/van-button&gt;</span><br><span class="line">    &lt;van-button icon=&quot;arrow-left&quot; @click=&quot;onPrevious&quot; /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div class=&quot;card-actions&quot;&gt;</span><br><span class="line">      &lt;van-icon name=&quot;edit&quot; @click=&quot;onEdit&quot; size= &quot;2.3rem&quot;/&gt;</span><br><span class="line">      &lt;van-icon name=&quot;add-o&quot; @click=&quot;onAdd&quot; size= &quot;2.3rem&quot;/&gt;</span><br><span class="line">      &lt;van-icon name=&quot;delete-o&quot; @click=&quot;onDelete&quot; size= &quot;2.3rem&quot;/&gt;      </span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;van-button icon=&quot;arrow&quot; @click=&quot;onNext&quot; /&gt;</span><br><span class="line">    &lt;van-button @click=&quot;onLast&quot;&gt;尾页&lt;/van-button&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;van-button </span><br><span class="line">      class=&quot;confirm&quot;</span><br><span class="line">      type=&quot;primary&quot; </span><br><span class="line">      :disabled=&quot;!isConfirmEnabled&quot; </span><br><span class="line">      @click=&quot;onConfirm&quot;&gt;确认&lt;/van-button&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import StuCard from &#x27;./StuCard.vue&#x27;;</span><br><span class="line">import &#123; ref, computed ,onMounted&#125; from &#x27;vue&#x27;</span><br><span class="line">import &#123;Toast ,Dialog&#125; from &#x27;vant&#x27;</span><br><span class="line">import &#123; useStudentStore &#125; from &#x27;@/store/student&#x27;;</span><br><span class="line">import &#123; findStudentIndex &#125; from &#x27;@/utils/studentIndex&#x27;;</span><br><span class="line">import router from &#x27;@/router&#x27;;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  components: &#123;</span><br><span class="line">    StuCard,</span><br><span class="line">  &#125;,</span><br><span class="line">  setup() &#123;  </span><br><span class="line">    //打印部分</span><br><span class="line">    const dropdownValue = ref(0);</span><br><span class="line">    const dropdownOptions = ref([]);</span><br><span class="line">    // 下拉菜单栏目内容</span><br><span class="line">    const conditionItems = ref([</span><br><span class="line">      &#123; text: &#x27;打印到pdf&#x27;, value: &#x27;pdf&#x27; &#125;,</span><br><span class="line">      &#123; text: &#x27;导出为word&#x27;, value: &#x27;word&#x27; &#125;,</span><br><span class="line">    ]);</span><br><span class="line">    //打印事件</span><br><span class="line">    const showInputDialog = (item) =&gt; &#123;</span><br><span class="line">      if(item.value === &#x27;pdf&#x27;)&#123;</span><br><span class="line">        console.log(&quot;打印pdf&quot;);</span><br><span class="line">      &#125;else&#123;</span><br><span class="line">        console.log(&quot;打印word&quot;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;  </span><br><span class="line">    </span><br><span class="line">    //1.直接点击edit随机显示一个学生，这时候可能没有当前学生，那就从所有学生中随机找一个设为当前学生。2.从表格的查看详情点击跳转过来显示这个学生的信息，也就是pinia中存的当前学生。</span><br><span class="line">    //所以挂载的时候先调用fetchAllStudents方法获取所有学生信息等后面用   </span><br><span class="line">    onMounted(async () =&gt; &#123;      </span><br><span class="line">      // 仅在未加载数据时请求所有信息</span><br><span class="line">      if (studentStore.allStudents.length === 0) &#123;</span><br><span class="line">        await studentStore.fetchAllStudents();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    //将需要渲染的学生信息存到studentData里面</span><br><span class="line">    //通过给封装的学籍卡stu-card 组件绑定一个:student-data=&quot;studentData&quot;传到组件里面进行渲染</span><br><span class="line">    const studentStore = useStudentStore();</span><br><span class="line">    </span><br><span class="line">    const studentData = computed(() =&gt; &#123;</span><br><span class="line">      if (!studentStore.currentStudent) &#123;</span><br><span class="line">        // 如果没有当前学生，随机选择一个学生渲染</span><br><span class="line">        if (studentStore.allStudents.length &gt; 0) &#123;</span><br><span class="line">          const randomIndex = Math.floor(Math.random() * studentStore.allStudents.length);</span><br><span class="line">          studentStore.setCurrentStudent(studentStore.allStudents[randomIndex]);//给这个学生设为当前学生</span><br><span class="line">          return mapToStuCardData(studentStore.allStudents[randomIndex]);</span><br><span class="line">        &#125;</span><br><span class="line">        return &#123;&#125;;</span><br><span class="line">      &#125;</span><br><span class="line">      //渲染到组件上</span><br><span class="line">      return mapToStuCardData(studentStore.currentStudent);</span><br><span class="line">    &#125;);</span><br><span class="line">     // 将表格数据映射到学籍卡数据格式</span><br><span class="line">    const mapToStuCardData = (student) =&gt; &#123;</span><br><span class="line">      //console.log(JSON.stringify(student));</span><br><span class="line">      return &#123;</span><br><span class="line">        name: student.name || &#x27;&#x27;,</span><br><span class="line">        photo: student.img || &#x27;&#x27;,</span><br><span class="line">        gender: student.gender || &#x27;&#x27;,</span><br><span class="line">        tel: student.tel || &#x27;&#x27;,</span><br><span class="line">        studentId: student.stuID || &#x27;&#x27;,</span><br><span class="line">        department: student.department || &#x27;&#x27;,</span><br><span class="line">        major: student.major || &#x27;&#x27;,</span><br><span class="line">        entranceScore: student.grade || &#x27;&#x27;,</span><br><span class="line">        birthDate: student.birth || &#x27;&#x27;,</span><br><span class="line">        hometown: student.originPro || &#x27;&#x27;,</span><br><span class="line">        nativePlace: student.nativePro || &#x27;&#x27;,</span><br><span class="line">        introduction: student.introduction || &#x27;&#x27;</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line">      </span><br><span class="line">    //offset表示哪种查找操作,1next,-1preview,-2first,2last.currentStudent表示当前学生信息</span><br><span class="line">    const getAdjacentStudent = (offset,currentStudent) =&gt; &#123;</span><br><span class="line">      const currentIndex = findStudentIndex(studentStore.allStudents , currentStudent.stuID);</span><br><span class="line">      //如果不存在当前学生、或者就没有学生数据的话，返回null</span><br><span class="line">      // if (!studentStore.currentStudent || !currentIndex)&#123;</span><br><span class="line">      //   Toast(&quot;不存在当前学生&quot;);</span><br><span class="line">      //   return null;</span><br><span class="line">      // &#125;</span><br><span class="line">              </span><br><span class="line">      const LastIndex = studentStore.allStudents.length-1;    </span><br><span class="line">      if ((currentIndex === 0 &amp;&amp; offset &lt; 0) || (currentIndex === LastIndex &amp;&amp; offset &gt; 0)) &#123;</span><br><span class="line">          Toast(offset &gt; 0 ? &#x27;已是最后一个学生&#x27; : &#x27;已是第一个学生&#x27;);</span><br><span class="line">          return null;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">      let targetIndex;</span><br><span class="line">      if (offset === -2) targetIndex = 0; // 首页</span><br><span class="line">      else if (offset === 2) targetIndex = LastIndex; // 尾页</span><br><span class="line">      else targetIndex = currentIndex + offset;     // 上一个/下一个</span><br><span class="line"></span><br><span class="line">      const aimStudent = studentStore.allStudents[targetIndex];</span><br><span class="line">      studentStore.setCurrentStudent(aimStudent);</span><br><span class="line">      //console.log(&quot;currentStudent=== &quot;+studentStore.currentStudent.stuID);</span><br><span class="line">      return aimStudent;     </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //上一个学生  </span><br><span class="line">    const onPrevious = async () =&gt; &#123;  </span><br><span class="line">      getAdjacentStudent(-1,studentStore.currentStudent);</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    //下一个学生</span><br><span class="line">    const onNext = async () =&gt; &#123;</span><br><span class="line">      getAdjacentStudent(1,studentStore.currentStudent);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    //第一个学生</span><br><span class="line">    const onFirst = async() =&gt; &#123;</span><br><span class="line">      getAdjacentStudent(-2,studentStore.currentStudent);</span><br><span class="line">    &#125;;</span><br><span class="line">    //最后一个学生</span><br><span class="line">    const onLast = async() =&gt; &#123;</span><br><span class="line">      getAdjacentStudent(2,studentStore.currentStudent);</span><br><span class="line">    &#125;; </span><br><span class="line">      </span><br><span class="line">    //操作学生信息部分</span><br><span class="line">    //编辑学生信息*</span><br><span class="line">    const isEditable = ref(false);</span><br><span class="line">    const isConfirmEnabled = ref(false);</span><br><span class="line">    const onEdit = () =&gt; &#123;</span><br><span class="line">      isEditable.value = true;</span><br><span class="line">      isConfirmEnabled.value = true;</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    //点击确认</span><br><span class="line">    const onConfirm = () =&gt; &#123;&#125;;</span><br><span class="line">      </span><br><span class="line">    //新增学生</span><br><span class="line">    const onAdd = () =&gt; &#123;</span><br><span class="line">      //router.push(&#x27;/AddStu&#x27;);</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    //删除学生</span><br><span class="line">    const onDelete = async () =&gt; &#123;</span><br><span class="line">      if (!studentStore.currentStudent) &#123;</span><br><span class="line">        console.log(&quot;nocurrentStudent&quot;);</span><br><span class="line">        return;</span><br><span class="line">      &#125;</span><br><span class="line">        </span><br><span class="line">      Dialog.confirm(&#123;</span><br><span class="line">        title: &quot;确认删除&quot;,</span><br><span class="line">        message: `确定要删除学生 $&#123;studentStore.currentStudent.name&#125; ($&#123;studentStore.currentStudent.stuID&#125;) 吗？`,</span><br><span class="line">      &#125;)</span><br><span class="line">      .then(async () =&gt; &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">          await studentStore.deleteStudent(studentStore.currentStudent.stuID);</span><br><span class="line">          Toast.success(&#x27;删除成功&#x27;);</span><br><span class="line">        &#125; catch (error) &#123;</span><br><span class="line">          console.error(&#x27;删除失败:&#x27;, error);</span><br><span class="line">          Toast.fail(&#x27;删除失败&#x27;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">      .catch(() =&gt; &#123;</span><br><span class="line">        Toast(&#x27;取消&#x27;);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;;  </span><br><span class="line">    </span><br><span class="line">    return &#123;</span><br><span class="line">      dropdownValue,</span><br><span class="line">      dropdownOptions,</span><br><span class="line">      conditionItems,</span><br><span class="line">      studentData,</span><br><span class="line">      isEditable,</span><br><span class="line">      isConfirmEnabled,</span><br><span class="line">      showInputDialog,</span><br><span class="line">      onDelete,</span><br><span class="line">      onFirst,</span><br><span class="line">      onPrevious,</span><br><span class="line">      onNext,</span><br><span class="line">      onLast,</span><br><span class="line">      onEdit,</span><br><span class="line">      onAdd,</span><br><span class="line">      onConfirm</span><br><span class="line">    &#125;  </span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.editPage&#123;</span><br><span class="line">  height: 100vh;</span><br><span class="line">  background-color: #d8d3d3d1;</span><br><span class="line">&#125;</span><br><span class="line">.top-bar&#123;</span><br><span class="line">  display: flex;</span><br><span class="line">  justify-content: space-between;</span><br><span class="line">  align-items: center;</span><br><span class="line">  padding: .5rem 1rem .4rem 1rem;</span><br><span class="line">  margin-bottom: .6rem;</span><br><span class="line">  background-color: white;</span><br><span class="line">&#125;</span><br><span class="line">.label &#123;</span><br><span class="line">  font-size: 0.9rem;</span><br><span class="line">  color: #333;</span><br><span class="line">&#125;</span><br><span class="line">.pdf-word&#123;</span><br><span class="line">    margin-left: .6rem;</span><br><span class="line">    padding: 0rem .8rem;</span><br><span class="line">    flex: 1;</span><br><span class="line">    width: 40%;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.all-btn&#123;</span><br><span class="line">  margin:.6rem 0 3rem 0;</span><br><span class="line">  padding: .4rem .6rem;</span><br><span class="line">  background-color: white;</span><br><span class="line">&#125;</span><br><span class="line">.btn-operat&#123;</span><br><span class="line">  display: flex;</span><br><span class="line">  justify-content: center;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line">.btn-operat .card-actions&#123;</span><br><span class="line">  width: 40%;</span><br><span class="line">  display: flex;</span><br><span class="line">  justify-content: space-between;</span><br><span class="line">  align-items: center;</span><br><span class="line">  padding: .2rem .6rem;</span><br><span class="line">&#125;</span><br><span class="line">.confirm&#123;</span><br><span class="line">  width: 100%;</span><br><span class="line">  margin-top: .6rem;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h3 id="edit-新增学生"><a href="#edit-新增学生" class="headerlink" title="edit-新增学生"></a>edit-新增学生</h3><p>在路由文件中加一个路由.src&#x2F;router&#x2F;index.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">...,&#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&quot;/AddStu&quot;</span> ,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;AddStu&#x27;</span> ,</span><br><span class="line">    <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span> (<span class="string">&quot;../views/edit/AddStu.vue&quot;</span>),</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>修改edit页面中新增事件，跳到addStu页面</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="comment">//新增学生</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">onAdd</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">      router.<span class="title function_">push</span>(<span class="string">&#x27;/AddStu&#x27;</span>);</span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure>

<p>新增学生页面</p>
<p>点击添加的学生信息中，院系专业信息从数据库获取。接口文件src&#x2F;api&#x2F;departmajor.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取权限范围内的院系-专业组合</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">getCombinations</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/departMajor/DepartAndMajor&#x27;</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>点击提交学生信息接口src&#x2F;api&#x2F;student.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//新增学生</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">addStudent</span>(<span class="params">studentData</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/student&#x27;</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span>: studentData</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>src&#x2F;views&#x2F;AddStu.vue</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;add-student-page&quot;&gt;</span><br><span class="line">    &lt;!-- 顶部导航栏 --&gt;</span><br><span class="line">    &lt;van-nav-bar</span><br><span class="line">      title=&quot;填写学生信息&quot;</span><br><span class="line">      left-text=&quot;返回&quot;</span><br><span class="line">      left-arrow</span><br><span class="line">      @click-left=&quot;handleBack&quot;</span><br><span class="line">    /&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- 表单区域 --&gt;</span><br><span class="line">    &lt;van-form @submit=&quot;handleSubmit&quot; class=&quot;student-form&quot;&gt;</span><br><span class="line">        &lt;!-- 头像上传 --&gt;</span><br><span class="line">        &lt;van-cell title=&quot;头像&quot; is-link @click=&quot;showImagePicker = true&quot;&gt;</span><br><span class="line">            &lt;template #default&gt;</span><br><span class="line">            &lt;van-image</span><br><span class="line">                round</span><br><span class="line">                width=&quot;60&quot;</span><br><span class="line">                height=&quot;60&quot;</span><br><span class="line">                :src=&quot;formData.img&quot;</span><br><span class="line">            /&gt;</span><br><span class="line">            &lt;/template&gt;</span><br><span class="line">            </span><br><span class="line">        &lt;/van-cell&gt;</span><br><span class="line">        &lt;!-- 头像选择器弹窗 --&gt;</span><br><span class="line">        &lt;van-popup v-model:show=&quot;showImagePicker&quot; round&gt;</span><br><span class="line">            &lt;van-uploader</span><br><span class="line">                v-model=&quot;imageList&quot;</span><br><span class="line">                :max-count=&quot;1&quot;</span><br><span class="line">                :after-read=&quot;afterRead&quot;</span><br><span class="line">                :preview-image=&quot;false&quot;</span><br><span class="line">                capture=&quot;camera&quot;</span><br><span class="line">            &gt;</span><br><span class="line">            &lt;/van-uploader&gt;</span><br><span class="line">        &lt;/van-popup&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!-- 姓名 --&gt;</span><br><span class="line">      &lt;van-field</span><br><span class="line">        v-model=&quot;formData.name&quot;</span><br><span class="line">        label=&quot;姓名&quot;</span><br><span class="line">        placeholder=&quot;请输入学生姓名&quot;</span><br><span class="line">        :rules=&quot;[&#123; required: true, message: &#x27;请输入姓名&#x27; &#125;]&quot;</span><br><span class="line">      /&gt;</span><br><span class="line">      </span><br><span class="line">      &lt;!-- 学号 --&gt;</span><br><span class="line">      &lt;van-field</span><br><span class="line">        v-model=&quot;formData.stuID&quot;</span><br><span class="line">        label=&quot;学号&quot;</span><br><span class="line">        placeholder=&quot;请输入学号&quot;</span><br><span class="line">        :rules=&quot;[&#123; required: true, message: &#x27;请输入学号&#x27; &#125;]&quot;</span><br><span class="line">      /&gt;</span><br><span class="line">      </span><br><span class="line">      &lt;!-- 性别选择 --&gt;</span><br><span class="line">      &lt;van-field</span><br><span class="line">        v-model=&quot;formData.gender&quot;</span><br><span class="line">        is-link</span><br><span class="line">        readonly</span><br><span class="line">        label=&quot;性别&quot;</span><br><span class="line">        placeholder=&quot;请选择性别&quot;</span><br><span class="line">        @click=&quot;showGenderPicker = true&quot;</span><br><span class="line">      /&gt;</span><br><span class="line">      </span><br><span class="line">      &lt;!-- 电话 --&gt;</span><br><span class="line">      &lt;van-field</span><br><span class="line">        v-model=&quot;formData.tel&quot;</span><br><span class="line">        label=&quot;电话&quot;</span><br><span class="line">        placeholder=&quot;请输入电话号码&quot;</span><br><span class="line">        :rules=&quot;[&#123; pattern: /^1[3-9]\d&#123;9&#125;$/, message: &#x27;请输入正确的手机号&#x27; &#125;]&quot;</span><br><span class="line">      /&gt;</span><br><span class="line">      </span><br><span class="line">      &lt;!-- 专业和院系选择 --&gt;</span><br><span class="line">      &lt;van-field</span><br><span class="line">        v-model=&quot;departAndmajor&quot;</span><br><span class="line">        is-link</span><br><span class="line">        readonly</span><br><span class="line">        label=&quot;专业和院系&quot;</span><br><span class="line">        placeholder=&quot;请选择专业和院系&quot;</span><br><span class="line">        @click=&quot;showMajorDepartmentPicker = true&quot;</span><br><span class="line">      /&gt;</span><br><span class="line">      </span><br><span class="line">      &lt;!-- 入学分数 --&gt;</span><br><span class="line">      &lt;van-field</span><br><span class="line">        v-model=&quot;formData.grade&quot;</span><br><span class="line">        label=&quot;入学分数&quot;</span><br><span class="line">        placeholder=&quot;请输入入学分数&quot;</span><br><span class="line">        type=&quot;number&quot;</span><br><span class="line">      /&gt;</span><br><span class="line">      </span><br><span class="line">      &lt;!-- 出生年月选择 --&gt;</span><br><span class="line">      &lt;van-field</span><br><span class="line">        v-model=&quot;formData.birth&quot;</span><br><span class="line">        is-link</span><br><span class="line">        readonly</span><br><span class="line">        label=&quot;出生年月&quot;</span><br><span class="line">        placeholder=&quot;请选择出生年月&quot;</span><br><span class="line">        @click=&quot;showBirthDateCalendar = true&quot;</span><br><span class="line">      /&gt;</span><br><span class="line">      </span><br><span class="line">      &lt;!-- 生源地选择 --&gt;</span><br><span class="line">      &lt;van-field</span><br><span class="line">        v-model=&quot;formData.originPro&quot;</span><br><span class="line">        is-link</span><br><span class="line">        readonly</span><br><span class="line">        label=&quot;生源地&quot;</span><br><span class="line">        placeholder=&quot;请选择生源地&quot;</span><br><span class="line">        @click=&quot;showHometownPicker = true&quot;</span><br><span class="line">      /&gt;</span><br><span class="line">      </span><br><span class="line">      &lt;!-- 籍贯选择 --&gt;</span><br><span class="line">      &lt;van-field</span><br><span class="line">        v-model=&quot;formData.nativePro&quot;</span><br><span class="line">        is-link</span><br><span class="line">        readonly</span><br><span class="line">        label=&quot;籍贯&quot;</span><br><span class="line">        placeholder=&quot;请选择籍贯&quot;</span><br><span class="line">        @click=&quot;showNativePlacePicker = true&quot;</span><br><span class="line">      /&gt;</span><br><span class="line">      </span><br><span class="line">      &lt;!-- 简介 --&gt;</span><br><span class="line">      &lt;van-field</span><br><span class="line">        v-model=&quot;formData.profile&quot;</span><br><span class="line">        label=&quot;简介&quot;</span><br><span class="line">        type=&quot;textarea&quot;</span><br><span class="line">        autosize</span><br><span class="line">        placeholder=&quot;请输入学生简介&quot;</span><br><span class="line">        rows=&quot;3&quot;</span><br><span class="line">      /&gt;</span><br><span class="line">      </span><br><span class="line">      &lt;!-- 提交按钮 --&gt;</span><br><span class="line">      &lt;div class=&quot;submit-button&quot;&gt;</span><br><span class="line">        &lt;van-button round block type=&quot;primary&quot; native-type=&quot;submit&quot;&gt;</span><br><span class="line">          提交</span><br><span class="line">        &lt;/van-button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/van-form&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- 性别选择器 --&gt;</span><br><span class="line">    &lt;van-action-sheet</span><br><span class="line">      v-model:show=&quot;showGenderPicker&quot;</span><br><span class="line">      :actions=&quot;genderActions&quot;</span><br><span class="line">      @select=&quot;onGenderSelect&quot;</span><br><span class="line">    /&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- 专业和院系级联选择器 --&gt;</span><br><span class="line">    &lt;van-popup v-model:show=&quot;showMajorDepartmentPicker&quot; position=&quot;bottom&quot;&gt;</span><br><span class="line">      &lt;van-cascader</span><br><span class="line">        v-if=&quot;showMajorDepartmentPicker&quot;</span><br><span class="line">        :options=&quot;majorDepartmentOptions&quot;</span><br><span class="line">        @finish=&quot;onMajorDepartmentFinish&quot;</span><br><span class="line">        @close=&quot;showMajorDepartmentPicker = false&quot;</span><br><span class="line">      /&gt;</span><br><span class="line">    &lt;/van-popup&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- 出生年月日历选择器 --&gt;</span><br><span class="line">    &lt;van-popup v-model:show=&quot;showBirthDateCalendar&quot; position=&quot;bottom&quot;&gt;  </span><br><span class="line">        &lt;van-calendar</span><br><span class="line">            v-model:show=&quot;showBirthDateCalendar&quot;</span><br><span class="line">            type=&quot;single&quot;</span><br><span class="line">            :min-date=&quot;minDate&quot;</span><br><span class="line">            :max-date=&quot;maxDate&quot;</span><br><span class="line">            :default-date=&quot;defaultDate&quot;</span><br><span class="line">            @confirm=&quot;onBirthDateConfirm&quot;</span><br><span class="line">            /&gt;</span><br><span class="line">    &lt;/van-popup&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- 生源地选择器 --&gt;</span><br><span class="line">    &lt;van-popup v-model:show=&quot;showHometownPicker&quot; position=&quot;bottom&quot;&gt;</span><br><span class="line">      &lt;van-cascader</span><br><span class="line">        v-if=&quot;showHometownPicker&quot;</span><br><span class="line">        :options=&quot;provinceOptions&quot;</span><br><span class="line">        @finish=&quot;onHometownFinish&quot;</span><br><span class="line">        @close=&quot;showHometownPicker = false&quot;</span><br><span class="line">      /&gt;</span><br><span class="line">    &lt;/van-popup&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- 籍贯选择器 --&gt;</span><br><span class="line">    &lt;van-popup v-model:show=&quot;showNativePlacePicker&quot; position=&quot;bottom&quot;&gt;</span><br><span class="line">      &lt;van-cascader</span><br><span class="line">        v-if=&quot;showNativePlacePicker&quot;</span><br><span class="line">        :options=&quot;provinceOptions&quot;</span><br><span class="line">        @finish=&quot;onNativePlaceFinish&quot;</span><br><span class="line">        @close=&quot;showNativePlacePicker = false&quot;</span><br><span class="line">      /&gt;</span><br><span class="line">    &lt;/van-popup&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123; ref, onMounted &#125; from &#x27;vue&#x27;;</span><br><span class="line">import &#123; useRouter &#125; from &#x27;vue-router&#x27;;</span><br><span class="line">import &#123; areaList &#125; from &#x27;@vant/area-data&#x27;;</span><br><span class="line">import &#123; Toast &#125; from &#x27;vant&#x27;;</span><br><span class="line">import &#123; getCombinations &#125; from &#x27;@/api/departmajor&#x27;;</span><br><span class="line">import &#123; addStudent &#125; from &#x27;@/api/student&#x27;</span><br><span class="line">import &#123; useStudentStore &#125; from &#x27;@/store/student&#x27;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  setup() &#123;</span><br><span class="line">    const router = useRouter();</span><br><span class="line">    // 返回按钮事件</span><br><span class="line">    const handleBack = () =&gt; &#123;</span><br><span class="line">      router.back();</span><br><span class="line">    &#125;;  </span><br><span class="line">    // 存用户填的表单数据，后面交给后端，和后端字段保持一致。   </span><br><span class="line">    const formData = ref(&#123;</span><br><span class="line">        stuID: &#x27;&#x27;,</span><br><span class="line">        name: &#x27;&#x27;,</span><br><span class="line">        gender: &#x27;&#x27;,</span><br><span class="line">        originPro: &#x27;&#x27;,</span><br><span class="line">        nativePro: &#x27;&#x27;,</span><br><span class="line">        birth: &#x27;&#x27;,</span><br><span class="line">        major: &#x27;&#x27;,</span><br><span class="line">        department: &#x27;&#x27;,</span><br><span class="line">        grade: &#x27;&#x27;,</span><br><span class="line">        tel: &#x27;&#x27;,</span><br><span class="line">        img: &#x27;&#x27;,</span><br><span class="line">        profile: &#x27;&#x27;,</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    //cascader级联选择数据格式  </span><br><span class="line">    // &#123;</span><br><span class="line">    //     text: &#x27;计算机学院&#x27;,</span><br><span class="line">    //     value: &#x27;computer&#x27;,</span><br><span class="line">    //     children: [</span><br><span class="line">    //       &#123; text: &#x27;计算机科学与技术&#x27;, value: &#x27;cs&#x27; &#125;,</span><br><span class="line">    //       &#123; text: &#x27;软件工程&#x27;, value: &#x27;se&#x27; &#125;,</span><br><span class="line">    //       &#123; text: &#x27;人工智能&#x27;, value: &#x27;ai&#x27; &#125;</span><br><span class="line">    //     ]</span><br><span class="line">    //   &#125;,</span><br><span class="line"></span><br><span class="line">	// 1.cascader从major...中取出数据渲染到界面，这里就用这个存从后端获取的专业和院系数据</span><br><span class="line">    const majorDepartmentOptions = ref([]);    </span><br><span class="line">    // 2.获得院校专业数据</span><br><span class="line">    const loadDepartmentMajorData = async () =&gt; &#123;</span><br><span class="line">      try &#123;</span><br><span class="line">        const res = await getCombinations();</span><br><span class="line">        if (res.data.code === 0 &amp;&amp; res.data.data) &#123;</span><br><span class="line">          // 将后端数据转换为Cascader需要的格式，否则渲染不上</span><br><span class="line">          majorDepartmentOptions.value = Object.entries(res.data.data).map(</span><br><span class="line">            ([department, majors]) =&gt; (&#123;</span><br><span class="line">              text: department,</span><br><span class="line">              value: department,</span><br><span class="line">              children: majors.map(major =&gt; (&#123;</span><br><span class="line">                text: major,</span><br><span class="line">                value: major</span><br><span class="line">              &#125;))</span><br><span class="line">            &#125;)</span><br><span class="line">          );</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          Toast.fail(&#x27;获取院校专业数据失败&#x27;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; catch (error) &#123;</span><br><span class="line">        console.error(&#x27;获取院校专业数据错误:&#x27;, error);</span><br><span class="line">        Toast.fail(&#x27;获取院校专业数据失败&#x27;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">     // 组件挂载时加载获得院系和专业数据</span><br><span class="line">    onMounted(() =&gt; &#123;</span><br><span class="line">      loadDepartmentMajorData();</span><br><span class="line">    &#125;);</span><br><span class="line">      </span><br><span class="line">     // 专业和院系选择完成。后端只返回权限范围内的专业院系，这里无需再判断</span><br><span class="line">    //专业-院系，显示到页面</span><br><span class="line">    const departAndmajor = ref(null);</span><br><span class="line">    const showMajorDepartmentPicker = ref(false);  </span><br><span class="line">    const onMajorDepartmentFinish = (&#123; selectedOptions &#125;) =&gt; &#123;</span><br><span class="line">      const [department, major] = selectedOptions;</span><br><span class="line">      //将用户选择的院系专业存入表单数据  </span><br><span class="line">      formData.value.department = department.value;</span><br><span class="line">      formData.value.major = major.value;</span><br><span class="line">      //界面上显示院系-专业，将这两个拼接起来显示  </span><br><span class="line">      departAndmajor.value = `$&#123;department.text&#125; - $&#123;major.text&#125;`;</span><br><span class="line">      showMajorDepartmentPicker.value = false;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    // 性别选项</span><br><span class="line">    const genderActions = [</span><br><span class="line">      &#123; name: &#x27;男&#x27;, value: &#x27;male&#x27; &#125;,</span><br><span class="line">      &#123; name: &#x27;女&#x27;, value: &#x27;female&#x27; &#125;</span><br><span class="line">    ];  </span><br><span class="line">    // 性别选择</span><br><span class="line">    // 性别选择器显示状态</span><br><span class="line">    const showGenderPicker = ref(false);</span><br><span class="line">    const onGenderSelect = (action) =&gt; &#123;</span><br><span class="line">      formData.value.gender = action.name;</span><br><span class="line">      showGenderPicker.value = false;</span><br><span class="line">    &#125;;  </span><br><span class="line">    </span><br><span class="line">    // 控制日历显示状态</span><br><span class="line">    const showBirthDateCalendar = ref(false); </span><br><span class="line">    // 日期范围设置</span><br><span class="line">    const minDate = new Date(1980, 0, 1);</span><br><span class="line">    const maxDate = new Date();</span><br><span class="line">    //初始默认日期设为18年前</span><br><span class="line">    const defaultDate = new Date(new Date().setFullYear(new Date().getFullYear() - 18));</span><br><span class="line">	// 出生日期选择确认</span><br><span class="line">    const onBirthDateConfirm = (date) =&gt; &#123;</span><br><span class="line">        const selectedDate = new Date(date);</span><br><span class="line">        //后端要yyyy-mm-dd格式，这里要补零，不然后端接收的是null</span><br><span class="line">        const year = selectedDate.getFullYear();</span><br><span class="line">        const month = (selectedDate.getMonth() + 1).toString().padStart(2, &#x27;0&#x27;); // 补零</span><br><span class="line">        const day = selectedDate.getDate().toString().padStart(2, &#x27;0&#x27;); // 补零</span><br><span class="line">        </span><br><span class="line">        formData.value.birth = `$&#123;year&#125;-$&#123;month&#125;-$&#123;day&#125;`; </span><br><span class="line">        showBirthDateCalendar.value = false;</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    //点击弹出省份数据（只显示省级）</span><br><span class="line">    const provinceOptions = Object.entries(areaList.province_list).map(([code, name]) =&gt; (&#123;</span><br><span class="line">      text: name,</span><br><span class="line">      value: code</span><br><span class="line">    &#125;));  </span><br><span class="line">    // 生源地选择完成</span><br><span class="line">    const showHometownPicker = ref(false);  </span><br><span class="line">    const onHometownFinish = (&#123; selectedOptions &#125;) =&gt; &#123;</span><br><span class="line">      formData.value.originPro = selectedOptions[0].text;</span><br><span class="line">      showHometownPicker.value = false;</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    // 籍贯选择完成</span><br><span class="line">    const showNativePlacePicker = ref(false);  </span><br><span class="line">    const onNativePlaceFinish = (&#123; selectedOptions &#125;) =&gt; &#123;</span><br><span class="line">      formData.value.nativePro = selectedOptions[0].text;</span><br><span class="line">      showNativePlacePicker.value = false;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    //头像上传部分*  </span><br><span class="line">    const showImagePicker = ref(false);</span><br><span class="line">    const imageList = ref([]);</span><br><span class="line">    // 头像上传处理</span><br><span class="line">    const afterRead = () =&gt; &#123;</span><br><span class="line">      // 这里模拟上传过程，实际项目中应该调用上传接口</span><br><span class="line">      Toast.loading(&#x27;处理中...&#x27;);</span><br><span class="line">      </span><br><span class="line">      setTimeout(() =&gt; &#123;</span><br><span class="line">        // 模拟上传成功，获取图片URL</span><br><span class="line">        const imageUrl = &quot;https://fastly.jsdelivr.net/npm/@vant/assets/cat.jpeg&quot;;</span><br><span class="line">        </span><br><span class="line">        // 更新表单数据</span><br><span class="line">        formData.value.img = imageUrl;</span><br><span class="line">        </span><br><span class="line">        // 清空上传列表</span><br><span class="line">        imageList.value = [];</span><br><span class="line">        </span><br><span class="line">        // 关闭选择器</span><br><span class="line">        showImagePicker.value = false;</span><br><span class="line">        </span><br><span class="line">        Toast.clear();</span><br><span class="line">      &#125;, 1000);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // 表单提交</span><br><span class="line">    const handleSubmit = async () =&gt; &#123;</span><br><span class="line">      try &#123;</span><br><span class="line">        //console.log(&quot;收集的学生数据&quot;+JSON.stringify(formData.value));</span><br><span class="line">        const submitData = &#123;</span><br><span class="line">          ...formData.value,</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        //console.log(&quot;提交的学生数据&quot;+JSON.stringify(submitData));</span><br><span class="line">        Toast.loading(&#x27;提交中...&#x27;);</span><br><span class="line">        const res = await addStudent(submitData);</span><br><span class="line">        Toast.clear();</span><br><span class="line"></span><br><span class="line">        if (res.data.code === 0) &#123;</span><br><span class="line">            Toast.success(&#x27;新增学生成功&#x27;);</span><br><span class="line">            // 调用 Pinia 方法更新数据,不然需要手动刷新</span><br><span class="line">            const studentStore = useStudentStore();</span><br><span class="line">            await studentStore.fetchStudents(); // 更新当前页数据</span><br><span class="line">            await studentStore.fetchAllStudents(); // 更新全部学生数据</span><br><span class="line"></span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            console.log(res.data.message || &#x27;失败&#x27;);</span><br><span class="line">            Toast.fail(res.data.message || &#x27;新增学生失败&#x27;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; catch (error) &#123;</span><br><span class="line">            Toast.clear();</span><br><span class="line">            console.error(&#x27;新增学生失败:&#x27;, error);</span><br><span class="line">            Toast.fail(&#x27;新增学生失败&#x27;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">      </span><br><span class="line">    return &#123;</span><br><span class="line">      formData,</span><br><span class="line">      showGenderPicker,</span><br><span class="line">      showMajorDepartmentPicker,</span><br><span class="line">      showBirthDateCalendar,</span><br><span class="line">      defaultDate,</span><br><span class="line">      showHometownPicker,</span><br><span class="line">      showNativePlacePicker,</span><br><span class="line">      genderActions,</span><br><span class="line">      majorDepartmentOptions,</span><br><span class="line">      provinceOptions,</span><br><span class="line">      minDate,</span><br><span class="line">      maxDate,</span><br><span class="line">      handleBack,</span><br><span class="line">      onGenderSelect,</span><br><span class="line">      onMajorDepartmentFinish,</span><br><span class="line">      onBirthDateConfirm,</span><br><span class="line">      onHometownFinish,</span><br><span class="line">      onNativePlaceFinish,</span><br><span class="line">      handleSubmit,</span><br><span class="line">      afterRead,</span><br><span class="line">      departAndmajor,</span><br><span class="line">      showImagePicker,</span><br><span class="line">      imageList</span><br><span class="line">    &#125;;  </span><br><span class="line">      </span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.add-student-page &#123;</span><br><span class="line">  padding-bottom: 20px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.student-form &#123;</span><br><span class="line">  padding: 16px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.submit-button &#123;</span><br><span class="line">  margin: 20px 16px 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 调整字段间距 */</span><br><span class="line">.van-field &#123;</span><br><span class="line">  margin-bottom: 10px;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h2 id="学籍卡组件"><a href="#学籍卡组件" class="headerlink" title="学籍卡组件"></a>学籍卡组件</h2><blockquote>
<p>在写新增学生的时候就已经获得了院系-专业的级联数据并存入了pinia，这里直接用就行。</p>
</blockquote>
<h3 id="显示学生"><a href="#显示学生" class="headerlink" title="显示学生"></a>显示学生</h3><p>src&#x2F;views&#x2F;edit&#x2F;StuCard.vue</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;student-card&quot;&gt;</span><br><span class="line">    &lt;van-form @submit=&quot;onSubmit&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;basic-message&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;basic-left&quot;&gt;</span><br><span class="line">          &lt;!-- 姓名 --&gt;</span><br><span class="line">          &lt;van-field</span><br><span class="line">            class=&quot;card-name&quot;</span><br><span class="line">            v-model=&quot;formData.name&quot;</span><br><span class="line">            label=&quot;姓名&quot;</span><br><span class="line">            placeholder=&quot;请输入姓名&quot;</span><br><span class="line">            :readonly=&quot;!isEditable&quot;</span><br><span class="line">          /&gt;</span><br><span class="line">          &lt;!-- 学号 --&gt;</span><br><span class="line">          &lt;van-field</span><br><span class="line">            v-model=&quot;formData.stuID&quot;</span><br><span class="line">            label=&quot;学号&quot;</span><br><span class="line">            readonly</span><br><span class="line">            @click=&quot;hint&quot;</span><br><span class="line">          /&gt;</span><br><span class="line">          &lt;!-- 性别 --&gt;</span><br><span class="line">          &lt;van-field</span><br><span class="line">            v-model=&quot;formData.gender&quot;</span><br><span class="line">            is-link</span><br><span class="line">            readonly</span><br><span class="line">            label=&quot;性别&quot;</span><br><span class="line">            placeholder=&quot;请选择性别&quot;</span><br><span class="line">            @click=&quot;isEditable &amp;&amp; (showGenderPicker = true)&quot;</span><br><span class="line">            :rules=&quot;[&#123; required: true, message: &#x27;请选择性别&#x27; &#125;]&quot;</span><br><span class="line">          /&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- 照片 --&gt;</span><br><span class="line">        &lt;div class=&quot;photo-upload&quot;&gt;</span><br><span class="line">          &lt;van-uploader</span><br><span class="line">            v-model=&quot;photoFile&quot;</span><br><span class="line">            :disabled=&quot;!isEditable&quot;</span><br><span class="line">            :deletable=&quot;isEditable&quot;</span><br><span class="line">            max-count=&quot;1&quot;</span><br><span class="line">            :preview-image=&quot;false&quot;</span><br><span class="line">            :after-read=&quot;handlePhotoUpload&quot;</span><br><span class="line">          &gt;</span><br><span class="line">            &lt;template #default&gt;</span><br><span class="line">              &lt;div class=&quot;photo-preview&quot;&gt;</span><br><span class="line">                &lt;img v-if=&quot;formData.img&quot; :src=&quot;formData.img&quot; alt=&quot;学生照片&quot; /&gt;</span><br><span class="line">                &lt;van-icon v-else name=&quot;photograph&quot; size=&quot;50&quot; /&gt;</span><br><span class="line">              &lt;/div&gt;</span><br><span class="line">            &lt;/template&gt;</span><br><span class="line">          &lt;/van-uploader&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!-- 电话 --&gt;</span><br><span class="line">      &lt;van-field</span><br><span class="line">        v-model=&quot;formData.tel&quot;</span><br><span class="line">        label=&quot;电话&quot;</span><br><span class="line">        placeholder=&quot;请输入电话&quot;</span><br><span class="line">        :readonly=&quot;!isEditable&quot;</span><br><span class="line">        :rules=&quot;[</span><br><span class="line">          &#123; required: true, message: &#x27;请输入电话&#x27; &#125;,</span><br><span class="line">          &#123; validator: validatePhone, message: &#x27;请输入正确的手机号码&#x27; &#125;</span><br><span class="line">        ]&quot;</span><br><span class="line">      /&gt;  </span><br><span class="line">      &lt;!-- 专业和院系 --&gt;</span><br><span class="line">      &lt;van-field</span><br><span class="line">        v-model=&quot;departmentMajorText&quot;</span><br><span class="line">        is-link</span><br><span class="line">        readonly</span><br><span class="line">        label=&quot;专业和院系&quot;</span><br><span class="line">        placeholder=&quot;请选择专业和院系&quot;</span><br><span class="line">        @click=&quot;isEditable &amp;&amp; (showDepartmentMajorPicker = true)&quot;</span><br><span class="line">        :rules=&quot;[&#123; required: true, message: &#x27;请选择专业和院系&#x27; &#125;]&quot;</span><br><span class="line">      /&gt;</span><br><span class="line">      </span><br><span class="line">      &lt;!-- 入学分数 --&gt;</span><br><span class="line">      &lt;van-field</span><br><span class="line">        v-model=&quot;formData.grade&quot;</span><br><span class="line">        label=&quot;入学分数&quot;</span><br><span class="line">        placeholder=&quot;请输入入学分数&quot;</span><br><span class="line">        type=&quot;number&quot;</span><br><span class="line">        :readonly=&quot;!isEditable&quot;</span><br><span class="line">      /&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!-- 出生年月 --&gt;</span><br><span class="line">      &lt;van-field</span><br><span class="line">        v-model=&quot;formData.birth&quot;</span><br><span class="line">        is-link</span><br><span class="line">        readonly</span><br><span class="line">        label=&quot;出生年月&quot;</span><br><span class="line">        placeholder=&quot;请选择出生年月&quot;</span><br><span class="line">        @click=&quot;isEditable &amp;&amp; (showBirthdayPicker = true)&quot;</span><br><span class="line">        :rules=&quot;[&#123; required: true, message: &#x27;请选择出生年月&#x27; &#125;]&quot;</span><br><span class="line">      /&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!-- 生源地 --&gt;</span><br><span class="line">      &lt;van-field</span><br><span class="line">        v-model=&quot;formData.originPro&quot;</span><br><span class="line">        is-link</span><br><span class="line">        readonly</span><br><span class="line">        label=&quot;生源地&quot;</span><br><span class="line">        placeholder=&quot;请选择生源地&quot;</span><br><span class="line">        @click=&quot;isEditable &amp;&amp; (showHometownPicker = true)&quot;</span><br><span class="line">        :rules=&quot;[&#123; required: true, message: &#x27;请选择生源地&#x27; &#125;]&quot;</span><br><span class="line">      /&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!-- 籍贯 --&gt;</span><br><span class="line">      &lt;van-field</span><br><span class="line">        v-model=&quot;formData.nativePro&quot;</span><br><span class="line">        is-link</span><br><span class="line">        readonly</span><br><span class="line">        label=&quot;籍贯&quot;</span><br><span class="line">        placeholder=&quot;请选择籍贯&quot;</span><br><span class="line">        @click=&quot;isEditable &amp;&amp; (showNativePlacePicker = true)&quot;</span><br><span class="line">        :rules=&quot;[&#123; required: true, message: &#x27;请选择籍贯&#x27; &#125;]&quot;</span><br><span class="line">      /&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!-- 简介 --&gt;</span><br><span class="line">      &lt;van-field</span><br><span class="line">        v-model=&quot;formData.profile&quot;</span><br><span class="line">        label=&quot;简介&quot;</span><br><span class="line">        type=&quot;textarea&quot;</span><br><span class="line">        placeholder=&quot;请输入简介&quot;</span><br><span class="line">        rows=&quot;3&quot;</span><br><span class="line">        autosize</span><br><span class="line">        :readonly=&quot;!isEditable&quot;</span><br><span class="line">      /&gt;</span><br><span class="line">    &lt;/van-form&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 性别选择器 --&gt;</span><br><span class="line">    &lt;van-action-sheet</span><br><span class="line">      v-model:show=&quot;showGenderPicker&quot;</span><br><span class="line">      :actions=&quot;genderActions&quot;</span><br><span class="line">      @select=&quot;onGenderSelect&quot;</span><br><span class="line">    /&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- 专业和院系级联选择器 --&gt;</span><br><span class="line">    &lt;van-popup v-model:show=&quot;showDepartmentMajorPicker&quot; position=&quot;bottom&quot;&gt;</span><br><span class="line">      &lt;van-cascader</span><br><span class="line">        v-if=&quot;showDepartmentMajorPicker&quot;</span><br><span class="line">        :options=&quot;departmentMajorOptions&quot;</span><br><span class="line">        @finish=&quot;onDepartmentMajorFinish&quot;</span><br><span class="line">        @close=&quot;showDepartmentMajorPicker = false&quot;</span><br><span class="line">      /&gt;</span><br><span class="line">    &lt;/van-popup&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- 出生年月日历选择器 --&gt;</span><br><span class="line">    &lt;van-popup v-model:show=&quot;showBirthdayPicker&quot; position=&quot;bottom&quot;&gt;  </span><br><span class="line">      &lt;van-calendar</span><br><span class="line">        v-model:show=&quot;showBirthdayPicker&quot;</span><br><span class="line">        type=&quot;single&quot;</span><br><span class="line">        :min-date=&quot;minDate&quot;</span><br><span class="line">        :max-date=&quot;maxDate&quot;</span><br><span class="line">        :default-date=&quot;defaultBirthDate&quot;</span><br><span class="line">        @confirm=&quot;onBirthdayConfirm&quot;</span><br><span class="line">      /&gt;</span><br><span class="line">    &lt;/van-popup&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- 生源地选择器 --&gt;</span><br><span class="line">    &lt;van-popup v-model:show=&quot;showHometownPicker&quot; position=&quot;bottom&quot;&gt;</span><br><span class="line">      &lt;van-cascader</span><br><span class="line">        v-if=&quot;showHometownPicker&quot;</span><br><span class="line">        :options=&quot;provinceOptions&quot;</span><br><span class="line">        @finish=&quot;onHometownFinish&quot;</span><br><span class="line">        @close=&quot;showHometownPicker = false&quot;</span><br><span class="line">      /&gt;</span><br><span class="line">    &lt;/van-popup&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- 籍贯选择器 --&gt;</span><br><span class="line">    &lt;van-popup v-model:show=&quot;showNativePlacePicker&quot; position=&quot;bottom&quot;&gt;</span><br><span class="line">      &lt;van-cascader</span><br><span class="line">        v-if=&quot;showNativePlacePicker&quot;</span><br><span class="line">        :options=&quot;provinceOptions&quot;</span><br><span class="line">        @finish=&quot;onNativePlaceFinish&quot;</span><br><span class="line">        @close=&quot;showNativePlacePicker = false&quot;</span><br><span class="line">      /&gt;</span><br><span class="line">    &lt;/van-popup&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123; ref, computed, watch, onMounted &#125; from &#x27;vue&#x27;;</span><br><span class="line">import &#123; areaList &#125; from &#x27;@vant/area-data&#x27;;</span><br><span class="line">import &#123; useDepartmentMajorStore &#125; from &#x27;@/store/departmentMajor&#x27;;</span><br><span class="line">import &#123; Toast &#125; from &#x27;vant&#x27;;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  props: &#123;</span><br><span class="line">    isEditable: &#123;</span><br><span class="line">      type: Boolean,</span><br><span class="line">      default: false</span><br><span class="line">    &#125;,</span><br><span class="line">    studentData: &#123;</span><br><span class="line">      type: Object,</span><br><span class="line">      default: () =&gt; (&#123;&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  setup(props) &#123;</span><br><span class="line">    // 在EditView界面确定要显示的学生，通过props将studentData传到学籍卡组件</span><br><span class="line">    const formData = ref(&#123; ...props.studentData &#125;);</span><br><span class="line"> </span><br><span class="line">    const hint = () =&gt;&#123;</span><br><span class="line">      Toast(&quot;学号不可编辑&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    // 验证手机号</span><br><span class="line">    const validatePhone = (val) =&gt; /^1[3-9]\d&#123;9&#125;$/.test(val);</span><br><span class="line"></span><br><span class="line">    // 照片上传</span><br><span class="line">    const photoFile = ref([]);</span><br><span class="line">    const handlePhotoUpload = (file) =&gt; &#123;</span><br><span class="line">      formData.value.img = file.content;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    /* 性别选择 */</span><br><span class="line">    const showGenderPicker = ref(false);</span><br><span class="line">    const genderActions = [</span><br><span class="line">      &#123; name: &#x27;男&#x27;, value: &#x27;男&#x27; &#125;,</span><br><span class="line">      &#123; name: &#x27;女&#x27;, value: &#x27;女&#x27; &#125;</span><br><span class="line">    ];</span><br><span class="line">    const onGenderSelect = (action) =&gt; &#123;</span><br><span class="line">      formData.value.gender = action.name;</span><br><span class="line">      showGenderPicker.value = false;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    /* 院系专业选择 */</span><br><span class="line">    const departmentMajorStore = useDepartmentMajorStore();</span><br><span class="line">    const showDepartmentMajorPicker = ref(false);</span><br><span class="line">    //调用pinia中的专业院系级联数据  </span><br><span class="line">    const departmentMajorOptions = computed(() =&gt; departmentMajorStore.majorDepartmentOptions);</span><br><span class="line">    //用户选择的专业和院系  </span><br><span class="line">    const onDepartmentMajorFinish = (&#123; selectedOptions &#125;) =&gt; &#123;</span><br><span class="line">      const [department, major] = selectedOptions;</span><br><span class="line">      formData.value.department = department.text;</span><br><span class="line">      formData.value.major = major.text;</span><br><span class="line">      showDepartmentMajorPicker.value = false;</span><br><span class="line">    &#125;;</span><br><span class="line">    //显示到页面上  </span><br><span class="line">    const departmentMajorText = computed(() =&gt; &#123;</span><br><span class="line">      if (!formData.value.department || !formData.value.major) return &#x27;&#x27;;</span><br><span class="line">      return `$&#123;formData.value.department&#125; - $&#123;formData.value.major&#125;`;</span><br><span class="line">    &#125;);  </span><br><span class="line"></span><br><span class="line">    /* 出生日期选择 */</span><br><span class="line">    const showBirthdayPicker = ref(false);</span><br><span class="line">    const minDate = new Date(1970, 0, 1);</span><br><span class="line">    const maxDate = new Date();</span><br><span class="line">    const defaultBirthDate = ref(null);</span><br><span class="line">    const initBirthdayData = () =&gt; &#123;</span><br><span class="line">      if (formData.value.birth) &#123;</span><br><span class="line">        const dateParts = formData.value.birth.split(&#x27;-&#x27;);</span><br><span class="line">        if (dateParts.length === 3) &#123;</span><br><span class="line">          defaultBirthDate.value = new Date(</span><br><span class="line">            parseInt(dateParts[0]),</span><br><span class="line">            parseInt(dateParts[1]) - 1,</span><br><span class="line">            parseInt(dateParts[2])</span><br><span class="line">          );</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        defaultBirthDate.value = new Date(new Date().setFullYear(new Date().getFullYear() - 18));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    const onBirthdayConfirm = (date) =&gt; &#123;</span><br><span class="line">      const year = date.getFullYear();</span><br><span class="line">      const month = (date.getMonth() + 1).toString().padStart(2, &#x27;0&#x27;);</span><br><span class="line">      const day = date.getDate().toString().padStart(2, &#x27;0&#x27;);</span><br><span class="line">      formData.value.birth = `$&#123;year&#125;-$&#123;month&#125;-$&#123;day&#125;`;</span><br><span class="line">      showBirthdayPicker.value = false;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    /* 生源地和籍贯选择 */</span><br><span class="line">    const showHometownPicker = ref(false);</span><br><span class="line">    const showNativePlacePicker = ref(false);</span><br><span class="line">    const provinceOptions = ref([]);</span><br><span class="line">    const initProvinceData = () =&gt; &#123;</span><br><span class="line">      if (!areaList || !areaList.province_list) &#123;</span><br><span class="line">        console.error(&#x27;区域数据加载失败&#x27;);</span><br><span class="line">        return;</span><br><span class="line">      &#125;</span><br><span class="line">      provinceOptions.value = Object.entries(areaList.province_list).map(([code, name]) =&gt; (&#123;</span><br><span class="line">        text: name,</span><br><span class="line">        value: name,</span><br><span class="line">        //code备用一下，虽然大概率用不上</span><br><span class="line">        code: code</span><br><span class="line">      &#125;));</span><br><span class="line">    &#125;;</span><br><span class="line">    const onHometownFinish = (&#123; selectedOptions &#125;) =&gt; &#123;</span><br><span class="line">      formData.value.originPro = selectedOptions[0].text;</span><br><span class="line">      showHometownPicker.value = false;</span><br><span class="line">    &#125;;</span><br><span class="line">    const onNativePlaceFinish = (&#123; selectedOptions &#125;) =&gt; &#123;</span><br><span class="line">      formData.value.nativePro = selectedOptions[0].text;</span><br><span class="line">      showNativePlacePicker.value = false;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    // 表单提交</span><br><span class="line">    const onSubmit = () =&gt; &#123;</span><br><span class="line">      console.log(formData.value);</span><br><span class="line">      </span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    // 组件挂载时初始化数据</span><br><span class="line">    onMounted(() =&gt; &#123;</span><br><span class="line">      initProvinceData();</span><br><span class="line">      initBirthdayData();</span><br><span class="line">      </span><br><span class="line">      if (departmentMajorStore.majorDepartmentOptions.length === 0) &#123;</span><br><span class="line">        departmentMajorStore.loadDepartmentMajorData();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    return &#123;</span><br><span class="line">      hint,</span><br><span class="line">      formData,</span><br><span class="line">      photoFile,</span><br><span class="line">      departmentMajorText,</span><br><span class="line">      departmentMajorOptions,</span><br><span class="line">      showGenderPicker,</span><br><span class="line">      genderActions,</span><br><span class="line">      showDepartmentMajorPicker,</span><br><span class="line">      showBirthdayPicker,</span><br><span class="line">      minDate,</span><br><span class="line">      maxDate,</span><br><span class="line">      defaultBirthDate,</span><br><span class="line">      showHometownPicker,</span><br><span class="line">      showNativePlacePicker,</span><br><span class="line">      provinceOptions,</span><br><span class="line">      validatePhone,</span><br><span class="line">      handlePhotoUpload,</span><br><span class="line">      onGenderSelect,</span><br><span class="line">      onDepartmentMajorFinish,</span><br><span class="line">      onBirthdayConfirm,</span><br><span class="line">      onHometownFinish,</span><br><span class="line">      onNativePlaceFinish,</span><br><span class="line">      onSubmit,</span><br><span class="line">      //validate</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h3 id="编辑学生"><a href="#编辑学生" class="headerlink" title="编辑学生"></a>编辑学生</h3><blockquote>
<p>？emit props handleFormSubmit是否多余，这块似乎还需要修改</p>
</blockquote>
<h1 id="11-统计图显示"><a href="#11-统计图显示" class="headerlink" title="11.统计图显示"></a>11.统计图显示</h1><h1 id="部分组件和参数说明"><a href="#部分组件和参数说明" class="headerlink" title="部分组件和参数说明"></a>部分组件和参数说明</h1><h2 id="van-action-sheet-从底部弹出的菜单面板"><a href="#van-action-sheet-从底部弹出的菜单面板" class="headerlink" title="van-action-sheet 从底部弹出的菜单面板"></a>van-action-sheet 从底部弹出的菜单面板</h2><ul>
<li><code>v-model:show</code>：boolen型的show变量用来控制面板显示&#x2F;隐藏，使用v-model进行双向绑定</li>
<li><code>:actions</code>：菜单选项数组（格式如 <code>[&#123; name: &#39;退出登录&#39; &#125;]</code>）。</li>
<li><code>cancel-text</code>：取消按钮的文本。</li>
<li><code>close-on-click-action</code>：点击选项后自动关闭</li>
<li><code>@cancel=&quot;onCancel&quot;</code>：点击取消按钮时调用 <code>onCancel</code> 方法。</li>
<li><code>@select=&quot;onSelect&quot;</code>：选择菜单项时调用 onSelect 方法。</li>
</ul>
<h2 id="van-field-表单字段"><a href="#van-field-表单字段" class="headerlink" title="van-field 表单字段"></a>van-field 表单字段</h2><p><code>v-model=&quot;username&quot;</code>  双向绑定用户名输入值 </p>
<p> <code>name=&quot;username&quot;</code>  表单字段标识</p>
<p><code>:rules=&quot;userFormRules.username&quot;</code> 动态绑定校验规则</p>
<h2 id="van-dropdown"><a href="#van-dropdown" class="headerlink" title="van-dropdown"></a>van-dropdown</h2><p>往往不会直接用options，会在里面加自定义组件。因为需要自定义下拉项的交互逻辑。</p>
<p><code>options</code> 的点击行为是固定的（选中后关闭下拉菜单并更新 <code>v-model</code>），但实际应用中可能需要在点击时触发其他操作。所以会通过 <code>&lt;template #default&gt;</code> 自定义内容，可以完全控制每个选项的点击行为（例如弹出输入框、发起请求等）。</p>
<p>其次，<code>options</code> 只能提供简单的文本显示，无法添加图标、辅助文字或特殊样式。所以用自定义模板中，这样可以自由使用其他组件（如 <code>van-cell</code>），实现更丰富的 UI 效果。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://example.com">Cheng-orange</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2025/04/26/%E5%AD%A6%E7%B1%8D%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E5%89%8D%E7%AB%AF/">http://example.com/2025/04/26/%E5%AD%A6%E7%B1%8D%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E5%89%8D%E7%AB%AF/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="http://example.com" target="_blank">圆橙子</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/vue3/">vue3</a></div><div class="post-share"><div class="social-share" data-image="/img/avatar.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/04/13/hexo%E5%9B%BE%E5%BA%8A%E5%92%8C%E6%96%87%E7%AB%A0%E5%86%99%E4%BD%9C/" title="hexo图床和文章编辑写作"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">hexo图床和文章编辑写作</div></div><div class="info-2"><div class="info-item-1">...</div></div></div></a><a class="pagination-related" href="/2025/05/07/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AD%A6%E4%B9%A0/" title="数据库学习-updating"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">数据库学习-updating</div></div><div class="info-2"><div class="info-item-1"> navicat+idea  1.MySQL下载2.数据库服务启动和连接win+r并输入cmd，同时按住ctrl和shift并点确定，用管理员模式打开cmd。 12net start mysql //启动数据库服务mysql -u root -p //连接到数据库  不用管理员模式会显示“发生系统错误5.拒绝访问”。 3.navicat连接到本地数据库并建表 连接前先启动数据库服务   点击进入连接信息界面后依次填入信息，最后点击下方“测试连接”。测试无误后点击确认即可连接到本地数据库。 右键建库建表。使用“生成数据”生成模拟数据。 4.idea中连接数据库点击图中右侧图标后，选择“新建数据源”，输入用户、密码、数据库这些信息后“测试连接”，最后点击确认即可。  创建后窗口会自动弹出console窗口，后续各种表和数据操作的sql语句在这里编写和保存。可以右键选择将其重命名，这样便于后续操作。 5.Mybatis1.配置Mybatis并测试1.创建springboot项目时勾选Mybatis相关依赖：MySQL Driver和MyBaties...</div></div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Cheng-orange</div><div class="author-info-description">一起看日出吧^</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">4</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">4</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-%E4%BD%BF%E7%94%A8%E6%A1%86%E6%9E%B6%E5%92%8C%E7%95%8C%E9%9D%A2%E6%A6%82%E8%A7%88"><span class="toc-number">1.</span> <span class="toc-text">1.使用框架和界面概览</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-%E9%A1%B9%E7%9B%AE%E5%88%9B%E5%BB%BA%E5%92%8C%E7%9B%AE%E5%BD%95"><span class="toc-number">2.</span> <span class="toc-text">2.项目创建和目录</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-%E6%B3%A8%E5%86%8C%E5%BC%95%E5%85%A5%E6%A1%86%E6%9E%B6%E3%80%81%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9A%84css"><span class="toc-number">3.</span> <span class="toc-text">3.注册引入框架、自定义的css</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-%E8%B7%AF%E7%94%B1%E8%AE%BE%E7%BD%AE"><span class="toc-number">4.</span> <span class="toc-text">4.路由设置</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-%E7%99%BB%E5%BD%95"><span class="toc-number">5.</span> <span class="toc-text">5.登录</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%BB%E8%BE%91%E8%AF%B4%E6%98%8E"><span class="toc-number">5.1.</span> <span class="toc-text">逻辑说明</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E9%83%A8%E5%88%86"><span class="toc-number">5.2.</span> <span class="toc-text">代码部分</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%81%E8%A3%85%E6%8E%A5%E5%8F%A3%E6%96%B9%E6%B3%95"><span class="toc-number">5.2.1.</span> <span class="toc-text">封装接口方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%A8%E5%9F%9F%E8%A7%A3%E5%86%B3"><span class="toc-number">5.2.2.</span> <span class="toc-text">跨域解决</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%99%BB%E9%99%86%E4%BC%98%E5%8C%96-%E5%A4%84%E7%90%86%E7%94%A8%E6%88%B7token"><span class="toc-number">5.3.</span> <span class="toc-text">登陆优化-处理用户token</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-%E5%BA%95%E9%83%A8%E5%AF%BC%E8%88%AA%E6%A0%8F"><span class="toc-number">6.</span> <span class="toc-text">6.底部导航栏</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%BB%E8%BE%91%E8%AF%B4%E6%98%8E-1"><span class="toc-number">6.1.</span> <span class="toc-text">逻辑说明</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E9%83%A8%E5%88%86-1"><span class="toc-number">6.2.</span> <span class="toc-text">代码部分</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E8%AE%BE%E7%BD%AE"><span class="toc-number">6.2.1.</span> <span class="toc-text">路由设置</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#7-%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF-%E6%98%BE%E7%A4%BA%E3%80%81%E9%80%80%E5%87%BA%E7%99%BB%E5%BD%95"><span class="toc-number">7.</span> <span class="toc-text">7.用户信息-显示、退出登录</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%BB%E8%BE%91%E8%AF%B4%E6%98%8E-2"><span class="toc-number">7.1.</span> <span class="toc-text">逻辑说明</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%95%8C%E9%9D%A2%E4%BB%A3%E7%A0%81%EF%BC%88%E6%9C%AA%E5%AE%9E%E7%8E%B0%E5%AF%B9%E6%8E%A5%EF%BC%89"><span class="toc-number">7.2.</span> <span class="toc-text">界面代码（未实现对接）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#css%E9%83%A8%E5%88%86"><span class="toc-number">7.2.1.</span> <span class="toc-text">css部分</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E5%90%8E%E7%AB%AF%E5%AF%B9%E6%8E%A5"><span class="toc-number">7.3.</span> <span class="toc-text">前后端对接</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#pinia%E4%BF%9D%E5%AD%98%E7%94%A8%E6%88%B7token%EF%BC%88%E4%BF%AE%E6%94%B9%E7%99%BB%E5%BD%95"><span class="toc-number">7.3.1.</span> <span class="toc-text">pinia保存用户token（修改登录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B1%95%E7%A4%BA%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF%E5%B9%B6%E5%AD%98%E5%85%A5pinia"><span class="toc-number">7.3.2.</span> <span class="toc-text">展示用户信息并存入pinia</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%80%E5%87%BA%E7%99%BB%E5%BD%95%E5%92%8C%E5%88%87%E6%8D%A2%E8%B4%A6%E5%8F%B7"><span class="toc-number">7.3.3.</span> <span class="toc-text">退出登录和切换账号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pinia%E6%8C%81%E4%B9%85%E5%8C%96%E6%8F%92%E4%BB%B6"><span class="toc-number">7.3.4.</span> <span class="toc-text">pinia持久化插件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E6%8B%A6%E6%88%AA%E5%99%A8%E8%AE%BE%E7%BD%AE"><span class="toc-number">7.3.5.</span> <span class="toc-text">请求拦截器设置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%98%BE%E7%A4%BA%E4%B8%AA%E4%BA%BA%E4%BF%A1%E6%81%AF%E5%92%8C%E9%80%80%E5%87%BA%E7%99%BB%E5%BD%95%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81"><span class="toc-number">7.3.6.</span> <span class="toc-text">显示个人信息和退出登录完整代码</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#8-%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF-%E4%BF%AE%E6%94%B9"><span class="toc-number">8.</span> <span class="toc-text">8.用户信息-修改</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E5%AF%86%E7%A0%81"><span class="toc-number">8.1.</span> <span class="toc-text">修改密码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%98%BE%E7%A4%BA%E5%A4%B4%E5%83%8F%E5%A4%A7%E5%9B%BE%E3%80%81%E4%BF%AE%E6%94%B9%E5%A4%B4%E5%83%8F%EF%BC%88%E6%96%87%E4%BB%B6%E8%B5%84%E6%BA%90%E5%BA%93%EF%BC%89"><span class="toc-number">8.2.</span> <span class="toc-text">显示头像大图、修改头像（文件资源库）*</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-number">8.2.1.</span> <span class="toc-text">&lt;待修改上传文件服务器&gt;</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E9%83%A8%E5%88%86%E5%85%A8%E9%83%A8%E4%BB%A3%E7%A0%81"><span class="toc-number">8.3.</span> <span class="toc-text">用户部分全部代码</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#9-%E4%B8%BB%E9%A1%B5"><span class="toc-number">9.</span> <span class="toc-text">9.主页</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%95%8C%E9%9D%A2"><span class="toc-number">9.1.</span> <span class="toc-text">总界面</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%90%9C%E7%B4%A2%E7%BB%84%E4%BB%B6%E7%95%8C%E9%9D%A2"><span class="toc-number">9.2.</span> <span class="toc-text">搜索组件界面</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E9%99%A2%E7%B3%BB%E3%80%81%E4%B8%93%E4%B8%9A%E6%B8%B2%E6%9F%93%E5%88%B0%E4%B8%8B%E6%8B%89%E8%8F%9C%E5%8D%95"><span class="toc-number">9.2.1.</span> <span class="toc-text">获取院系、专业渲染到下拉菜单</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E7%9C%81%E4%BB%BD%E4%BF%A1%E6%81%AF"><span class="toc-number">9.2.2.</span> <span class="toc-text">获取省份信息</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%A8%E6%A0%BC%E7%BB%84%E4%BB%B6%E7%95%8C%E9%9D%A2"><span class="toc-number">9.3.</span> <span class="toc-text">表格组件界面</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%A8%E8%A1%A8%E6%A0%BC%E4%B8%AD%E6%98%BE%E7%A4%BA%E5%AD%A6%E7%94%9F%E6%95%B0%E6%8D%AE%E5%92%8C%E5%88%A0%E9%99%A4%E5%8D%95%E6%9D%A1%E4%BF%A1%E6%81%AF"><span class="toc-number">9.4.</span> <span class="toc-text">在表格中显示学生数据和删除单条信息</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8pinia%E5%AD%98%E5%BD%93%E5%89%8D%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF-%E5%88%A0%E9%99%A4"><span class="toc-number">9.4.1.</span> <span class="toc-text">使用pinia存当前学生信息+删除</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E8%A1%A8%E6%A0%BC%E7%BB%84%E4%BB%B6%E4%B8%AD%E6%98%BE%E7%A4%BA%E3%80%81%E5%88%A0%E9%99%A4%E4%BF%A1%E6%81%AF%E9%83%A8%E5%88%86%E4%BB%A3%E7%A0%81"><span class="toc-number">9.4.2.</span> <span class="toc-text">修改表格组件中显示、删除信息部分代码</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%90%9C%E7%B4%A2%E7%BB%84%E4%BB%B6-%E6%9D%A1%E4%BB%B6%E6%A3%80%E7%B4%A2"><span class="toc-number">9.5.</span> <span class="toc-text">搜索组件-条件检索</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E5%A4%8D%E4%B8%80%E5%88%B7%E6%96%B0%E3%80%81%E8%B7%B3%E8%BD%AC%E5%9B%9E%E4%B8%BB%E7%95%8C%E9%9D%A2%E6%9D%A1%E4%BB%B6%E7%AD%9B%E9%80%89%E6%A0%87%E7%AD%BE%E6%B6%88%E5%A4%B1%E9%97%AE%E9%A2%98"><span class="toc-number">9.5.1.</span> <span class="toc-text">修复一刷新、跳转回主界面条件筛选标签消失问题*</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%BC%E5%87%BA%E5%88%B0excel"><span class="toc-number">9.6.</span> <span class="toc-text">导出到excel</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#10-%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E7%BC%96%E8%BE%91"><span class="toc-number">10.</span> <span class="toc-text">10.学生信息编辑</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#edit%E9%A1%B5%E9%9D%A2"><span class="toc-number">10.1.</span> <span class="toc-text">edit页面</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E3%80%81%E6%9F%A5%E6%89%BE%E4%B8%8A%E4%B8%8B%E4%B8%80%E4%B8%AA%E5%AD%A6%E7%94%9F"><span class="toc-number">10.1.1.</span> <span class="toc-text">删除、查找上下一个学生</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#edit-%E6%96%B0%E5%A2%9E%E5%AD%A6%E7%94%9F"><span class="toc-number">10.1.2.</span> <span class="toc-text">edit-新增学生</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%A6%E7%B1%8D%E5%8D%A1%E7%BB%84%E4%BB%B6"><span class="toc-number">10.2.</span> <span class="toc-text">学籍卡组件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%98%BE%E7%A4%BA%E5%AD%A6%E7%94%9F"><span class="toc-number">10.2.1.</span> <span class="toc-text">显示学生</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E8%BE%91%E5%AD%A6%E7%94%9F"><span class="toc-number">10.2.2.</span> <span class="toc-text">编辑学生</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#11-%E7%BB%9F%E8%AE%A1%E5%9B%BE%E6%98%BE%E7%A4%BA"><span class="toc-number">11.</span> <span class="toc-text">11.统计图显示</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%83%A8%E5%88%86%E7%BB%84%E4%BB%B6%E5%92%8C%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E"><span class="toc-number">12.</span> <span class="toc-text">部分组件和参数说明</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#van-action-sheet-%E4%BB%8E%E5%BA%95%E9%83%A8%E5%BC%B9%E5%87%BA%E7%9A%84%E8%8F%9C%E5%8D%95%E9%9D%A2%E6%9D%BF"><span class="toc-number">12.1.</span> <span class="toc-text">van-action-sheet 从底部弹出的菜单面板</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#van-field-%E8%A1%A8%E5%8D%95%E5%AD%97%E6%AE%B5"><span class="toc-number">12.2.</span> <span class="toc-text">van-field 表单字段</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#van-dropdown"><span class="toc-number">12.3.</span> <span class="toc-text">van-dropdown</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/05/07/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AD%A6%E4%B9%A0/" title="数据库学习-updating">数据库学习-updating</a><time datetime="2025-05-07T12:17:01.000Z" title="发表于 2025-05-07 20:17:01">2025-05-07</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/04/26/%E5%AD%A6%E7%B1%8D%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E5%89%8D%E7%AB%AF/" title="学籍管理系统前端">学籍管理系统前端</a><time datetime="2025-04-26T05:02:32.000Z" title="发表于 2025-04-26 13:02:32">2025-04-26</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/04/13/hexo%E5%9B%BE%E5%BA%8A%E5%92%8C%E6%96%87%E7%AB%A0%E5%86%99%E4%BD%9C/" title="hexo图床和文章编辑写作">hexo图床和文章编辑写作</a><time datetime="2025-04-13T12:13:04.000Z" title="发表于 2025-04-13 20:13:04">2025-04-13</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/04/13/%E5%AD%A6%E7%B1%8D%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E5%90%8E%E7%AB%AF/" title="学籍管理系统后端">学籍管理系统后端</a><time datetime="2025-04-13T11:13:08.000Z" title="发表于 2025-04-13 19:13:08">2025-04-13</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2025 By Cheng-orange</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.3.5</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>